<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Var√≥n ‚Äî Elegant Men's Fashion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Commissioner:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>
    <header class="site-header">
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">‚ò∞</button>
      <h1 class="brand"><a href="javascript:void(0)" onclick="showSection('home')" style="color:#fff;text-decoration:none">Var√≥n</a></h1>
      <nav class="top-nav" id="topNav">
        <a href="javascript:void(0)" onclick="showSection('trackOrder')">Track Your Order</a>
        <a href="javascript:void(0)" onclick="showSection('myOrders')" id="myOrdersLink" style="display:none">My Orders</a>
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <span class="welcome-msg">Welcome, <span id="buyerFirstName"></span></span>
        <a href="/logout" class="account">Logout</a>
        <a href="#" onclick="openModal('cartModal')" id="cartToggle" class="account" style="position:relative;display:inline-flex;align-items:center;gap:8px">
          Cart 
          <span id="cartCount" style="background:#fff;color:#0a0a0a;border-radius:12px;padding:2px 8px;font-size:12px;font-weight:600;min-width:24px;text-align:center">0</span>
        </a>
      </nav>
    </header>

    <!-- Hero Section (Home Only) -->
    <section class="hero" id="heroSection">
      <div class="hero-inner container">
        <div class="hero-copy">
          <h2>Refined Elegance for the Modern Gentleman</h2>
          <p class="muted">Where sophistication meets contemporary style. Each piece is meticulously crafted to elevate your presence.</p>
          <p><a href="#productGrid" class="btn-cta">Discover Collection</a></p>
        </div>
        <div class="hero-media" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Content Sections -->
    <div id="trackOrder" class="content-section" style="display:none">
      <div class="container" style="max-width:900px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">Track Your Orders</h2>
        
        <!-- Order Tracking Search -->
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin-bottom:30px">
          <form id="trackingForm" style="display:flex;gap:12px;align-items:flex-end">
            <div style="flex:1">
              <label style="display:block;margin-bottom:8px;font-weight:500">Order Number</label>
              <input type="text" id="trackingOrderNumber" placeholder="Enter order number (e.g., ORD-123456)" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box">
            </div>
            <button type="submit" class="btn-cta">Track Order</button>
          </form>
          <div id="trackingResult" style="margin-top:20px;display:none;padding:16px;background:#f0f9ff;border-radius:8px;border-left:4px solid #3b82f6">
            <h3 style="margin:0 0 12px;color:#1e40af">Order Status</h3>
            <div id="trackingDetails" style="color:#1e40af;font-size:14px;line-height:1.6"></div>
          </div>
        </div>

        <!-- User's Orders -->
        <div id="userOrders">
          <h3 style="margin-bottom:20px">Your Orders</h3>
          <div id="ordersContainer">
            <!-- Orders will be loaded here via JavaScript -->
            <div style="text-align:center;padding:40px;color:#999">
              <p>Loading your orders...</p>
            </div>
          </div>
        </div>

        <!-- Order Details Modal Result -->
        <div id="trackingResult" style="display:none;margin-top:20px"></div>
      </div>
    </div>

    <div id="myOrders" class="content-section" style="display:none">
      <div class="container" style="max-width:1000px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">My Orders</h2>
        <div id="myOrdersList">
          <div style="text-align:center;padding:40px;color:#999">
            <p>Loading your orders...</p>
          </div>
        </div>
      </div>
    </div>

    <div id="browse" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Browse Collection</h2>
        <div id="browseGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px">
          <!-- Products will be loaded here -->
        </div>
      </div>
    </div>

    <div id="journal" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Style Journal</h2>
        <p style="color:#666;margin-bottom:30px">Discover the latest trends, style guides, and fashion insights from Var√≥n.</p>
        
        <div id="journalArticles" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px">
          <!-- Default articles while database is being set up -->
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1521334884684-d80222895322?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <span style="font-size:12px;color:#999">November 13, 2025</span>
                <span style="font-size:12px;color:#10b981;font-weight:600">STYLE GUIDE</span>
              </div>
              <h3 style="margin:0 0 10px">Style Guide: Fall 2025</h3>
              <p style="margin:0;color:#666;line-height:1.5;font-size:14px">Explore our comprehensive guide to fall fashion trends and essential pieces for your wardrobe. Discover the perfect balance between comfort and elegance.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px;padding:8px 20px">Read More</a>
            </div>
          </article>
          
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1610963876305-c8e7cb43a09b?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <span style="font-size:12px;color:#999">November 10, 2025</span>
                <span style="font-size:12px;color:#10b981;font-weight:600">SUSTAINABILITY</span>
              </div>
              <h3 style="margin:0 0 10px">Sustainable Fashion</h3>
              <p style="margin:0;color:#666;line-height:1.5;font-size:14px">Learn about our commitment to sustainable practices and ethical fashion production. Every choice we make considers the environment and our community.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px;padding:8px 20px">Read More</a>
            </div>
          </article>
          
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1617347454431-f49d7ff5c3b1?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <span style="font-size:12px;color:#999">November 8, 2025</span>
                <span style="font-size:12px;color:#10b981;font-weight:600">FASHION TIPS</span>
              </div>
              <h3 style="margin:0 0 10px">The Art of Layering</h3>
              <p style="margin:0;color:#666;line-height:1.5;font-size:14px">Master the technique of layering your outfits for a sophisticated and versatile look that works for any occasion this season.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px;padding:8px 20px">Read More</a>
            </div>
          </article>

          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <div style="display:flex;gap:10px;margin-bottom:10px">
                <span style="font-size:12px;color:#999">November 5, 2025</span>
                <span style="font-size:12px;color:#10b981;font-weight:600">BRAND STORY</span>
              </div>
              <h3 style="margin:0 0 10px">Craftsmanship Meets Innovation</h3>
              <p style="margin:0;color:#666;line-height:1.5;font-size:14px">Discover how traditional craftsmanship and modern innovation come together to create timeless pieces that define the Var√≥n aesthetic.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px;padding:8px 20px">Read More</a>
            </div>
          </article>
        </div>
      </div>
    </div>

    <div id="about" class="content-section" style="display:none">
      <div class="container" style="max-width:800px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">About Var√≥n</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <p style="line-height:1.6;margin:0 0 20px">Var√≥n is a modern menswear brand focused on creating timeless pieces that combine style, comfort, and sustainability. Our mission is to provide high-quality clothing that stands the test of time.</p>
          <p style="line-height:1.6;margin:0 0 20px">Founded in 2025, we've been dedicated to crafting minimal designs that emphasize quality materials and expert craftsmanship. Every piece in our collection is thoughtfully designed and responsibly made.</p>
          <p style="line-height:1.6;margin:0">Our commitment to sustainability and ethical fashion drives everything we do. We work closely with our partners to ensure responsible production methods and fair labor practices throughout our supply chain.</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container" id="mainContent">
      <section class="toolbar">
        <div class="filters">
          <button data-filter="men" class="active">Men</button>
        </div>
        <div class="genres">
          <label>Genres:</label>
          <button data-genre="all" class="genre active">All</button>
          <button data-genre="shirts" class="genre">Shirts</button>
          <button data-genre="pants" class="genre">Pants</button>
          <button data-genre="shorts" class="genre">Shorts</button>
          <button data-genre="jackets" class="genre">Jackets</button>
          <button data-genre="shoes" class="genre">Shoes</button>
          <button data-genre="accessories" class="genre">Accessories</button>
          <button data-genre="formal" class="genre">Formal</button>
          <button data-genre="casual" class="genre">Casual</button>
        </div>
      </section>

      <section class="product-grid" id="productGrid">
        {% if products %}
          {% for product in products %}
            <article class="product" data-category="men" data-genre="{{ product.category_name.lower() if product.category_name else 'general' }}" data-product-id="{{ product.id }}" style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:transform 0.2s,box-shadow 0.2s">
              <a href="/product/{{ product.id }}" style="text-decoration:none;color:inherit;display:block">
                <div class="product-image" style="position:relative;width:100%;height:280px;background:#f5f5f5;background-image:url('{{ product.image_url or 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop' }}');background-size:cover;background-position:center"></div>
                <div class="product-info" style="padding:16px 16px 12px">
                  <h3 style="margin:0 0 6px;font-size:15px;font-weight:500;color:#0a0a0a;line-height:1.3">{{ product.name }}</h3>
                  <div class="price" style="font-size:16px;font-weight:600;color:#0a0a0a">‚Ç±{{ "{:,.2f}".format(product.price) }}</div>
                </div>
              </a>
              <div style="padding:0 16px 16px">
                <button onclick="quickAddToCart(event, {{ product.id }}, '{{ product.name }}', {{ product.price }}, '{{ product.image_url or '' }}')" 
                        style="width:100%;padding:10px;background:#0a0a0a;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background 0.2s"
                        onmouseover="this.style.background='#2d2d2d'" 
                        onmouseout="this.style.background='#0a0a0a'">
                  Add to Cart
                </button>
              </div>
            </article>
          {% endfor %}
        {% else %}
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">
            <p>No products available</p>
          </div>
        {% endif %}
      </section>
    </main>



    <!-- Cart Modal -->
    <div id="cartModal" class="modal" aria-hidden="true">
      <div class="cart-card">
        <button onclick="closeModal('cartModal')" class="cart-close-btn" aria-label="Close cart">√ó</button>
        <h2 style="text-align:left;margin-bottom:20px">Your Cart</h2>
        <div id="cartList" class="cart-list">
          <!-- Empty cart state -->
          <div class="empty-cart-state" style="text-align:center;padding:60px 20px">
            <div style="font-size:80px;color:#ddd;margin-bottom:16px">
              <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:inline-block">
                <path d="M9 2L7.17 4H3c-.55 0-1 .45-1 1s.45 1 1 1h1l1.6 8.6c.18 1 1.05 1.73 2.06 1.73h7.72c1.01 0 1.88-.73 2.06-1.73L19 6h1c.55 0 1-.45 1-1s-.45-1-1-1h-4.17L14 2H9z"/>
                <circle cx="9" cy="20" r="1"/>
                <circle cx="16" cy="20" r="1"/>
              </svg>
            </div>
            <h3 style="font-size:18px;font-weight:400;color:#999;margin:0 0 8px">Your cart is empty</h3>
            <p style="font-size:14px;color:#bbb;margin:0">Add some products to get started!</p>
          </div>
        </div>
        <div class="cart-totals">
          <div style="padding:24px 0;border-top:1px solid #eee">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <span style="color:#666;font-size:15px">Subtotal:</span>
              <span style="font-size:16px;font-weight:500" id="cartSubtotal">‚Ç±0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
              <span style="font-size:18px;font-weight:600;color:#0a0a0a">Total:</span>
              <span style="font-size:20px;font-weight:600;color:#0a0a0a" id="cartTotal">‚Ç±0.00</span>
            </div>
          </div>
          <div style="display:flex;gap:12px">
            <button onclick="clearCart()" class="btn-secondary" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;border:1px solid #e0e0e0;background:#fff;color:#0a0a0a;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#f8f8f8'" onmouseout="this.style.background='#fff'">CLEAR CART</button>
            <button id="checkoutBtn" class="btn-cta" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;background:#0a0a0a;color:#fff;border:none;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#2d2d2d'" onmouseout="this.style.background='#0a0a0a'">PROCEED TO CHECKOUT</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Clear Cart Modal -->
    <div id="clearModal" class="modal" aria-hidden="true">
      <div class="modal-panel">
        <button class="modal-close" onclick="closeModal('clearModal')">√ó</button>
        <h2 style="margin:0 0 8px">Clear Cart?</h2>
        <p style="margin:0 0 18px;color:var(--muted)">Are you sure you want to remove all items from your cart?</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('clearModal')" class="btn-cta" style="background:#f6f6f6;color:#0a0a0a">Cancel</button>
          <button id="confirmClearYes" class="btn-cta">Yes, Clear Cart</button>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal" aria-hidden="true">
      <div class="modal-panel checkout">
        <button class="modal-close" onclick="closeModal('checkoutModal')" style="color:#fff">√ó</button>
        <h2 style="color:#fff;margin:0 0 8px">Checkout</h2>
        <p class="muted" style="margin:0 0 18px">Review your order before proceeding to payment</p>
        <div id="checkoutSummary" style="margin-bottom:18px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('checkoutModal')" class="secondary">Cancel</button>
          <button id="proceedCheckout" class="btn-cta">Proceed to Payment</button>
        </div>
      </div>
    </div>

    <div id="snackbar" class="snackbar" role="status" aria-live="polite">Added to cart</div>
    
    <div class="overlay" id="overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <a href="javascript:void(0)" onclick="showSection('trackOrder')">Track Your Order</a>
        <a href="javascript:void(0)" onclick="showSection('myOrders')" id="myOrdersLinkSidebar" style="display:none">My Orders</a>
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <span class="welcome-msg">Welcome, <span id="buyerFirstNameSidebar"></span></span>
        <a href="/logout" class="account">Logout</a>
        <a href="#" onclick="openModal('cartModal')" class="account" style="position:relative;display:inline-flex;align-items:center;gap:8px">
          Cart 
          <span id="cartCountSidebar" style="background:#fff;color:#0a0a0a;border-radius:12px;padding:2px 8px;font-size:12px;font-weight:600;min-width:24px;text-align:center">0</span>
        </a>
      </nav>
    </aside>

    <script>
      // Section navigation
      function showSection(sectionId) {
        // Hide all content sections
        document.querySelectorAll('.content-section').forEach(section => {
          section.style.display = 'none';
        });
        
        // Hide main content if showing other sections
        const mainContent = document.getElementById('mainContent');
        const heroSection = document.getElementById('heroSection');
        
        if (sectionId === 'home') {
          // Show home (main content and hero)
          mainContent.style.display = 'block';
          heroSection.style.display = 'block';
        } else {
          // Hide main content and hero, show specific section
          mainContent.style.display = 'none';
          heroSection.style.display = 'none';
          const targetSection = document.getElementById(sectionId);
          if (targetSection) {
            targetSection.style.display = 'block';
          }
        }
        
        // Special handling for orders section
        if (sectionId === 'trackOrder') {
          loadUserOrders();
        } else if (sectionId === 'myOrders') {
          loadMyOrders();
        }
      }

      // Load user orders
      function loadUserOrders() {
        fetch('/api/user_orders')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('ordersContainer');
            if (data.success && data.orders && data.orders.length > 0) {
              container.innerHTML = data.orders.map(order => `
                <div style="background:#fff;border-radius:8px;padding:20px;margin-bottom:16px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
                  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
                    <div>
                      <h4 style="margin:0 0 4px;font-size:16px">Order #${order.id}</h4>
                      <p style="margin:0;color:#666;font-size:14px">${new Date(order.created_at).toLocaleDateString()}</p>
                    </div>
                    <div style="text-align:right">
                      <p style="margin:0;font-weight:600;color:#0a0a0a">‚Ç±${parseFloat(order.total).toFixed(2)}</p>
                      <p style="margin:4px 0 0;font-size:12px;color:#666">${order.status || 'Processing'}</p>
                    </div>
                  </div>
                  <p style="margin:0;color:#666;font-size:14px;line-height:1.4">${order.items_count || 1} item(s) ‚Ä¢ ${order.shipping_address || 'Address on file'}</p>
                </div>
              `).join('');
            } else {
              container.innerHTML = '<div style="text-align:center;padding:40px;color:#999"><p>No orders found</p></div>';
            }
          })
          .catch(error => {
            console.error('Error loading orders:', error);
            document.getElementById('ordersContainer').innerHTML = '<div style="text-align:center;padding:40px;color:#999"><p>Error loading orders</p></div>';
          });
      }

      // Load My Orders section with detailed order cards
      function loadMyOrders() {
        fetch('/api/user_orders')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('myOrdersList');
            if (data.success && data.orders && data.orders.length > 0) {
              container.innerHTML = data.orders.map(order => `
                <div style="background:#fff;border-radius:12px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:box-shadow 0.2s" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                  <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid #f0f0f0">
                    <div>
                      <h3 style="margin:0 0 6px;font-size:18px;font-weight:600">Order #${order.id}</h3>
                      <p style="margin:0;color:#666;font-size:14px">${new Date(order.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                    <div style="text-align:right">
                      <div style="display:inline-block;padding:6px 12px;border-radius:6px;font-size:12px;font-weight:500;background:${order.status === 'delivered' ? '#dcfce7' : order.status === 'shipped' ? '#dbeafe' : '#fef9c3'};color:${order.status === 'delivered' ? '#166534' : order.status === 'shipped' ? '#1e40af' : '#854d0e'}">
                        ${(order.status || 'processing').toUpperCase()}
                      </div>
                    </div>
                  </div>
                  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
                    <div>
                      <p style="margin:0 0 4px;color:#999;font-size:13px">Total Amount</p>
                      <p style="margin:0;font-size:20px;font-weight:600;color:#0a0a0a">‚Ç±${parseFloat(order.total).toFixed(2)}</p>
                    </div>
                    <div>
                      <p style="margin:0 0 4px;color:#999;font-size:13px">Items</p>
                      <p style="margin:0;font-size:16px;font-weight:500;color:#0a0a0a">${order.items_count || 1} item(s)</p>
                    </div>
                  </div>
                  <div style="margin-bottom:16px">
                    <p style="margin:0 0 4px;color:#999;font-size:13px">Shipping Address</p>
                    <p style="margin:0;color:#0a0a0a;font-size:14px;line-height:1.5">${order.shipping_address || 'Address on file'}</p>
                  </div>
                  <div style="display:flex;gap:8px;justify-content:flex-end">
                    <button onclick="trackOrderById('${order.id}')" class="btn-cta" style="padding:10px 20px;font-size:14px;border-radius:6px;background:#0a0a0a;color:#fff;border:none;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#2d2d2d'" onmouseout="this.style.background='#0a0a0a'">Track Order</button>
                  </div>
                </div>
              `).join('');
            } else {
              container.innerHTML = `
                <div style="text-align:center;padding:60px 20px">
                  <div style="font-size:80px;color:#ddd;margin-bottom:16px">üì¶</div>
                  <h3 style="font-size:20px;font-weight:500;color:#666;margin:0 0 8px">No orders yet</h3>
                  <p style="font-size:14px;color:#999;margin:0 0 20px">Start shopping to place your first order!</p>
                  <button onclick="showSection('home')" class="btn-cta" style="padding:12px 24px;font-size:14px">Browse Products</button>
                </div>
              `;
            }
          })
          .catch(error => {
            console.error('Error loading orders:', error);
            document.getElementById('myOrdersList').innerHTML = '<div style="text-align:center;padding:40px;color:#dc2626"><p>Error loading orders</p></div>';
          });
      }

      // Track order by ID (helper function for My Orders section)
      function trackOrderById(orderId) {
        showSection('trackOrder');
        document.getElementById('trackingOrderNumber').value = orderId;
        document.getElementById('trackingForm').dispatchEvent(new Event('submit'));
      }

      // Check if buyer has orders and show/hide My Orders link
      function checkForOrders() {
        // First check localStorage for immediate feedback
        if (localStorage.getItem('hasOrders') === 'true') {
          document.getElementById('myOrdersLink').style.display = 'inline-block';
          document.getElementById('myOrdersLinkSidebar').style.display = 'block';
        }
        
        // Then verify with server
        fetch('/api/user_orders')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.orders && data.orders.length > 0) {
              document.getElementById('myOrdersLink').style.display = 'inline-block';
              document.getElementById('myOrdersLinkSidebar').style.display = 'block';
              localStorage.setItem('hasOrders', 'true');
            } else {
              localStorage.removeItem('hasOrders');
            }
          })
          .catch(error => console.error('Error checking orders:', error));
      }

      // Fetch the buyer's first name on page load
      window.addEventListener('DOMContentLoaded', (event) => {
        fetch('/get_buyer_name')
          .then(response => response.json())
          .then(data => {
            document.getElementById('buyerFirstName').textContent = data.firstName;
            document.getElementById('buyerFirstNameSidebar').textContent = data.firstName;
          })
          .catch(error => console.error('Error fetching buyer name:', error));
        
        // Check if buyer has orders to show My Orders link
        checkForOrders();
        
        // Load products for browse section
        loadBrowseProducts();
      });

      // Function to load and display products in browse section
      function loadBrowseProducts() {
        fetch('/api/products')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.products) {
              const browseGrid = document.getElementById('browseGrid');
              browseGrid.innerHTML = data.products.map(product => `
                <a href="/product/${product.id}" style="text-decoration:none;color:inherit">
                  <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s" 
                       onmouseover="this.style.transform='translateY(-4px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                    <div style="height:200px;background:#f5f5f5;background-image:url('${product.image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=800&auto=format&fit=crop'}');background-size:cover;background-position:center"></div>
                    <div style="padding:16px">
                      <h3 style="margin:0 0 8px;font-size:16px;font-weight:600;line-height:1.3">${product.name}</h3>
                      <p style="margin:0;color:#666;font-size:14px">‚Ç±${parseFloat(product.price).toFixed(2)}</p>
                    </div>
                  </div>
                </a>
              `).join('');
            }
          })
          .catch(error => {
            console.error('Error loading browse products:', error);
            document.getElementById('browseGrid').innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#999">Error loading products</p>';
          });
      }

      // Track Order Form Handler
      const trackingForm = document.getElementById('trackingForm');
      if (trackingForm) {
        trackingForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const orderNumber = document.getElementById('trackingOrderNumber').value.trim();
          
          if (!orderNumber) {
            alert('Please enter an order number');
            return;
          }
          
          // Fetch order tracking information
          fetch(`/api/track_order/${orderNumber}`)
            .then(response => response.json())
            .then(data => {
              const resultDiv = document.getElementById('trackingResult');
              const detailsDiv = document.getElementById('trackingDetails');
              
              if (data.success) {
                const order = data.order;
                let statusHtml = `
                  <div><strong>Order #:</strong> ${order.id}</div>
                  <div><strong>Status:</strong> ${order.status || 'Processing'}</div>
                  <div><strong>Total:</strong> ‚Ç±${parseFloat(order.total).toFixed(2)}</div>
                `;
                
                if (order.tracking_number) {
                  statusHtml += `<div><strong>Tracking #:</strong> ${order.tracking_number}</div>`;
                }
                
                if (order.estimated_delivery) {
                  statusHtml += `<div><strong>Est. Delivery:</strong> ${order.estimated_delivery}</div>`;
                }
                
                detailsDiv.innerHTML = statusHtml;
                resultDiv.style.display = 'block';
              } else {
                detailsDiv.innerHTML = `<div style="color:#dc2626">Order not found. Please check your order number.</div>`;
                resultDiv.style.display = 'block';
              }
            })
            .catch(error => {
              console.error('Error tracking order:', error);
              document.getElementById('trackingDetails').innerHTML = '<div style="color:#dc2626">Error loading order information.</div>';
              document.getElementById('trackingResult').style.display = 'block';
            });
        });
      }

      // Cart functionality
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');

      // Quick add to cart from product grid
      function quickAddToCart(event, productId, productName, productPrice, productImage) {
        event.preventDefault();
        event.stopPropagation();
        
        const imageUrl = productImage || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=200&auto=format&fit=crop';
        
        // Check if item already exists in cart
        const existingItemIndex = cart.findIndex(item => item.id === productId && item.name === productName);
        
        if (existingItemIndex > -1) {
          // Item exists, increase quantity
          cart[existingItemIndex].quantity += 1;
          showSnackbar('Item quantity updated in cart');
        } else {
          // New item, add to cart
          cart.push({ 
            id: productId,
            name: productName, 
            price: productPrice, 
            quantity: 1, 
            image_url: imageUrl 
          });
          showSnackbar('Added to cart');
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();
      }

      // Update cart badge count
      function updateCartBadge() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCount = document.getElementById('cartCount');
        const cartCountSidebar = document.getElementById('cartCountSidebar');
        if (cartCount) cartCount.textContent = totalItems;
        if (cartCountSidebar) cartCountSidebar.textContent = totalItems;
      }

      // Show snackbar notification
      function showSnackbar(message) {
        const snackbar = document.getElementById('snackbar');
        if (snackbar) {
          snackbar.textContent = message;
          snackbar.classList.add('show');
          setTimeout(() => {
            snackbar.classList.remove('show');
          }, 3000);
        }
      }

      // Open cart modal
      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.setAttribute('aria-hidden', 'false');
          modal.style.display = 'flex';
          updateCartDisplay();
        }
      }

      // Close modal
      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.setAttribute('aria-hidden', 'true');
          modal.style.display = 'none';
        }
      }

      // Update cart display in modal
      function updateCartDisplay() {
        const cartList = document.getElementById('cartList');
        const cartTotal = document.getElementById('cartTotal');
        const cartSubtotal = document.getElementById('cartSubtotal');
        
        if (!cartList) return;
        
        if (cart.length === 0) {
          cartList.innerHTML = `
            <div class="empty-cart-state" style="text-align:center;padding:60px 20px">
              <div style="font-size:80px;color:#ddd;margin-bottom:16px">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:inline-block">
                  <path d="M9 2L7.17 4H3c-.55 0-1 .45-1 1s.45 1 1 1h1l1.6 8.6c.18 1 1.05 1.73 2.06 1.73h7.72c1.01 0 1.88-.73 2.06-1.73L19 6h1c.55 0 1-.45 1-1s-.45-1-1-1h-4.17L14 2H9z"/>
                  <circle cx="9" cy="20" r="1"/>
                  <circle cx="16" cy="20" r="1"/>
                </svg>
              </div>
              <h3 style="font-size:18px;font-weight:400;color:#999;margin:0 0 8px">Your cart is empty</h3>
              <p style="font-size:14px;color:#bbb;margin:0">Add some products to get started!</p>
            </div>
          `;
        } else {
          cartList.innerHTML = cart.map((item, index) => {
            const imageUrl = item.image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=200&auto=format&fit=crop';
            return `
              <div style="display:flex;gap:16px;padding:16px;border-bottom:1px solid #eee;align-items:center">
                <img src="${imageUrl}" alt="${item.name}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;background:#f5f5f5">
                <div style="flex:1">
                  <h4 style="margin:0 0 4px;font-size:14px;font-weight:500">${item.name}</h4>
                  <p style="margin:0;color:#666;font-size:14px">‚Ç±${parseFloat(item.price).toFixed(2)}</p>
                  <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
                    <button onclick="decreaseQuantity(${index})" style="width:28px;height:28px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;font-size:16px">‚àí</button>
                    <span style="min-width:30px;text-align:center;font-weight:500">${item.quantity}</span>
                    <button onclick="increaseQuantity(${index})" style="width:28px;height:28px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;font-size:16px">+</button>
                    <button onclick="removeFromCart(${index})" style="margin-left:auto;color:#dc2626;background:none;border:none;cursor:pointer;font-size:12px">Remove</button>
                  </div>
                </div>
              </div>
            `;
          }).join('');
        }
        
        // Update totals
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        if (cartTotal) cartTotal.textContent = `‚Ç±${total.toFixed(2)}`;
        if (cartSubtotal) cartSubtotal.textContent = `‚Ç±${total.toFixed(2)}`;
      }

      // Increase item quantity
      function increaseQuantity(index) {
        if (cart[index]) {
          cart[index].quantity += 1;
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartDisplay();
          updateCartBadge();
        }
      }

      // Decrease item quantity
      function decreaseQuantity(index) {
        if (cart[index]) {
          if (cart[index].quantity > 1) {
            cart[index].quantity -= 1;
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            updateCartBadge();
          } else {
            removeFromCart(index);
          }
        }
      }

      // Remove item from cart
      function removeFromCart(index) {
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartDisplay();
        updateCartBadge();
        showSnackbar('Item removed from cart');
      }

      // Clear entire cart
      function clearCart() {
        if (cart.length === 0) {
          showSnackbar('Cart is already empty');
          return;
        }
        
        if (confirm('Are you sure you want to clear your cart?')) {
          cart = [];
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartDisplay();
          updateCartBadge();
          showSnackbar('Cart cleared');
        }
      }

      // Checkout button handler
      document.addEventListener('DOMContentLoaded', function() {
        const checkoutBtn = document.getElementById('checkoutBtn');
        if (checkoutBtn) {
          checkoutBtn.addEventListener('click', function() {
            if (cart.length === 0) {
              alert('Your cart is empty. Please add items before checking out.');
              return;
            }
            // Redirect to checkout page
            window.location.href = '/checkout';
          });
        }
      });

      // Initialize cart badge on page load
      updateCartBadge();
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}?v=3"></script>

    <footer class="site-footer">
      <div class="footer-grid">
        <div>
          <h4>Var√≥n</h4>
          <p class="muted">Minimal, responsibly-made apparel. Clean silhouettes and timeless staples.</p>
        </div>
        <div>
          <h5>Shop</h5>
          <ul>
            <li><a href="#">All Products</a></li>
            <li><a href="#">New Arrivals</a></li>
            <li><a href="#">Best Sellers</a></li>
          </ul>
        </div>
        <div>
          <h5>Genres</h5>
          <ul>
            <li><a href="#">Tops</a></li>
            <li><a href="#">Bottoms</a></li>
            <li><a href="#">Outerwear</a></li>
            <li><a href="#">Accessories</a></li>
          </ul>
        </div>
        <div>
          <h5>Partners</h5>
          <ul>
            <li><a href="{{ url_for('signup_seller') }}" id="footerSeller">Register as a seller</a></li>
            <li><a href="{{ url_for('signup_rider') }}" id="footerRider">Register as a rider</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-brand">Var√≥n ‚Äî Minimal Apparel</div>
        <small>¬© <span class="muted">2025</span></small>
      </div>
    </footer>
  </body>
</html>
