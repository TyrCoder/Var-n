<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ product.name }} — Varón</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Commissioner:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
      .user-dropdown {
        position: relative;
        display: inline-block;
      }
      .user-button {
        background: none;
        border: none;
        color: #fff;
        cursor: pointer;
        padding: 8px 12px;
        font-size: 14px;
        border-radius: 4px;
        transition: background 0.2s;
      }
      .user-button:hover {
        background: rgba(255,255,255,0.1);
      }
      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: #fff;
        min-width: 160px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border-radius: 8px;
        margin-top: 8px;
        z-index: 1000;
        overflow: hidden;
      }
      .dropdown-content.show {
        display: block;
      }
      .dropdown-content a {
        color: #0a0a0a;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        transition: background 0.2s;
      }
      .dropdown-content a:hover {
        background: #f3f4f6;
      }
      /* Floating Cart Button */
      .floating-cart {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: #0a0a0a;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 999;
        transition: all 0.3s ease;
      }
      .floating-cart:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      }
      .floating-cart svg {
        width: 24px;
        height: 24px;
        fill: #fff;
      }
      .floating-cart-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ef4444;
        color: #fff;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        border: 2px solid #fff;
      }
      @media (max-width: 768px) {
        .floating-cart {
          bottom: 20px;
          right: 20px;
          width: 50px;
          height: 50px;
        }
        .floating-cart svg {
          width: 20px;
          height: 20px;
        }
      }
    </style>
    <style>
      .product-page {
        max-width: 1200px;
        margin: 80px auto 60px;
        padding: 0 20px;
      }
      .product-container {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 60px;
      }
      .product-images {
        position: sticky;
        top: 80px;
        height: fit-content;
      }
      .main-image {
        width: 100%;
        height: 600px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        background-color: #f8f8f8;
        margin-bottom: 20px;
        border-radius: 8px;
        cursor: zoom-in;
        transition: background-size 0.4s ease, background-position 0.1s ease;
        overflow: hidden;
        position: relative;
      }
      .main-image:hover {
        background-size: 180%;
      }
      .thumbnails {
        display: flex;
        gap: 10px;
        overflow-x: auto;
      }
      .thumbnail {
        width: 80px;
        height: 80px;
        background-size: cover;
        background-position: center;
        background-color: #f8f8f8;
        border-radius: 4px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border 0.2s;
      }
      .thumbnail:hover, .thumbnail.active {
        border-color: #0a0a0a;
      }
      .product-info h1 {
        font-size: 24px;
        font-weight: 600;
        margin: 0 0 12px;
        line-height: 1.4;
      }
      .product-price {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .tax-info {
        font-size: 13px;
        color: #666;
        margin-bottom: 24px;
      }
      .selection-group {
        margin-bottom: 28px;
      }
      .selection-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        font-size: 14px;
        font-weight: 600;
      }
      .selection-label span {
        font-weight: 400;
        color: #666;
      }
      .color-swatches {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .color-swatch {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        border: 2px solid #e0e0e0;
        cursor: pointer;
        position: relative;
        transition: all 0.2s;
      }
      .color-swatch:hover {
        transform: scale(1.1);
      }
      .color-swatch.selected {
        border-color: #0a0a0a;
        box-shadow: 0 0 0 2px #fff, 0 0 0 4px #0a0a0a;
      }
      .size-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
      }
      .size-btn {
        padding: 12px;
        border: 1px solid #e0e0e0;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        border-radius: 4px;
        transition: all 0.2s;
        text-align: center;
      }
      .size-btn:hover {
        border-color: #0a0a0a;
      }
      .size-btn.selected {
        background: #0a0a0a;
        color: #fff;
        border-color: #0a0a0a;
      }
      .quantity-control {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .qty-btn {
        width: 44px;
        height: 44px;
        border: 1px solid #e0e0e0;
        background: #fff;
        cursor: pointer;
        font-size: 20px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .qty-btn:hover {
        border-color: #0a0a0a;
      }
      .qty-input {
        width: 70px;
        height: 44px;
        text-align: center;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 500;
      }
      .stock-status {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #10b981;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 20px;
      }
      .add-to-cart-btn {
        width: 100%;
        padding: 16px;
        background: #0a0a0a;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 16px;
      }
      .add-to-cart-btn:hover:not(:disabled) {
        background: #2d2d2d;
      }
      .add-to-cart-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .product-details {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid #e0e0e0;
      }
      .details-section {
        margin-bottom: 20px;
      }
      .details-section h3 {
        font-size: 14px;
        font-weight: 600;
        margin: 0 0 10px;
      }
      .details-section p {
        font-size: 14px;
        line-height: 1.7;
        color: #666;
        margin: 0;
      }
      .product-meta {
        display: grid;
        gap: 8px;
        margin-top: 16px;
      }
      .meta-item {
        font-size: 13px;
        color: #666;
      }
      .meta-item strong {
        color: #0a0a0a;
        font-weight: 600;
      }
      @media (max-width: 768px) {
        .product-container {
          grid-template-columns: 1fr;
          gap: 30px;
        }
        .product-images {
          position: relative;
          top: 0;
        }
        .size-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      /* Cart Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .cart-card {
        background: #fff;
        border-radius: 16px;
        max-width: 700px;
        width: 100%;
        max-height: 85vh;
        overflow-y: auto;
        padding: 32px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      }
      .cart-card h2 {
        font-size: 28px;
        margin-bottom: 24px;
        font-weight: 600;
      }
      .cart-list {
        max-height: 450px;
        overflow-y: auto;
        margin-bottom: 24px;
      }
      .cart-item {
        display: flex;
        gap: 16px;
        padding: 16px;
        border-bottom: 1px solid #e0e0e0;
        align-items: center;
      }
      .cart-item-info {
        flex: 1;
      }
      .cart-item-info h4 {
        margin: 0 0 6px;
        font-size: 16px;
        font-weight: 600;
      }
      .cart-item-info p {
        margin: 0;
        color: #666;
        font-size: 15px;
      }
      .cart-actions {
        border-top: 1px solid #e0e0e0;
        padding-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .cart-total {
        font-size: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .btn-cta {
        padding: 12px 24px;
        background: #0a0a0a;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
      }
      .btn-cta:hover {
        background: #2d2d2d;
      }
      .snackbar {
        visibility: hidden;
        min-width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 8px;
        padding: 16px;
        position: fixed;
        z-index: 10001;
        left: 50%;
        bottom: 30px;
        transform: translateX(-50%);
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      .snackbar.show {
        visibility: visible;
        animation: fadein 0.3s, fadeout 0.3s 2.7s;
      }
      @keyframes fadein {
        from { bottom: 0; opacity: 0; }
        to { bottom: 30px; opacity: 1; }
      }
      @keyframes fadeout {
        from { bottom: 30px; opacity: 1; }
        to { bottom: 0; opacity: 0; }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">☰</button>
      <h1 class="brand"><a href="{{ url_for('buyer_dashboard') if session.get('logged_in') and session.get('role') == 'buyer' else url_for('index') }}" style="color:#fff;text-decoration:none">Varón</a></h1>
      <nav class="top-nav" id="topNav">
        <a href="{{ url_for('buyer_dashboard') if session.get('logged_in') and session.get('role') == 'buyer' else url_for('index') }}">Shop</a>
        {% if session.get('logged_in') %}
          <div class="user-dropdown">
            <button class="user-button" onclick="toggleUserDropdown()">
              {{ user_first_name or session.get('first_name', 'User') }} ▾
            </button>
            <div id="userDropdown" class="dropdown-content">
              <a href="{{ url_for('logout') }}">Logout</a>
            </div>
          </div>
        {% else %}
          <a href="{{ url_for('login') }}" id="accountLink" class="account">Login</a>
        {% endif %}
      </nav>
    </header>

    <main class="product-page">
      <div class="product-container">
        <!-- Product Images -->
        <div class="product-images">
          {% if images and images|length > 0 %}
            <div class="main-image" id="mainImage" style="background-image: url('{{ images[0].image_url }}')"></div>
            <div class="thumbnails">
              {% for image in images %}
                <div class="thumbnail {% if loop.first %}active{% endif %}" 
                     data-image="{{ image.image_url }}"
                     style="background-image: url('{{ image.image_url }}')"
                     onclick="changeMainImage('{{ image.image_url }}', this)"></div>
              {% endfor %}
            </div>
          {% else %}
            <div class="main-image" id="mainImage" style="background-image: url('{{ product.image_url or "https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop" }}')"></div>
            <div class="thumbnails">
              <div class="thumbnail active" style="background-image: url('{{ product.image_url or "https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop" }}')"></div>
            </div>
          {% endif %}
        </div>

        <!-- Product Info -->
        <div class="product-info">
          <h1>{{ product.name }}</h1>
          
          <div class="product-price">PHP {{ "{:,.2f}".format(product.price) }}</div>
          <div class="tax-info">Tax included</div>

          <!-- Color Selection -->
          <div class="selection-group">
            <div class="selection-label">
              <strong>Color: <span id="selectedColorName">{% if colors %}Select a color{% else %}One Color{% endif %}</span></strong>
            </div>
            <div class="color-swatches" id="colorSwatches">
              {% if colors and colors|length > 0 %}
                {% for color in colors %}
                  <button class="color-swatch" data-color="{{ color }}" title="{{ color }}" onclick="selectColor('{{ color }}')">
                  </button>
                {% endfor %}
              {% else %}
                <span style="color: #999; font-size: 14px;">One Color Available</span>
              {% endif %}
            </div>
          </div>

          <!-- Size Selection -->
          <div class="selection-group">
            <div class="selection-label">
              <strong>Size: <span id="selectedSizeName">{% if sizes %}Select a size{% else %}One Size{% endif %}</span></strong>
              <a href="#" style="font-size: 13px; color: #0a0a0a; text-decoration: underline;">Size Guide</a>
            </div>
            <div class="size-grid" id="sizeGrid">
              {% if sizes and sizes|length > 0 %}
                {% for size in sizes %}
                  <button class="size-btn" onclick="selectSize('{{ size }}')">{{ size }}</button>
                {% endfor %}
              {% else %}
                <span style="color: #999; font-size: 14px;">One Size Available</span>
              {% endif %}
            </div>
          </div>

          <!-- Quantity -->
          <div class="selection-group">
            <div class="selection-label">
              <strong>Quantity</strong>
            </div>
            <div class="quantity-control">
              <button class="qty-btn" onclick="decreaseQuantity()">−</button>
              <input type="number" class="qty-input" id="quantity" value="1" min="1" readonly>
              <button class="qty-btn" onclick="increaseQuantity()">+</button>
            </div>
          </div>

          <!-- Stock Status -->
          <div class="stock-status">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            In stock
          </div>

          <!-- Add to Cart -->
          <button class="add-to-cart-btn" id="addToCartBtn" onclick="addToCartFromPage()" disabled>
            Select Size and Color
          </button>

          <!-- Product Details -->
          <div class="product-details">
            <div class="details-section">
              <h3>Product Details</h3>
              <p>{{ product.description or 'High-quality product crafted with attention to detail. Made from premium materials for lasting comfort and style.' }}</p>
            </div>

            <div class="product-meta">
              <div class="meta-item"><strong>Brand:</strong> {{ product.brand or 'Varón' }}</div>
              <div class="meta-item"><strong>SKU:</strong> {{ product.sku or '-' }}</div>
              <div class="meta-item"><strong>Category:</strong> {{ product.category_name or 'Apparel' }}</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="footer-grid">
        <div>
          <h4>Varón</h4>
          <p class="muted">Minimal, responsibly-made apparel.</p>
        </div>
        <div>
          <h5>Shop</h5>
          <ul>
            <li><a href="{{ url_for('index') }}">All Products</a></li>
          </ul>
        </div>
      </div>
    </footer>

    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <script>
      let selectedColor = {% if not colors %}'Standard'{% else %}null{% endif %};
      let selectedSize = {% if not sizes %}'One Size'{% else %}null{% endif %};

      // Color hex mapping - expanded list
      const colorHex = {
        'Black': '#000000', 'White': '#FFFFFF', 'Gray': '#808080', 'Grey': '#808080',
        'Navy': '#000080', 'Blue': '#0000FF', 'Red': '#FF0000', 'Pink': '#FFC0CB',
        'Green': '#008000', 'Brown': '#8B4513', 'Beige': '#F5F5DC', 'Cream': '#FFFDD0',
        'Khaki': '#C3B091', 'Burgundy': '#800020', 'Olive': '#808000', 'Orange': '#FF8C00',
        'Charcoal': '#36454F', 'Yellow': '#FFD700', 'Purple': '#800080', 'Violet': '#8B00FF',
        'Maroon': '#800000', 'Tan': '#D2B48C', 'Ivory': '#FFFFF0', 'Silver': '#C0C0C0',
        'Gold': '#FFD700', 'Indigo': '#4B0082', 'Teal': '#008080', 'Cyan': '#00FFFF',
        'Magenta': '#FF00FF', 'Lime': '#00FF00', 'Coral': '#FF7F50', 'Peach': '#FFE5B4',
        'Lavender': '#E6E6FA', 'Mint': '#98FF98', 'Sky Blue': '#87CEEB', 'Dark Blue': '#00008B'
      };

      // Apply color swatches with better fallback
      document.querySelectorAll('.color-swatch').forEach(swatch => {
        const color = swatch.getAttribute('data-color');
        let hex = colorHex[color];
        
        // If no exact match, try to find a partial match
        if (!hex) {
          const colorLower = color.toLowerCase();
          for (const [key, value] of Object.entries(colorHex)) {
            if (key.toLowerCase().includes(colorLower) || colorLower.includes(key.toLowerCase())) {
              hex = value;
              break;
            }
          }
        }
        
        // Final fallback - generate a color from the name
        if (!hex) {
          hex = '#' + color.split('').reduce((acc, char) => {
            return ((acc << 5) - acc + char.charCodeAt(0)).toString(16).substr(0, 6).padEnd(6, '0');
          }, 0).substr(0, 6);
        }
        
        swatch.style.backgroundColor = hex;
        
        // Add border for light colors
        if (color.toLowerCase().includes('white') || color.toLowerCase().includes('ivory') || 
            color.toLowerCase().includes('cream') || color.toLowerCase().includes('beige')) {
          swatch.style.border = '2px solid #e0e0e0';
        }
      });

      // Change main image when thumbnail is clicked
      function changeMainImage(imageUrl, thumbnail) {
        document.getElementById('mainImage').style.backgroundImage = `url('${imageUrl}')`;
        
        // Update active state
        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
        thumbnail.classList.add('active');
      }

      // Image zoom effect on hover with mouse tracking
      const mainImage = document.getElementById('mainImage');
      if (mainImage) {
        mainImage.addEventListener('mousemove', function(e) {
          const rect = this.getBoundingClientRect();
          const x = ((e.clientX - rect.left) / rect.width) * 100;
          const y = ((e.clientY - rect.top) / rect.height) * 100;
          
          this.style.backgroundPosition = `${x}% ${y}%`;
        });
        
        mainImage.addEventListener('mouseleave', function() {
          this.style.backgroundPosition = 'center';
        });
      }

      function selectColor(color) {
        selectedColor = color;
        document.getElementById('selectedColorName').textContent = color;
        
        document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
        event.target.classList.add('selected');
        
        checkSelection();
      }

      function selectSize(size) {
        selectedSize = size;
        document.getElementById('selectedSizeName').textContent = size;
        
        document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
        event.target.classList.add('selected');
        
        checkSelection();
      }

      function checkSelection() {
        const btn = document.getElementById('addToCartBtn');
        if (selectedSize && selectedColor) {
          btn.disabled = false;
          btn.textContent = 'Add to Cart';
          btn.style.opacity = '1';
          btn.style.cursor = 'pointer';
        } else {
          btn.disabled = true;
          const missing = [];
          if (!selectedSize && {% if sizes and sizes|length > 0 %}true{% else %}false{% endif %}) missing.push('Size');
          if (!selectedColor && {% if colors and colors|length > 0 %}true{% else %}false{% endif %}) missing.push('Color');
          btn.textContent = missing.length > 0 ? `Select ${missing.join(' and ')}` : 'Add to Cart';
          btn.style.opacity = '0.6';
          btn.style.cursor = 'not-allowed';
        }
      }

      function increaseQuantity() {
        const input = document.getElementById('quantity');
        input.value = parseInt(input.value) + 1;
      }

      function decreaseQuantity() {
        const input = document.getElementById('quantity');
        if (parseInt(input.value) > 1) {
          input.value = parseInt(input.value) - 1;
        }
      }

      // Check if user is logged in (server-side check)
      const isUserLoggedIn = {{ 'true' if session.get('logged_in') else 'false' }};
      
      async function addToCartFromPage() {
        // Check if user is logged in
        if (!isUserLoggedIn) {
          alert('You need to log in to add items to cart');
          window.location.href = '/login';
          return;
        }
        
        if (selectedSize && selectedColor) {
          const quantity = parseInt(document.getElementById('quantity').value);
          const productId = {{ product.id }};
          const productName = '{{ product.name }}';
          
          // Use VaronCart if available (database cart)
          if (window.VaronCart) {
            const success = await VaronCart.add(productId, quantity);
            if (success) {
              // Update cart badge
              await VaronCart.updateBadge();
              
              // Show success message
              const snackbar = document.getElementById('snackbar');
              snackbar.textContent = `Added ${quantity} item(s) to cart`;
              snackbar.classList.add('show');
              setTimeout(() => snackbar.classList.remove('show'), 3000);
            } else {
              alert('Failed to add item to cart. Please try again.');
            }
          } else {
            // Fallback to localStorage cart
            const productPrice = {{ product.price }};
            const productImage = {% if images and images|length > 0 %}'{{ images[0].image_url }}'{% else %}'{{ product.image_url }}'{% endif %};
            const itemName = `${productName} (${selectedSize}, ${selectedColor})`;
            
            for (let i = 0; i < quantity; i++) {
              addToCart(itemName, productPrice, productId, productImage);
            }
            
            // Show success message
            const snackbar = document.getElementById('snackbar');
            snackbar.textContent = `Added ${quantity} item(s) to cart`;
            snackbar.classList.add('show');
            setTimeout(() => snackbar.classList.remove('show'), 3000);
          }
        }
      }

      // Check initial selection state
      checkSelection();

      // User dropdown toggle
      function toggleUserDropdown() {
        const dropdown = document.getElementById('userDropdown');
        if (dropdown) dropdown.classList.toggle('show');
      }

      // Close dropdown when clicking outside
      window.addEventListener('click', function(e) {
        if (!e.target.matches('.user-button') && !e.target.closest('.user-button')) {
          const dropdown = document.getElementById('userDropdown');
          if (dropdown && dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
          }
        }
      });

      // Modal functionality
      function openCartModal() {
          const modal = document.getElementById('cartModal');
          if (modal) {
              modal.style.display = 'flex';
              modal.setAttribute('aria-hidden', 'false');
          }
      }

      function closeModal(modalId) {
          const modal = document.getElementById(modalId);
          if (modal) {
              modal.style.display = 'none';
              modal.setAttribute('aria-hidden', 'true');
          }
      }

      // Cart functionality - Use VaronCart if available (database), fallback to localStorage
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      // Initialize cart display on page load
      document.addEventListener('DOMContentLoaded', function() {
        if (window.VaronCart) {
          VaronCart.updateBadge();
        } else {
          updateCartDisplay();
        }
      });

      function updateCartDisplay() {
          const cartCount = document.getElementById('cartCount');
          
          // Update cart count badge
          const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
          if (cartCount) cartCount.textContent = itemCount;
      }

      function addToCart(name, price, id, image_url) {
          // Check if item already exists in cart
          const existingItemIndex = cart.findIndex(item => item.id === id && item.name === name);
          
          if (existingItemIndex > -1) {
              // Item exists, increase quantity
              cart[existingItemIndex].quantity += 1;
              showSnackbar('Item quantity updated');
          } else {
              // New item, add to cart
              cart.push({ name, price, id, quantity: 1, image_url: image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=200&auto=format&fit=crop' });
              showSnackbar('Added to cart');
          }
          
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartDisplay();
      }

      function clearCart() {
          if (cart.length === 0) {
              showSnackbar('Cart is already empty');
              return;
          }
          
          if (confirm('Are you sure you want to clear your cart?')) {
              cart = [];
              localStorage.setItem('cart', JSON.stringify(cart));
              updateCartDisplay();
              showSnackbar('Cart cleared');
          }
      }

      function showSnackbar(message) {
          const snackbar = document.getElementById('snackbar');
          if (snackbar) {
              snackbar.textContent = message;
              snackbar.classList.add('show');
              setTimeout(() => {
                  snackbar.classList.remove('show');
              }, 3000);
          }
      }

      // Initialize cart display on page load
      updateCartDisplay();

      // Checkout functionality
      const checkoutBtn = document.getElementById('checkoutBtn');
      if (checkoutBtn) {
          checkoutBtn.addEventListener('click', function() {
              if (cart.length === 0) {
                  showSnackbar('Your cart is empty');
                  return;
              }
              
              // Navigate to checkout page
              window.location.href = '/checkout';
          });
      }
    </script>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal" aria-hidden="true">
      <div class="cart-card">
        <button onclick="closeModal('cartModal')" class="cart-close-btn" aria-label="Close cart">×</button>
        <h2 style="text-align:left;margin-bottom:20px">Your Cart</h2>
        <div id="cartList" class="cart-list">
          <!-- Empty cart state -->
          <div class="empty-cart-state" style="text-align:center;padding:60px 20px">
            <div style="font-size:80px;color:#ddd;margin-bottom:16px">
              <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:inline-block">
                <path d="M9 2L7.17 4H3c-.55 0-1 .45-1 1s.45 1 1 1h1l1.6 8.6c.18 1 1.05 1.73 2.06 1.73h7.72c1.01 0 1.88-.73 2.06-1.73L19 6h1c.55 0 1-.45 1-1s-.45-1-1-1h-4.17L14 2H9z"/>
                <circle cx="9" cy="20" r="1"/>
                <circle cx="16" cy="20" r="1"/>
              </svg>
            </div>
            <h3 style="font-size:18px;font-weight:400;color:#999;margin:0 0 8px">Your cart is empty</h3>
            <p style="font-size:14px;color:#bbb;margin:0">Add some products to get started!</p>
          </div>
        </div>
        <div class="cart-totals">
          <div style="padding:24px 0;border-top:1px solid #eee">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <span style="color:#666;font-size:15px">Subtotal:</span>
              <span style="font-size:16px;font-weight:500" id="cartSubtotal">₱0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
              <span style="font-size:18px;font-weight:600;color:#0a0a0a">Total:</span>
              <span style="font-size:20px;font-weight:600;color:#0a0a0a" id="cartTotal">₱0.00</span>
            </div>
          </div>
          <div style="display:flex;gap:12px">
            <button id="clearCart" class="btn-secondary" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;border:1px solid #e0e0e0;background:#fff;color:#0a0a0a;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#f8f8f8'" onmouseout="this.style.background='#fff'">CLEAR CART</button>
            <button id="checkoutBtn" class="btn-cta" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;background:#0a0a0a;color:#fff;border:none;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#2d2d2d'" onmouseout="this.style.background='#0a0a0a'">PROCEED TO CHECKOUT</button>
          </div>
        </div>
      </div>
    </div>

    <div id="snackbar" class="snackbar" role="status" aria-live="polite">Added to cart</div>

    <!-- Floating Cart Button -->
    <div class="floating-cart" onclick="openCartModal()" title="View Cart">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="9" cy="21" r="1"/>
        <circle cx="20" cy="21" r="1"/>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
      </svg>
      <span class="floating-cart-badge" id="cartCount">0</span>
    </div>

  </body>
</html>
