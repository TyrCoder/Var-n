<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Var√≥n ‚Äî Elegant Men's Fashion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Commissioner:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
      /* Top Bar */
      .top-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 75px;
        background: #ffffff;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 48px;
        z-index: 999;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        backdrop-filter: blur(10px);
      }

      /* Brand Logo */
      .top-brand {
        font-family: 'Playfair Display', serif;
        font-size: 28px;
        font-weight: 600;
        color: #000000;
        letter-spacing: 0.03em;
        margin-right: 48px;
        white-space: nowrap;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }
      .top-brand:hover {
        opacity: 0.7;
      }

      /* Top Bar Left Section */
      .top-bar-left {
        display: flex;
        align-items: center;
        gap: 40px;
      }

      /* Top Navigation Links */
      .top-nav-links {
        display: flex;
        align-items: center;
        gap: 4px;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .top-nav-links li a {
        color: #737373;
        text-decoration: none;
        padding: 10px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        display: block;
        position: relative;
      }
      .top-nav-links li a::after {
        content: '';
        position: absolute;
        bottom: 8px;
        left: 16px;
        right: 16px;
        height: 2px;
        background: #000;
        transform: scaleX(0);
        transition: transform 0.25s ease;
      }
      .top-nav-links li a:hover {
        color: #000000;
        background: #fafafa;
      }
      .top-nav-links li a:hover::after {
        transform: scaleX(1);
      }
      .top-nav-links li a.active {
        background: #000000;
        color: #ffffff;
      }
      .top-nav-links li a.active::after {
        display: none;
      }

      .pagination-controls {
        display: none;
        align-items: center;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
        margin: -12px 0 48px;
      }

      .pagination-controls button {
        border: 1px solid #e5e5e5;
        background: #ffffff;
        color: #0a0a0a;
        padding: 8px 16px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .pagination-controls button:hover:not(:disabled) {
        background: #0a0a0a;
        color: #ffffff;
        border-color: #0a0a0a;
      }

      .pagination-controls button.active {
        background: #0a0a0a;
        color: #ffffff;
        border-color: #0a0a0a;
      }

      .pagination-controls button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }


      /* Shop by Category popup */
      #categoriesContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .subcategory-popover {
        position: absolute;
        top: calc(100% + 10px);
        left: 0;
        min-width: 260px;
        max-width: 320px;
        background: #ffffff;
        border-radius: 14px;
        border: 1px solid rgba(15,23,42,0.08);
        box-shadow: 0 18px 40px rgba(15,23,42,0.25);
        padding: 16px;
        display: none;
        z-index: 40;
      }

      .subcategory-popover.show {
        display: block;
        animation: popoverFade 0.2s ease;
      }

      .subcategory-heading {
        font-size: 13px;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 8px;
      }

      .subcategory-helper {
        font-size: 12px;
        color: #64748b;
        margin-bottom: 12px;
      }

      .subcategory-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 8px;
      }

      .subcategory-item {
        border: 1px solid transparent;
        background: #f8fafc;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 13px;
        font-weight: 500;
        color: #111827;
        text-align: left;
        cursor: pointer;
        transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
      }

      .subcategory-item:hover {
        background: #eef2ff;
        border-color: #c7d2fe;
        transform: translateY(-1px);
      }

      @keyframes popoverFade {
        from {
          opacity: 0;
          transform: translateY(-6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      :root {
        --ink: #0a0a0a;
        --midnight: #0f1115;
        --accent: #f5b754;
        --muted: #9ca3af;
        --surface: #111319;
      }

      .hero {
        position: relative;
        background: radial-gradient(circle at 20% 20%, rgba(245, 183, 84, 0.2), transparent 55%),
                    linear-gradient(135deg, #040404 0%, #090909 35%, #15161d 100%);
        color: #fff;
        min-height: 70vh;
        display: flex;
        align-items: center;
        padding: 140px 0 110px;
        overflow: hidden;
      }

      .hero::after {
        content: '';
        position: absolute;
        inset: 40px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        border-radius: 32px;
        pointer-events: none;
      }

      .hero-inner {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        padding: 0 48px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 48px;
        align-items: center;
      }

      .hero-copy {
        max-width: 560px;
      }

      .hero-eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 999px;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        font-size: 11px;
        color: #e5e7eb;
        margin-bottom: 18px;
      }

      .hero h1 {
        font-size: clamp(42px, 6vw, 64px);
        line-height: 1.05;
        margin: 0 0 20px;
        font-weight: 600;
        letter-spacing: -0.03em;
      }

      .hero p {
        font-size: 17px;
        color: #e1e1e1;
        line-height: 1.7;
        margin: 0 0 26px;
      }

      .hero-cta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .hero-cta .primary {
        background: #fff;
        color: #0a0a0a;
        padding: 12px 34px;
        border-radius: 999px;
        font-weight: 600;
        text-decoration: none;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .hero-cta .primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
      }

      .hero-cta .ghost {
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: #fff;
        padding: 12px 34px;
        border-radius: 999px;
        text-decoration: none;
        font-weight: 600;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .hero-cta .ghost:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .hero-highlights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 16px;
        margin-top: 36px;
      }

      .hero-highlight {
        padding: 18px;
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      .hero-highlight h3 {
        margin: 0;
        font-size: 28px;
        font-weight: 600;
      }

      .hero-highlight span {
        color: #d1d5db;
        font-size: 13px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .hero-media {
        position: relative;
        height: 520px;
        border-radius: 32px;
        background: linear-gradient(120deg, rgba(15, 15, 15, 0.9), rgba(15, 15, 15, 0.4)),
                    url('{{ url_for('static', filename='images/products/5_1764691880494_Joaquin.webp') }}') center/cover;
        box-shadow: 0 40px 120px rgba(0, 0, 0, 0.45);
        overflow: hidden;
      }

      .hero-media::before,
      .hero-media::after {
        content: '';
        position: absolute;
        inset: 24px;
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      .hero-media::after {
        inset: 48px;
        border-color: rgba(255, 255, 255, 0.03);
      }

      .hero-tag {
        position: absolute;
        bottom: 28px;
        left: 32px;
        background: rgba(255, 255, 255, 0.9);
        color: #111;
        padding: 14px 22px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
      }

      #journalSection {
        background: #f7f7f7;
        padding: 90px 20px;
      }

      .section-intro {
        text-align: center;
        margin-bottom: 48px;
      }

      .section-eyebrow {
        font-size: 12px;
        letter-spacing: 0.4em;
        text-transform: uppercase;
        color: #9ca3af;
        margin-bottom: 12px;
      }

      .section-intro h2 {
        font-size: clamp(32px, 4vw, 44px);
        margin: 0 0 14px;
        color: #0f1115;
      }

      .section-intro p {
        margin: 0 auto;
        max-width: 460px;
        color: #6b7280;
        line-height: 1.7;
      }

      .journal-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
      }

      .journal-card {
        background: #fff;
        border-radius: 24px;
        padding: 28px;
        box-shadow: 0 12px 35px rgba(15, 23, 42, 0.08);
        border: 1px solid rgba(227, 232, 239, 0.8);
        min-height: 220px;
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .journal-card span {
        font-size: 12px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #a1a1aa;
      }

      .journal-card h3 {
        margin: 0;
        font-size: 20px;
      }

      .journal-card p {
        margin: 0;
        color: #6b7280;
        line-height: 1.6;
      }

      .journal-card__image {
        width: 100%;
        height: 180px;
        border-radius: 18px;
        background: #f5f5f5 center/cover;
      }

      .journal-card__meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 12px;
        color: #a1a1aa;
        letter-spacing: 0.15em;
        text-transform: uppercase;
      }

      .journal-card__link {
        margin-top: auto;
        font-weight: 600;
        color: #0a0a0a;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: color 0.2s ease;
      }

      .journal-card__link::after {
        content: '‚Üí';
        transition: transform 0.2s ease;
      }

      .journal-card__link:hover::after {
        transform: translateX(4px);
      }

      .about-section {
        background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%);
        padding: 110px 20px;
        position: relative;
      }

      .about-section::before {
        content: '';
        position: absolute;
        inset: 40px;
        border-radius: 32px;
        border: 1px solid rgba(0, 0, 0, 0.03);
        pointer-events: none;
      }

      .about-grid {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 48px;
        position: relative;
        z-index: 2;
      }

      .about-copy h2 {
        font-size: clamp(34px, 4.5vw, 48px);
        margin: 0 0 18px;
        color: #0a0a0a;
      }

      .about-copy p {
        color: #4b5563;
        line-height: 1.8;
        margin-bottom: 16px;
      }

      .about-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.35em;
        color: #a1a1aa;
        border: 1px solid #e4e4e7;
        padding: 6px 16px;
        border-radius: 999px;
        margin-bottom: 16px;
      }

      .about-values {
        display: grid;
        gap: 18px;
        margin-top: 28px;
      }

      .about-value {
        padding: 18px;
        border-radius: 16px;
        border: 1px solid #eee;
        background: #fff;
        display: flex;
        gap: 16px;
        align-items: flex-start;
      }

      .about-value-icon {
        width: 44px;
        height: 44px;
        border-radius: 14px;
        background: #0a0a0a;
        color: #fff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .about-cards {
        display: grid;
        gap: 22px;
      }

      .about-card {
        border-radius: 26px;
        padding: 32px;
        color: #fff;
        position: relative;
        overflow: hidden;
        min-height: 240px;
        background: linear-gradient(135deg, #0a0a0a, #1f1f21);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.25);
      }

      .about-card.accent {
        background: linear-gradient(135deg, #f5b754, #f59e0b);
        color: #111;
      }

      .about-card h3 {
        margin: 0 0 12px;
        font-size: 24px;
      }

      .about-card p {
        margin: 0;
        line-height: 1.7;
      }

      .about-card figure {
        position: absolute;
        inset: 0;
        background: url('https://images.unsplash.com/photo-1475180098004-ca77a66827be?auto=format&fit=crop&w=800&q=80') center/cover;
        opacity: 0.12;
      }

      .about-card.accent figure {
        background-image: url('https://images.unsplash.com/photo-1484516758160-69878111a911?auto=format&fit=crop&w=800&q=80');
        opacity: 0.18;
      }

      .about-card-content {
        position: relative;
        z-index: 2;
      }

      @media (max-width: 768px) {
        .hero {
          padding: 120px 0 80px;
        }
        .hero-media {
          height: 420px;
        }
        .hero::after,
        .about-section::before {
          inset: 16px;
        }
        .hero-cta {
          flex-direction: column;
          align-items: stretch;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Bar with Brand, Navigation and Account Actions -->
    <div class="top-bar">
      <div class="top-bar-left">
        <div class="top-brand" onclick="showSection('home')">Var√≥n</div>
        <ul class="top-nav-links">
          <li><a href="javascript:void(0)" onclick="showSection('home')" class="active">Home</a></li>
          <li><a href="javascript:void(0)" onclick="showSection('browse')">Browse</a></li>
          <li><a href="javascript:void(0)" onclick="showSection('about')">About</a></li>
        </ul>
      </div>
      <div class="top-bar-right">
        <a href="{{ url_for('login') }}"
           class="account-button"
           style="display:inline-flex;align-items:center;justify-content:center;padding:8px 18px;border-radius:999px;border:1px solid #111827;color:#111827;text-decoration:none;font-size:13px;font-weight:500;background:#ffffff;transition:all 0.2s;box-shadow:0 1px 3px rgba(0,0,0,0.06)"
           onmouseover="this.style.background='#111827';this.style.color='#ffffff'"
           onmouseout="this.style.background='#ffffff';this.style.color='#111827'">
          Login
        </a>
      </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-inner">
        <div class="hero-copy">
          <div class="hero-eyebrow">Var√≥n / Manila</div>
          <h1>Menswear redefined for the modern gentleman.</h1>
          <p>Discover contemporary silhouettes, elevated fabrics, and purposeful essentials designed for discerning Filipino men. Each drop is hand-curated with local ateliers and global partners for a seamless wardrobe refresh.</p>
          <div class="hero-cta">
            <a href="javascript:void(0)" onclick="showSection('browse')" class="primary">Shop Now</a>
            <a href="javascript:void(0)" onclick="showSection('about')" class="ghost">Our Story</a>
          </div>
          <div class="hero-highlights">
            <div class="hero-highlight">
              <h3>320+</h3>
              <span>Curated pieces</span>
            </div>
            <div class="hero-highlight">
              <h3>48</h3>
              <span>Partner ateliers</span>
            </div>
            <div class="hero-highlight">
              <h3>24h</h3>
              <span>Metro delivery</span>
            </div>
          </div>
        </div>
        <div class="hero-media">
          <span class="hero-tag">Barong Heritage Capsule ‚Ä¢ Manila</span>
        </div>
      </div>
    </section>

    <!-- Journal Section on Homepage -->
    <section id="journalSection">
      <div class="container" style="max-width:1200px;margin:0 auto">
        <div class="section-intro">
          <div class="section-eyebrow">Journal</div>
          <h2>Stories &amp; Insights</h2>
          <p>Field notes from stylists, tailors, and brand partners on keeping your wardrobe elevated every season.</p>
        </div>
        <div id="journalGrid" class="journal-grid"></div>
      </div>
    </section>

    <!-- Content Sections -->
    <div id="trackOrder" class="content-section" style="display:none">
      <div class="container" style="max-width:600px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">Track Your Order</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <form id="trackingForm" style="display:flex;flex-direction:column;gap:16px">
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Order Number</label>
              <input type="text" placeholder="Enter your order number" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Email</label>
              <input type="email" placeholder="Enter your email address" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <button type="submit" class="btn-cta" style="width:100%">Track Order</button>
          </form>
        </div>

        <div id="browsePagination" class="pagination-controls"></div>
      </div>
    </div>

    <div id="browse" class="content-section" style="display:block">
      <div class="container" style="margin-top:90px;padding-bottom:60px">
        <h2 style="margin:24px 0">Browse Collection</h2>

        <!-- Search + Global Filter Bar -->
        <div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:20px;align-items:center;justify-content:space-between">
          <div style="flex:1;min-width:260px;position:relative">
            <input type="text" id="browseSearch" placeholder="Search products..." style="width:100%;padding:12px 16px;border:1px solid #ddd;border-radius:999px;font-size:14px;outline:none;background:#fff" onkeyup="handleBrowseSearch(event)">
            <span onclick="loadBrowseProducts()" style="position:absolute;right:14px;top:50%;transform:translateY(-50%);color:#999;cursor:pointer;padding:6px" onmouseover="this.style.color='#0a0a0a'" onmouseout="this.style.color='#999'">üîç</span>
          </div>
        </div>

        <div id="browseGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin:24px 0 40px">
          {% if products %}
            {% for product in products %}
              <a href="/product/{{ product.id }}" style="text-decoration:none;color:inherit">
                <article class="product" data-category="men" data-genre="{{ product.category_slug or 'all' }}" data-product-id="{{ product.id }}" style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:transform 0.2s,box-shadow 0.2s;cursor:pointer" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'">
                  <div class="product-image" style="position:relative;width:100%;height:280px;background:#f5f5f5;overflow:hidden">
                    <img src="{{ product.image_url or '/static/images/placeholder.svg' }}" alt="{{ product.name }}" style="width:100%;height:100%;object-fit:cover" onerror="this.src='/static/images/placeholder.svg'">
                  </div>
                  <div class="product-info" style="padding:16px">
                    <h3 style="margin:0 0 8px;font-size:15px;font-weight:500;color:#0a0a0a;line-height:1.3">{{ product.name }}</h3>
                    <div class="price" style="font-size:16px;font-weight:600;color:#0a0a0a;margin-bottom:8px">‚Ç±{{ "{:,.2f}".format(product.price) }}</div>
                    <div style="display:flex;align-items:center;gap:12px;font-size:13px;color:#666;margin-top:8px">
                      <div style="display:flex;align-items:center;gap:4px">
                        <span style="color:#fbbf24;font-size:14px">‚òÖ</span>
                        <span style="font-weight:600;color:#0a0a0a">{{ "%.1f"|format(product.avg_rating or 0) }}</span>
                        <span style="color:#999">({{ product.review_count or 0 }})</span>
                      </div>
                      <div style="border-left:1px solid #e0e0e0;padding-left:12px;color:#666">
                        {{ product.sold_count or 0 }} sold
                      </div>
                    </div>
                  </div>
                </article>
              </a>
            {% endfor %}
          {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
              <h3 style="margin: 0 0 12px; color: #666;">No Products Available</h3>
              <p style="margin: 0; color: #999;">Check back soon for new arrivals!</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div id="about" class="content-section" style="display:none">
      <section class="about-section">
        <div class="about-grid">
          <div class="about-copy">
            <div class="about-pill">About Var√≥n</div>
            <h2>Crafted in Manila, inspired by the world.</h2>
            <p>Var√≥n began in 2025 with a simple idea: elevate everyday wardrobes without losing the warmth of Filipino craftsmanship. Today, we curate limited capsules with independent ateliers, regional sellers, and textile partners who share our obsession for detail.</p>
            <p>Each collection blends breathable tropical fabrics, precise tailoring, and versatile silhouettes so you can move from boardroom to weekend escapes with ease.</p>
            <div class="about-values">
              <div class="about-value">
                <div class="about-value-icon">üå±</div>
                <div>
                  <h4 style="margin:0 0 6px;font-size:16px">Responsible Materials</h4>
                  <p style="margin:0;color:#6b7280;line-height:1.6">Organic cotton, linen, and recycled blends sourced from certified mills across Luzon and Visayas.</p>
                </div>
              </div>
              <div class="about-value">
                <div class="about-value-icon">ü§ù</div>
                <div>
                  <h4 style="margin:0 0 6px;font-size:16px">Community First</h4>
                  <p style="margin:0;color:#6b7280;line-height:1.6">48+ local partner ateliers and riders ensure every order fuels homegrown livelihoods.</p>
                </div>
              </div>
              <div class="about-value">
                <div class="about-value-icon">‚ö°</div>
                <div>
                  <h4 style="margin:0 0 6px;font-size:16px">Seamless Experience</h4>
                  <p style="margin:0;color:#6b7280;line-height:1.6">Same-day Metro deliveries, curated styling notes, and transparent updates in every package.</p>
                </div>
              </div>
            </div>
          </div>
          <div class="about-cards">
            <article class="about-card">
              <figure aria-hidden="true"></figure>
              <div class="about-card-content">
                <h3>Local craft, global polish</h3>
                <p>Lookbook pieces are sketched in Manila and refined with craftsmen from Cebu, Davao, and Iloilo to capture both edge and ease.</p>
              </div>
            </article>
            <article class="about-card accent">
              <figure aria-hidden="true"></figure>
              <div class="about-card-content">
                <h3>Var√≥n in numbers</h3>
                <p style="margin-bottom:14px">From capsule launches to nationwide deliveries, we're constantly raising the bar for Filipino menswear.</p>
                <ul style="list-style:none;padding:0;margin:0;color:#3d2c09;font-weight:600;line-height:1.8">
                  <li>‚Ä¢ 12 seasonal drops per year</li>
                  <li>‚Ä¢ 98% next-day fulfillment in NCR</li>
                  <li>‚Ä¢ 20k+ verified customer reviews</li>
                </ul>
              </div>
            </article>
          </div>
        </div>
      </section>
    </div>


    <footer class="site-footer">
      <div class="footer-grid">
        <div>
          <h4>Var√≥n</h4>
          <p class="muted">Minimal, responsibly-made apparel. Clean silhouettes and timeless staples.</p>
        </div>
        <div>
          <h5>Shop</h5>
          <ul>
            <li><a href="#">All Products</a></li>
            <li><a href="#">New Arrivals</a></li>
            <li><a href="#">Best Sellers</a></li>
          </ul>
        </div>
        <div>
          <h5>Genres</h5>
          <ul>
            <li><a href="#">Tops</a></li>
            <li><a href="#">Bottoms</a></li>
            <li><a href="#">Outerwear</a></li>
            <li><a href="#">Accessories</a></li>
          </ul>
        </div>
        <div>
          <h5>Partners</h5>
          <ul>
            <li><a href="{{ url_for('signup_seller') }}" id="footerSeller">Register as a seller</a></li>
            <li><a href="{{ url_for('signup_rider') }}" id="footerRider">Register as a rider</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-brand">Var√≥n ‚Äî Minimal Apparel</div>
        <small>¬© <span class="muted">2025</span></small>
      </div>
    </footer>




    <script src="{{ url_for('static', filename='js/script.js') }}?v=3"></script>
    <div id="snackbar" class="snackbar" role="status" aria-live="polite">Added to cart</div>

    <div class="overlay" id="overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <a href="{{ url_for('login') }}">Track Your Order</a>
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <a href="{{ url_for('login') }}" class="account">Login</a>
        <a href="{{ url_for('login') }}" class="account">Cart <span id="cartCountSidebar">0</span></a>
      </nav>
    </aside>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal" aria-hidden="true">
      <div class="cart-card">
        <button onclick="closeModal('cartModal')" class="cart-close-btn" aria-label="Close cart">√ó</button>
        <h2 style="text-align:left;margin-bottom:20px">Your Cart</h2>
        <div id="cartList" class="cart-list">
          <!-- Empty cart state -->
          <div class="empty-cart-state" style="text-align:center;padding:60px 20px">
            <div style="font-size:80px;color:#ddd;margin-bottom:16px">
              <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:inline-block">
                <path d="M9 2L7.17 4H3c-.55 0-1 .45-1 1s.45 1 1 1h1l1.6 8.6c.18 1 1.05 1.73 2.06 1.73h7.72c1.01 0 1.88-.73 2.06-1.73L19 6h1c.55 0 1-.45 1-1s-.45-1-1-1h-4.17L14 2H9z"/>
                <circle cx="9" cy="20" r="1"/>
                <circle cx="16" cy="20" r="1"/>
              </svg>
            </div>
            <h3 style="font-size:18px;font-weight:400;color:#999;margin:0 0 8px">Your cart is empty</h3>
            <p style="font-size:14px;color:#bbb;margin:0">Add some products to get started!</p>
          </div>
        </div>
        <div class="cart-totals">
          <div style="padding:24px 0;border-top:1px solid #eee">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <span style="color:#666;font-size:15px">Subtotal:</span>
              <span style="font-size:16px;font-weight:500" id="cartSubtotal">‚Ç±0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
              <span style="font-size:18px;font-weight:600;color:#0a0a0a">Total:</span>
              <span style="font-size:20px;font-weight:600;color:#0a0a0a" id="cartTotal">‚Ç±0.00</span>
            </div>
          </div>
          <div style="display:flex;gap:12px">
            <button onclick="clearCart()" class="btn-secondary" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;border:1px solid #e0e0e0;background:#fff;color:#0a0a0a;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#f8f8f8'" onmouseout="this.style.background='#fff'">CLEAR CART</button>
            <button id="checkoutBtn" class="btn-cta" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;background:#0a0a0a;color:#fff;border:none;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#2d2d2d'" onmouseout="this.style.background='#0a0a0a'">PROCEED TO CHECKOUT</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Clear Cart Modal -->
    <div id="clearModal" class="modal" aria-hidden="true">
      <div class="modal-panel">
        <button class="modal-close" onclick="closeModal('clearModal')">√ó</button>
        <h2 style="margin:0 0 8px">Clear Cart?</h2>
        <p style="margin:0 0 18px;color:var(--muted)">Are you sure you want to remove all items from your cart?</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('clearModal')" class="btn-cta" style="background:#f6f6f6;color:#0a0a0a">Cancel</button>
          <button id="confirmClearYes" class="btn-cta">Yes, Clear Cart</button>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal" aria-hidden="true">
      <div class="modal-panel checkout">
        <button class="modal-close" onclick="closeModal('checkoutModal')" style="color:#fff">√ó</button>
        <h2 style="color:#fff;margin:0 0 8px">Checkout</h2>
        <p class="muted" style="margin:0 0 18px">Review your order before proceeding to payment</p>
        <div id="checkoutSummary" style="margin-bottom:18px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('checkoutModal')" class="secondary">Cancel</button>
          <button id="proceedCheckout" class="btn-cta">Proceed to Payment</button>
        </div>
      </div>
    </div>

    <script>

      function showSection(sectionName) {

        document.querySelectorAll('.content-section').forEach(section => {
          section.style.display = 'none';
        });


        const heroSection = document.querySelector('.hero');
        const journalSection = document.getElementById('journalSection');


        if (sectionName === 'home') {

          if (heroSection) heroSection.style.display = 'block';
          if (journalSection) journalSection.style.display = 'block';
        } else {

          if (heroSection) heroSection.style.display = 'none';
          if (journalSection) journalSection.style.display = 'none';


          const targetSection = document.getElementById(sectionName);
          if (targetSection) {
            targetSection.style.display = 'block';
          }
        }


        if (sectionName === 'browse') {
          loadBrowseProducts();
        }


        document.querySelectorAll('.top-nav-links a').forEach(link => {
          link.classList.remove('active');
        });
        const activeLink = document.querySelector(`.top-nav-links a[onclick*="${sectionName}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }


      function getColorBackground(colorName) {
        const colorHex = {
          'Black': '#000000', 'White': '#FFFFFF', 'Gray': '#808080', 'Grey': '#808080',
          'Navy': '#000080', 'Blue': '#0000FF', 'Red': '#FF0000', 'Pink': '#FFC0CB',
          'Green': '#008000', 'Brown': '#8B4513', 'Beige': '#F5F5DC', 'Cream': '#FFFDD0',
          'Khaki': '#C3B091', 'Burgundy': '#800020', 'Olive': '#808000', 'Orange': '#FF8C00',
          'Charcoal': '#36454F', 'Yellow': '#FFD700', 'Purple': '#800080', 'Violet': '#8B00FF',
          'Maroon': '#800000', 'Tan': '#D2B48C', 'Ivory': '#FFFFF0', 'Silver': '#C0C0C0',
          'Gold': '#FFD700', 'Indigo': '#4B0082', 'Teal': '#008080', 'Cyan': '#00FFFF'
        };


        if (colorName.includes('/')) {
          const colors = colorName.split('/').map(c => c.trim());
          const gradientColors = colors.map(c => {
            let hex = colorHex[c];
            if (!hex) {
              const colorLower = c.toLowerCase();
              for (const [key, value] of Object.entries(colorHex)) {
                if (key.toLowerCase().includes(colorLower) || colorLower.includes(key.toLowerCase())) {
                  hex = value;
                  break;
                }
              }
            }
            if (!hex) hex = '#' + c.split('').reduce((acc, char) => ((acc << 5) - acc + char.charCodeAt(0)).toString(16).substr(0, 6).padEnd(6, '0'), 0).substr(0, 6);
            return hex;
          });

          if (colors.length === 2) {
            return `linear-gradient(135deg, ${gradientColors[0]} 50%, ${gradientColors[1]} 50%)`;
          } else if (colors.length === 3) {
            return `linear-gradient(135deg, ${gradientColors[0]} 33%, ${gradientColors[1]} 33%, ${gradientColors[1]} 66%, ${gradientColors[2]} 66%)`;
          } else {
            const percentPerColor = 100 / colors.length;
            let gradient = 'linear-gradient(135deg';
            gradientColors.forEach((hex, i) => {
              gradient += `, ${hex} ${i * percentPerColor}%, ${hex} ${(i + 1) * percentPerColor}%`;
            });
            gradient += ')';
            return gradient;
          }
        } else {

          let hex = colorHex[colorName];
          if (!hex) {
            const colorLower = colorName.toLowerCase();
            for (const [key, value] of Object.entries(colorHex)) {
              if (key.toLowerCase().includes(colorLower) || colorLower.includes(key.toLowerCase())) {
                hex = value;
                break;
              }
            }
          }
          if (!hex) hex = '#' + colorName.split('').reduce((acc, char) => ((acc << 5) - acc + char.charCodeAt(0)).toString(16).substr(0, 6).padEnd(6, '0'), 0).substr(0, 6);
          return hex;
        }
      }



      function loadCategories() {
        fetch('/api/categories')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.categories) {
              const categoriesContainer = document.getElementById('categoriesContainer');
              if (categoriesContainer) {
                categoriesContainer.innerHTML = '';
                // Global "All" pill that only filters, does NOT open dropdown
                const allCard = document.createElement('button');
                allCard.type = 'button';
                allCard.style.cssText = 'cursor:pointer;border:none;transition:transform 0.15s,box-shadow 0.15s,background 0.15s,color 0.15s;display:flex;align-items:center;justify-content:center;padding:10px 16px;border-radius:16px;background:#111827;color:#f9fafb;font-size:13px;font-weight:600;letter-spacing:0.04em;text-transform:uppercase;width:100%;height:100%;box-shadow:0 4px 10px rgba(15,23,42,0.18);';
                allCard.textContent = 'All Products';

                allCard.onclick = (e) => {
                  e.stopPropagation();
                  // Close any open category popovers and just reset products
                  document.querySelectorAll('#categoriesContainer .subcategory-popover').forEach(el => {
                    el.classList.remove('show');
                  });
                  loadBrowseProducts();
                };
                allCard.onmouseover = () => {
                  allCard.style.transform = 'translateY(-2px)';
                  allCard.style.boxShadow = '0 6px 16px rgba(15,23,42,0.28)';
                  allCard.style.background = '#030712';
                };
                allCard.onmouseout = () => {
                  allCard.style.transform = 'translateY(0)';
                  allCard.style.boxShadow = '0 4px 10px rgba(15,23,42,0.18)';
                  allCard.style.background = '#111827';
                };

                // Wrap All in same box layout so grid stays uniform
                const allWrapper = document.createElement('div');
                allWrapper.style.cssText = 'background:#f9fafb;border-radius:18px;padding:14px;display:flex;align-items:center;justify-content:center;min-height:96px;';
                allWrapper.appendChild(allCard);
                categoriesContainer.appendChild(allWrapper);

                // Iterate through parent categories (uniform cards)
                data.categories.forEach(parentCategory => {
                  const wrapper = document.createElement('div');
                  // Box that keeps all categories same size
                  wrapper.style.cssText = 'background:#f9fafb;border-radius:18px;padding:14px;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;min-height:96px;position:relative;';

                  const card = document.createElement('button');
                  card.type = 'button';
                  card.style.cssText = 'cursor:pointer;border:none;transition:transform 0.15s,box-shadow 0.15s,background 0.15s,color 0.15s;display:flex;align-items:center;justify-content:center;padding:8px 10px;border-radius:999px;background:#f3f4f6;color:#111827;font-size:12px;font-weight:600;letter-spacing:0.04em;text-transform:uppercase;width:100%;';
                  card.textContent = parentCategory.name;

                  const hasSubcategories = parentCategory.children && parentCategory.children.length > 0;
                  let popover = null;

                  if (hasSubcategories) {
                    popover = document.createElement('div');
                    popover.className = 'subcategory-popover';

                    const heading = document.createElement('div');
                    heading.className = 'subcategory-heading';
                    heading.textContent = `Shop ${parentCategory.name}`;
                    popover.appendChild(heading);

                    const helper = document.createElement('div');
                    helper.className = 'subcategory-helper';
                    helper.textContent = 'Choose a subcategory to refine your picks';
                    popover.appendChild(helper);

                    const grid = document.createElement('div');
                    grid.className = 'subcategory-grid';

                    parentCategory.children.forEach(child => {
                      const item = document.createElement('button');
                      item.type = 'button';
                      item.className = 'subcategory-item';
                      item.textContent = child.name;
                      item.onclick = (e) => {
                        e.stopPropagation();
                        popover.classList.remove('show');
                        loadBrowseProducts([child.id]);
                      };
                      grid.appendChild(item);
                    });

                    popover.appendChild(grid);
                  }

                  if (hasSubcategories) {
                    card.onclick = (e) => {
                      e.stopPropagation();
                      document.querySelectorAll('#categoriesContainer .subcategory-popover.show').forEach(el => {
                        if (el !== popover) {
                          el.classList.remove('show');
                        }
                      });
                      popover.classList.toggle('show');
                    };
                  } else {
                    card.onclick = (e) => {
                      e.stopPropagation();
                      loadBrowseProducts([parentCategory.id]);
                    };
                  }

                  card.onmouseover = () => {
                    card.style.transform = 'translateY(-1px)';
                    card.style.background = '#e5e7eb';
                    card.style.boxShadow = '0 3px 10px rgba(15,23,42,0.18)';
                  };
                  card.onmouseout = () => {
                    card.style.transform = 'translateY(0)';
                    card.style.background = '#f3f4f6';
                    card.style.boxShadow = 'none';
                  };

                  wrapper.appendChild(card);
                  if (popover) {
                    wrapper.appendChild(popover);
                  }
                  categoriesContainer.appendChild(wrapper);
                });

                document.addEventListener('click', (evt) => {
                  const within = categoriesContainer.contains(evt.target);
                  if (!within) {
                    document.querySelectorAll('#categoriesContainer .subcategory-popover.show').forEach(el => el.classList.remove('show'));
                  }
                });
              }
            }
          })
          .catch(error => {
            console.error('Error fetching categories:', error);
          });
      }

      function handleCategoryDropdown() {
        const dropdown = document.getElementById('categoryDropdown');
        const categoryId = dropdown.value;
        
        // Create fake event for handleCategoryFilter
        const fakeEvent = { preventDefault: () => {} };
        handleCategoryFilter(fakeEvent, categoryId);
      }


      let searchTimeout;
      function handleBrowseSearch(event) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          loadBrowseProducts();
        }, 300);
      }


      function handleCategoryFilter(event, categoryId) {
        event.preventDefault();


        const allLinks = document.querySelectorAll('#categoriesContainer a');
        allLinks.forEach(link => {
          if (link.getAttribute('data-category') == categoryId) {
            link.style.color = '#0a0a0a';
            link.style.fontWeight = '600';
            link.style.paddingLeft = '8px';
          } else {
            link.style.color = '#666';
            link.style.fontWeight = '400';
            link.style.paddingLeft = '0';
          }
        });


        loadBrowseProducts(categoryId);
      }


      const browsePaginationState = {
        products: [],
        currentPage: 1,
        perPage: 15
      };

      function getBrowseProductCard(product) {
        const colorSwatches = product.colors && product.colors.length > 0
          ? `<div style="display:flex;gap:4px;margin-top:8px;flex-wrap:wrap;">
              ${product.colors.slice(0, 5).map(color => `
                <div style="width:20px;height:20px;border-radius:50%;background:${getColorBackground(color)};border:1px solid #e0e0e0;" title="${color}"></div>
              `).join('')}
              ${product.colors.length > 5 ? `<span style="font-size:11px;color:#999;align-self:center;">+${product.colors.length - 5}</span>` : ''}
            </div>`
          : '';

        const avgRating = parseFloat(product.avg_rating || 0).toFixed(1);
        const reviewCount = parseInt(product.review_count || 0, 10);
        const soldCount = parseInt(product.sold_count || 0, 10);

        const imageUrl = product.image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=800&auto=format&fit=crop';

        return `
          <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s"
               onclick="if (!isUserLoggedIn) { window.location.href='/login'; } else { window.location.href='/product/${product.id}'; }"
               onmouseover="this.style.transform='translateY(-4px)'"
               onmouseout="this.style.transform='translateY(0)'">
            <div style="height:200px;background:#f5f5f5;background-image:url('${imageUrl}');background-size:cover;background-position:center"></div>
            <div style="padding:16px">
              <h3 style="margin:0 0 8px;font-size:15px;font-weight:500;line-height:1.3">${product.name}</h3>
              <div style="font-size:16px;font-weight:600;color:#0a0a0a;margin-bottom:8px">‚Ç±${parseFloat(product.price).toFixed(2)}</div>
              <div style="display:flex;align-items:center;gap:12px;font-size:13px;color:#666;margin-top:8px">
                <div style="display:flex;align-items:center;gap:4px">
                  <span style="color:#fbbf24;font-size:14px">‚òÖ</span>
                  <span style="font-weight:600;color:#0a0a0a">${avgRating}</span>
                  <span style="color:#999">(${reviewCount})</span>
                </div>
                <div style="border-left:1px solid #e0e0e0;padding-left:12px;color:#666">
                  ${soldCount} sold
                </div>
              </div>
              ${colorSwatches}
            </div>
          </div>
        `;
      }

      function showBrowseMessage(title, subtitle) {
        const browseGrid = document.getElementById('browseGrid');
        const paginationContainer = document.getElementById('browsePagination');
        if (browseGrid) {
          browseGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
              <h3 style="margin: 0 0 12px; color: #666;">${title}</h3>
              <p style="margin: 0; color: #999;">${subtitle}</p>
            </div>
          `;
        }
        if (paginationContainer) {
          paginationContainer.style.display = 'none';
          paginationContainer.innerHTML = '';
        }
      }

      function renderBrowsePaginationControls(totalPages) {
        const paginationContainer = document.getElementById('browsePagination');
        if (!paginationContainer) return;

        if (totalPages <= 1) {
          paginationContainer.style.display = 'none';
          paginationContainer.innerHTML = '';
          return;
        }

        paginationContainer.style.display = 'flex';
        const { currentPage } = browsePaginationState;

        let controlsHtml = `
          <button type="button" data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''} aria-label="Previous page">Prev</button>
        `;

        for (let page = 1; page <= totalPages; page++) {
          controlsHtml += `<button type="button" data-page="${page}" class="${page === currentPage ? 'active' : ''}" aria-label="Go to page ${page}">${page}</button>`;
        }

        controlsHtml += `
          <button type="button" data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''} aria-label="Next page">Next</button>
        `;

        paginationContainer.innerHTML = controlsHtml;
        paginationContainer.querySelectorAll('button').forEach(button => {
          const page = Number(button.getAttribute('data-page'));
          if (!button.disabled && !Number.isNaN(page)) {
            button.addEventListener('click', () => goToBrowsePage(page));
          }
        });
      }

      function renderBrowseProductsGrid() {
        const browseGrid = document.getElementById('browseGrid');
        if (!browseGrid || browsePaginationState.products.length === 0) {
          showBrowseMessage('No Products Found', 'Try adjusting your search or filter criteria.');
          return;
        }

        const totalPages = Math.ceil(browsePaginationState.products.length / browsePaginationState.perPage);
        const startIndex = (browsePaginationState.currentPage - 1) * browsePaginationState.perPage;
        const visibleProducts = browsePaginationState.products.slice(startIndex, startIndex + browsePaginationState.perPage);

        browseGrid.innerHTML = visibleProducts.map(product => getBrowseProductCard(product)).join('');
        renderBrowsePaginationControls(totalPages);
      }

      function goToBrowsePage(page) {
        const totalPages = Math.ceil(browsePaginationState.products.length / browsePaginationState.perPage);
        if (page < 1 || page > totalPages) return;

        browsePaginationState.currentPage = page;
        renderBrowseProductsGrid();

        const browseGrid = document.getElementById('browseGrid');
        if (browseGrid) {
          browseGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }

      function loadBrowseProducts(categoryId) {
        const searchInput = document.getElementById('browseSearch');

        const search = searchInput ? searchInput.value.trim() : '';

        let selectedCategoryId = categoryId;
        if (selectedCategoryId === undefined) {
          const activeLink = document.querySelector('#categoriesContainer a[style*="font-weight: 600"]') || document.querySelector('#categoriesContainer a[style*="fontWeight: 600"]');
          selectedCategoryId = activeLink ? activeLink.getAttribute('data-category') : '';
        }


        const params = new URLSearchParams();
        if (search) params.append('search', search);
        if (selectedCategoryId) {
          if (Array.isArray(selectedCategoryId)) {
            selectedCategoryId.forEach(id => params.append('category_id', id));
          } else {
            params.append('category_id', selectedCategoryId);
          }
        }
        params.append('limit', '50');

        fetch(`/api/products?${params.toString()}`)
          .then(response => response.json())
          .then(data => {
            if (data.success && data.products && data.products.length > 0) {
              browsePaginationState.products = data.products;
              browsePaginationState.currentPage = 1;
              renderBrowseProductsGrid();
            } else {
              browsePaginationState.products = [];
              browsePaginationState.currentPage = 1;
              showBrowseMessage('No Products Found', 'Try adjusting your search or filter criteria.');
            }
          })
          .catch(error => {
            console.error('Error fetching products:', error);
            browsePaginationState.products = [];
            browsePaginationState.currentPage = 1;
            showBrowseMessage('Error Loading Products', 'Please try again later.');
          });
      }


      const isUserLoggedIn = {{ 'true' if session.get('logged_in') else 'false' }};


      const originalAddToCart = window.addToCart;
      window.addToCart = function(name, price, id, quantity = 1) {

        if (!isUserLoggedIn) {
          alert('You need to log in to add items to cart');
          window.location.href = '/login';
          return;
        }

        for (let i = 0; i < quantity; i++) {
          if (originalAddToCart) {
            originalAddToCart(name, price, id);
          }
        }
      };


      function loadJournalEntries() {
        fetch('/api/journal-entries')
          .then(response => response.json())
          .then(data => {
            const journalGrid = document.getElementById('journalGrid');
            if (data.success && data.entries && data.entries.length > 0) {
              journalGrid.innerHTML = data.entries.map(entry => {
                const imageUrl = entry.image_url || 'https://images.unsplash.com/photo-1521334884684-d80222895322?q=80&w=800&auto=format&fit=crop';
                const category = (entry.category || 'Field Notes').toUpperCase();
                const readTime = entry.read_time ? entry.read_time.toUpperCase() : '';
                const linkAttr = entry.link_url ? `onclick="window.open('${entry.link_url}', '_blank')" style="cursor:pointer"` : '';
                const linkMarkup = entry.link_url ? `<a href="${entry.link_url}" target="_blank" rel="noopener" class="journal-card__link">Read article</a>` : '';
                return `
                  <article class="journal-card" ${linkAttr}>
                    <div class="journal-card__image" style="background-image:url('${imageUrl}')"></div>
                    <div class="journal-card__meta">
                      <span>${category}</span>
                      ${readTime ? `<span>${readTime}</span>` : ''}
                    </div>
                    <h3>${entry.title}</h3>
                    <p>${entry.description || ''}</p>
                    ${linkMarkup}
                  </article>
                `;
              }).join('');
            } else {
              journalGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px 20px"><p style="margin:0;color:#999;font-size:14px">No journal entries available yet.</p></div>';
            }
          })
          .catch(error => {
            console.error('Error loading journal entries:', error);
            const journalGrid = document.getElementById('journalGrid');
            journalGrid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px 20px"><p style="margin:0;color:#999;font-size:14px">No journal entries available yet.</p></div>';
          });
      }


      document.addEventListener('DOMContentLoaded', function() {
        loadJournalEntries();
        setupOTPInputs();


        loadCategories();


        loadBrowseProducts();


        document.querySelectorAll('.product').forEach(product => {
          product.addEventListener('click', function(e) {

            if (e.target.classList.contains('add-to-cart')) return;

            const productId = this.getAttribute('data-product-id');
            if (productId && !isUserLoggedIn) {

              window.location.href = '/login';
            } else if (productId) {
              showProductDetail(productId);
            }
          });


          const image = product.querySelector('.product-image');
          const info = product.querySelector('.product-info');
          if (image) image.style.cursor = 'pointer';
          if (info) info.style.cursor = 'pointer';
        });


        document.querySelectorAll('.add-to-cart').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();


            alert('You need to log in to add items to cart');
            window.location.href = '/login';
          });
        });
      });


      let currentForgotPasswordStep = 1;
      let forgotPasswordEmail = '';

      function openForgotPasswordModal() {
        document.getElementById('forgotPasswordModal').style.display = 'flex';
        resetForgotPasswordModal();

        setTimeout(() => {
          setupOTPInputs();
        }, 100);
      }

      function closeForgotPasswordModal() {
        document.getElementById('forgotPasswordModal').style.display = 'none';
        resetForgotPasswordModal();
      }

      function resetForgotPasswordModal() {
        currentForgotPasswordStep = 1;
        forgotPasswordEmail = '';
        document.getElementById('fpStep1').style.display = 'block';
        document.getElementById('fpStep2').style.display = 'none';
        document.getElementById('fpStep3').style.display = 'none';
        document.getElementById('fpEmail').value = '';
        document.querySelectorAll('.fp-otp-input').forEach(input => input.value = '');
        document.getElementById('fpNewPassword').value = '';
        document.getElementById('fpConfirmPassword').value = '';
        document.getElementById('fpErrorMessage').style.display = 'none';
        document.getElementById('fpSuccessMessage').style.display = 'none';
      }

      function showForgotPasswordError(message) {
        const errorEl = document.getElementById('fpErrorMessage');
        errorEl.textContent = message;
        errorEl.style.display = 'block';
        document.getElementById('fpSuccessMessage').style.display = 'none';
      }

      function showForgotPasswordSuccess(message) {
        const successEl = document.getElementById('fpSuccessMessage');
        successEl.textContent = message;
        successEl.style.display = 'block';
        document.getElementById('fpErrorMessage').style.display = 'none';
      }

      async function requestPasswordReset(e) {
        e.preventDefault();
        const email = document.getElementById('fpEmail').value.trim();

        if (!email) {
          showForgotPasswordError('Please enter your email address');
          return;
        }

        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'Sending OTP...';

        try {
          const response = await fetch('/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          const data = await response.json();

          if (data.success) {
            forgotPasswordEmail = email;
            showForgotPasswordSuccess(data.message || 'OTP sent successfully');
            setTimeout(() => {
              document.getElementById('fpStep1').style.display = 'none';
              document.getElementById('fpStep2').style.display = 'block';
              currentForgotPasswordStep = 2;
              document.getElementById('fpSuccessMessage').style.display = 'none';
            }, 1500);
          } else {
            showForgotPasswordError(data.message || data.error || 'An error occurred');
          }
        } catch (error) {
          showForgotPasswordError('Network error. Please try again.');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }

      async function verifyResetOTP(e) {
        e.preventDefault();
        const otpInputs = document.querySelectorAll('.fp-otp-input');
        const otp = Array.from(otpInputs).map(input => input.value).join('');

        if (otp.length !== 6) {
          showForgotPasswordError('Please enter the complete 6-digit code');
          return;
        }

        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'Verifying...';

        try {
          const response = await fetch('/verify-reset-otp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: forgotPasswordEmail, otp })
          });

          const data = await response.json();

          if (data.success) {
            showForgotPasswordSuccess('OTP verified! Please set your new password.');
            setTimeout(() => {
              document.getElementById('fpStep2').style.display = 'none';
              document.getElementById('fpStep3').style.display = 'block';
              currentForgotPasswordStep = 3;
              document.getElementById('fpSuccessMessage').style.display = 'none';
            }, 1500);
          } else {
            showForgotPasswordError(data.message || data.error || 'Invalid OTP');
          }
        } catch (error) {
          showForgotPasswordError('Network error. Please try again.');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }

      async function resetPassword(e) {
        e.preventDefault();
        const newPassword = document.getElementById('fpNewPassword').value;
        const confirmPassword = document.getElementById('fpConfirmPassword').value;

        if (!newPassword || !confirmPassword) {
          showForgotPasswordError('Please fill in both password fields');
          return;
        }

        if (newPassword !== confirmPassword) {
          showForgotPasswordError('Passwords do not match');
          return;
        }

        if (newPassword.length < 6) {
          showForgotPasswordError('Password must be at least 6 characters');
          return;
        }

        if (!/[a-zA-Z]/.test(newPassword) || !/[0-9]/.test(newPassword)) {
          showForgotPasswordError('Password must contain both letters and numbers');
          return;
        }

        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'Resetting...';

        try {
          const response = await fetch('/reset-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ new_password: newPassword })
          });

          const data = await response.json();

          if (data.success) {
            showForgotPasswordSuccess('Password reset successful! Redirecting to login...');
            setTimeout(() => {
              closeForgotPasswordModal();
              window.location.reload();
            }, 2000);
          } else {
            showForgotPasswordError(data.message || data.error || 'Password reset failed');
          }
        } catch (error) {
          showForgotPasswordError('Network error. Please try again.');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }

      async function resendResetOTP() {
        const btn = document.getElementById('fpResendBtn');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = 'Sending...';

        try {
          const response = await fetch('/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: forgotPasswordEmail })
          });

          const data = await response.json();

          if (data.success) {
            showForgotPasswordSuccess('New OTP sent to your email!');
            setTimeout(() => {
              document.getElementById('fpSuccessMessage').style.display = 'none';
            }, 3000);
          } else {
            showForgotPasswordError(data.message || data.error || 'Failed to resend OTP');
          }
        } catch (error) {
          showForgotPasswordError('Network error. Please try again.');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }


      function setupOTPInputs() {
        const inputs = document.querySelectorAll('.fp-otp-input');
        inputs.forEach((input, index) => {
          input.addEventListener('input', (e) => {
            if (e.target.value.length === 1 && index < inputs.length - 1) {
              inputs[index + 1].focus();
            }
          });
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && index > 0) {
              inputs[index - 1].focus();
            }
          });
        });
      }
    </script>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
      <div style="background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
        <button onclick="closeForgotPasswordModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>

        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 10px; color: #0a0a0a;">Reset Password</h2>
        <p style="color: #777; margin-bottom: 30px; font-size: 14px;">Follow the steps to reset your password</p>

        <!-- Error/Success Messages -->
        <div id="fpErrorMessage" style="display: none; background: #fde8e8; color: #dc3545; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;"></div>
        <div id="fpSuccessMessage" style="display: none; background: #d1e7dd; color: #198754; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;"></div>

        <!-- Step 1: Enter Email -->
        <form id="fpStep1" onsubmit="requestPasswordReset(event)">
          <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #0a0a0a; font-size: 14px;">Email Address</label>
            <input type="email" id="fpEmail" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: 'Commissioner', sans-serif;" placeholder="Enter your email">
          </div>
          <button type="submit" style="width: 100%; padding: 14px; background: #0a0a0a; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; font-family: 'Commissioner', sans-serif;">Send Reset Code</button>
        </form>

        <!-- Step 2: Enter OTP -->
        <form id="fpStep2" style="display: none;" onsubmit="verifyResetOTP(event)">
          <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Enter the 6-digit code sent to your email</p>
          <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
            <input type="text" class="fp-otp-input" maxlength="1" required style="width: 50px; height: 50px; text-align: center; font-size: 24px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Commissioner', sans-serif;">
          </div>
          <button type="submit" style="width: 100%; padding: 14px; background: #0a0a0a; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; margin-bottom: 10px; font-family: 'Commissioner', sans-serif;">Verify Code</button>
          <button type="button" id="fpResendBtn" onclick="resendResetOTP()" style="width: 100%; padding: 12px; background: transparent; color: #0a0a0a; border: 1px solid #0a0a0a; border-radius: 8px; font-size: 14px; cursor: pointer; font-family: 'Commissioner', sans-serif;">Resend Code</button>
        </form>

        <!-- Step 3: New Password -->
        <form id="fpStep3" style="display: none;" onsubmit="resetPassword(event)">
          <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #0a0a0a; font-size: 14px;">New Password</label>
            <div style="position: relative;">
              <input type="password" id="fpNewPassword" required style="width: 100%; padding: 12px; padding-right: 45px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: 'Commissioner', sans-serif;" placeholder="Enter new password">
              <button type="button" onclick="togglePasswordVisibility('fpNewPassword', this)" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 5px;">
                <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/></svg>
              </button>
            </div>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #0a0a0a; font-size: 14px;">Confirm Password</label>
            <div style="position: relative;">
              <input type="password" id="fpConfirmPassword" required style="width: 100%; padding: 12px; padding-right: 45px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: 'Commissioner', sans-serif;" placeholder="Confirm new password">
              <button type="button" onclick="togglePasswordVisibility('fpConfirmPassword', this)" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 5px;">
                <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/></svg>
              </button>
            </div>
            <p style="font-size: 12px; color: #777; margin-top: 5px;">Must be at least 6 characters with letters and numbers</p>
          </div>
          <button type="submit" style="width: 100%; padding: 14px; background: #0a0a0a; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; font-family: 'Commissioner', sans-serif;">Reset Password</button>
        </form>
      </div>
    </div>

    <script>

      function togglePasswordVisibility(inputId, button) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
          input.type = 'text';
          button.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z"/></svg>';
        } else {
          input.type = 'password';
          button.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/></svg>';
        }
      }
    </script>
  </body>
</html>
