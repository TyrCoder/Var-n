<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Varón — Elegant Men's Fashion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Commissioner:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>
    <header class="site-header">
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">☰</button>
      <h1 class="brand"><a href="javascript:void(0)" onclick="showSection('home')" style="color:#fff;text-decoration:none">Varón</a></h1>
      <nav class="top-nav" id="topNav">
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <a href="{{ url_for('login') }}" id="accountLink" class="account">Login</a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-inner container">
        <div class="hero-copy">
          <h2>Refined Elegance for the Modern Gentleman</h2>
          <p class="muted">Where sophistication meets contemporary style. Each piece is meticulously crafted to elevate your presence.</p>
          <p><a href="#productGrid" class="btn-cta">Discover Collection</a></p>
        </div>
        <div class="hero-media" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Content Sections -->
    <div id="trackOrder" class="content-section" style="display:none">
      <div class="container" style="max-width:600px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">Track Your Order</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <form id="trackingForm" style="display:flex;flex-direction:column;gap:16px">
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Order Number</label>
              <input type="text" placeholder="Enter your order number" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Email</label>
              <input type="email" placeholder="Enter your email address" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <button type="submit" class="btn-cta" style="width:100%">Track Order</button>
          </form>
        </div>
      </div>
    </div>

    <div id="browse" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Browse Collection</h2>
        <div id="browseGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px">
          <!-- Products will be loaded here -->
        </div>
      </div>
    </div>

    <div id="journal" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Journal</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px">
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1521334884684-d80222895322?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <h3 style="margin:0 0 10px">Style Guide: Fall 2025</h3>
              <p style="margin:0;color:#666;line-height:1.5">Explore our comprehensive guide to fall fashion trends and essential pieces for your wardrobe.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px">Read More</a>
            </div>
          </article>
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1610963876305-c8e7cb43a09b?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <h3 style="margin:0 0 10px">Sustainable Fashion</h3>
              <p style="margin:0;color:#666;line-height:1.5">Learn about our commitment to sustainable practices and ethical fashion production.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px">Read More</a>
            </div>
          </article>
        </div>
      </div>
    </div>

    <div id="about" class="content-section" style="display:none">
      <div class="container" style="max-width:800px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">About Varón</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <p style="line-height:1.6;margin:0 0 20px">Varón is a modern menswear brand focused on creating timeless pieces that combine style, comfort, and sustainability. Our mission is to provide high-quality clothing that stands the test of time.</p>
          <p style="line-height:1.6;margin:0 0 20px">Founded in 2025, we've been dedicated to crafting minimal designs that emphasize quality materials and expert craftsmanship. Every piece in our collection is thoughtfully designed and responsibly made.</p>
          <p style="line-height:1.6;margin:0">Our commitment to sustainability and ethical fashion drives everything we do. We work closely with our partners to ensure responsible production methods and fair labor practices throughout our supply chain.</p>
        </div>
      </div>
    </div>

    <!-- Flash Sales Table (Shopee Style) -->
    <div id="flashSalesSection" class="container" style="display:none;margin-top:40px;margin-bottom:40px">
      <div style="background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);overflow:hidden">
        <!-- Flash Sale Header -->
        <div style="background:linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);padding:20px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px">
          <div style="display:flex;align-items:center;gap:12px">
            <span style="font-size:28px">⚡</span>
            <h2 style="margin:0;color:#fff;font-size:24px;font-weight:600">FLASH SALE</h2>
          </div>
          <div id="flashSaleTimer" style="background:rgba(255,255,255,0.2);padding:8px 16px;border-radius:8px;color:#fff;font-weight:600;font-size:14px">
            ENDING SOON
          </div>
        </div>
        
        <!-- Flash Sale Products Grid -->
        <div id="flashSaleGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1px;background:#f0f0f0;padding:1px">
          <!-- Products will be loaded here -->
        </div>
        
        <div style="text-align:center;padding:20px;background:#fff">
          <button onclick="document.getElementById('productGrid').scrollIntoView({behavior:'smooth'})" style="background:#ff6b6b;color:#fff;border:none;padding:12px 32px;border-radius:8px;font-weight:600;cursor:pointer;font-size:16px;transition:background 0.2s" onmouseover="this.style.background='#ee5a6f'" onmouseout="this.style.background='#ff6b6b'">See All Products →</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container" id="mainContent">
      <section class="toolbar">
        <div class="filters">
          <button data-filter="men" class="active">Men</button>
        </div>
        <div class="genres">
          <label>Category:</label>
          <button data-category="all" class="genre active" onclick="filterProducts('all')">All</button>
          <button data-category="suits-blazers" class="genre" onclick="filterProducts('suits-blazers')">Suits & Blazers</button>
          <button data-category="shoes-accessories" class="genre" onclick="filterProducts('shoes-accessories')">Shoes & Accessories</button>
          <button data-category="outerwear-jackets" class="genre" onclick="filterProducts('outerwear-jackets')">Outerwear & Jackets</button>
          <button data-category="casual-shirts-pants" class="genre" onclick="filterProducts('casual-shirts-pants')">Casual Wear</button>
          <button data-category="activewear-fitness" class="genre" onclick="filterProducts('activewear-fitness')">Activewear</button>
          <button data-category="grooming" class="genre" onclick="filterProducts('grooming')">Grooming</button>
        </div>
      </section>

      <section class="product-grid" id="productGrid">
        {% if products %}
          {% for product in products %}
            <a href="/login" style="text-decoration:none;color:inherit">
              <article class="product" data-category="men" data-genre="{{ product.category_slug or 'all' }}" data-product-id="{{ product.id }}" style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:transform 0.2s,box-shadow 0.2s;cursor:pointer" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'">
                <div class="product-image" style="position:relative;width:100%;height:280px;background:#f5f5f5;background-image:url('{{ product.image_url or 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop' }}');background-size:cover;background-position:center">
                </div>
                <div class="product-info" style="padding:16px">
                  <h3 style="margin:0 0 6px;font-size:15px;font-weight:500;color:#0a0a0a;line-height:1.3">{{ product.name }}</h3>
                  <div class="price" style="font-size:16px;font-weight:600;color:#0a0a0a">₱{{ "{:,.2f}".format(product.price) }}</div>
                </div>
              </article>
            </a>
          {% endfor %}
        {% else %}
          <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
            <h3 style="margin: 0 0 12px; color: #666;">No Products Available</h3>
            <p style="margin: 0; color: #999;">Check back soon for new arrivals!</p>
          </div>
        {% endif %}
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-grid">
        <div>
          <h4>Varón</h4>
          <p class="muted">Minimal, responsibly-made apparel. Clean silhouettes and timeless staples.</p>
        </div>
        <div>
          <h5>Shop</h5>
          <ul>
            <li><a href="#">All Products</a></li>
            <li><a href="#">New Arrivals</a></li>
            <li><a href="#">Best Sellers</a></li>
          </ul>
        </div>
        <div>
          <h5>Genres</h5>
          <ul>
            <li><a href="#">Tops</a></li>
            <li><a href="#">Bottoms</a></li>
            <li><a href="#">Outerwear</a></li>
            <li><a href="#">Accessories</a></li>
          </ul>
        </div>
        <div>
          <h5>Partners</h5>
          <ul>
            <li><a href="{{ url_for('signup_seller') }}" id="footerSeller">Register as a seller</a></li>
            <li><a href="{{ url_for('signup_rider') }}" id="footerRider">Register as a rider</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-brand">Varón — Minimal Apparel</div>
        <small>© <span class="muted">2025</span></small>
      </div>
    </footer>

    


    <script src="{{ url_for('static', filename='js/script.js') }}?v=3"></script>
    <div id="snackbar" class="snackbar" role="status" aria-live="polite">Added to cart</div>
    
    <div class="overlay" id="overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <a href="{{ url_for('login') }}" class="account">Login</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <div id="loginSection" class="content-section" style="display:none">
      <div class="auth-content">
        <!-- Login Form -->
        <form id="loginForm" class="auth-form active" action="{{ url_for('login') }}" method="POST">
          <div class="auth-tabs-inner">
            <div class="tab-link active">Login</div>
            <div class="tab-link">Sign Up</div>
          </div>
          <h2 class="auth-title">Welcome Back</h2>
          <p class="auth-subtitle">Enter your credentials to access your account</p>

          <div class="form-group">
            <label class="form-label" for="loginEmail">
              <svg class="form-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
              </svg>
              Email Address
            </label>
            <input id="loginEmail" class="form-input" name="email" type="email" placeholder="admin@varon.local" required />
          </div>

          <div class="form-group">
            <label class="form-label" for="loginPassword">
              <svg class="form-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
              </svg>
              Password
            </label>
            <div class="password-wrapper">
              <input id="loginPassword" class="form-input" name="password" type="password" placeholder="••••••" required />
              <button type="button" class="toggle-password" onclick="togglePassword('loginPassword', this)" aria-label="Toggle password visibility">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
            </div>
          </div>

          <button type="submit" class="btn-submit">Login to Your Account</button>

          <div class="form-footer">
            <a href="#" class="forgot-link">Forgot your password?</a>
          </div>
        </form>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal" aria-hidden="true">
      <div class="cart-card">
        <button onclick="closeModal('cartModal')" class="cart-close-btn" aria-label="Close cart">×</button>
        <h2 style="text-align:left;margin-bottom:20px">Your Cart</h2>
        <div id="cartList" class="cart-list">
          <!-- Empty cart state -->
          <div class="empty-cart-state" style="text-align:center;padding:60px 20px">
            <div style="font-size:80px;color:#ddd;margin-bottom:16px">
              <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:inline-block">
                <path d="M9 2L7.17 4H3c-.55 0-1 .45-1 1s.45 1 1 1h1l1.6 8.6c.18 1 1.05 1.73 2.06 1.73h7.72c1.01 0 1.88-.73 2.06-1.73L19 6h1c.55 0 1-.45 1-1s-.45-1-1-1h-4.17L14 2H9z"/>
                <circle cx="9" cy="20" r="1"/>
                <circle cx="16" cy="20" r="1"/>
              </svg>
            </div>
            <h3 style="font-size:18px;font-weight:400;color:#999;margin:0 0 8px">Your cart is empty</h3>
            <p style="font-size:14px;color:#bbb;margin:0">Add some products to get started!</p>
          </div>
        </div>
        <div class="cart-totals">
          <div style="padding:24px 0;border-top:1px solid #eee">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <span style="color:#666;font-size:15px">Subtotal:</span>
              <span style="font-size:16px;font-weight:500" id="cartSubtotal">₱0.00</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
              <span style="font-size:18px;font-weight:600;color:#0a0a0a">Total:</span>
              <span style="font-size:20px;font-weight:600;color:#0a0a0a" id="cartTotal">₱0.00</span>
            </div>
          </div>
          <div style="display:flex;gap:12px">
            <button id="clearCart" class="btn-secondary" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;border:1px solid #e0e0e0;background:#fff;color:#0a0a0a;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#f8f8f8'" onmouseout="this.style.background='#fff'">CLEAR CART</button>
            <button id="checkoutBtn" class="btn-cta" style="flex:1;padding:14px;font-size:15px;font-weight:500;border-radius:6px;background:#0a0a0a;color:#fff;border:none;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#2d2d2d'" onmouseout="this.style.background='#0a0a0a'">PROCEED TO CHECKOUT</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Clear Cart Modal -->
    <div id="clearModal" class="modal" aria-hidden="true">
      <div class="modal-panel">
        <button class="modal-close" onclick="closeModal('clearModal')">×</button>
        <h2 style="margin:0 0 8px">Clear Cart?</h2>
        <p style="margin:0 0 18px;color:var(--muted)">Are you sure you want to remove all items from your cart?</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('clearModal')" class="btn-cta" style="background:#f6f6f6;color:#0a0a0a">Cancel</button>
          <button id="confirmClearYes" class="btn-cta">Yes, Clear Cart</button>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal" aria-hidden="true">
      <div class="modal-panel checkout">
        <button class="modal-close" onclick="closeModal('checkoutModal')" style="color:#fff">×</button>
        <h2 style="color:#fff;margin:0 0 8px">Checkout</h2>
        <p class="muted" style="margin:0 0 18px">Review your order before proceeding to payment</p>
        <div id="checkoutSummary" style="margin-bottom:18px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('checkoutModal')" class="secondary">Cancel</button>
          <button id="proceedCheckout" class="btn-cta">Proceed to Payment</button>
        </div>
      </div>
    </div>

    <script>
      // Function to load and display products in browse section
      let activeFlashSales = {};
      
      // Load active flash sales
      function loadFlashSales() {
        fetch('/api/active-flash-sales')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.product_sales) {
              activeFlashSales = data.product_sales;
              
              const section = document.getElementById('flashSalesSection');
              const grid = document.getElementById('flashSaleGrid');
              
              if (Object.keys(activeFlashSales).length > 0 && section && grid) {
                section.style.display = 'block';
                
                // Load products that are on flash sale
                fetch('/products')
                  .then(res => res.json())
                  .then(products => {
                    const saleProducts = products.filter(p => activeFlashSales[p.id]);
                    
                    // Limit to first 6 products for table display
                    const displayProducts = saleProducts.slice(0, 6);
                    
                    grid.innerHTML = displayProducts.map(product => {
                      const sale = activeFlashSales[product.id];
                      const originalPrice = parseFloat(product.price);
                      const salePrice = parseFloat(sale.sale_price);
                      const discount = Math.round(sale.discount_percentage);
                      
                      return `
                        <div style="background:#fff;padding:16px;text-align:center;cursor:pointer;transition:transform 0.2s" 
                             onclick="window.location.href='/product/${product.id}'" 
                             onmouseover="this.style.transform='translateY(-4px)'" 
                             onmouseout="this.style.transform='translateY(0)'">
                          <div style="position:relative;margin-bottom:12px">
                            <img src="/static/images/products/${product.image_url}" 
                                 alt="${product.name}" 
                                 style="width:100%;height:150px;object-fit:cover;border-radius:8px">
                            <span style="position:absolute;top:8px;left:8px;background:#ff6b6b;color:#fff;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600">
                              ${discount}% OFF
                            </span>
                          </div>
                          <h4 style="margin:0 0 8px 0;font-size:14px;color:#333;height:40px;overflow:hidden;line-height:1.4">${product.name}</h4>
                          <div style="margin-bottom:4px">
                            <span style="color:#ff6b6b;font-size:18px;font-weight:700">₱${salePrice.toFixed(2)}</span>
                          </div>
                          <div>
                            <span style="text-decoration:line-through;color:#999;font-size:14px">₱${originalPrice.toFixed(2)}</span>
                          </div>
                          <div style="margin-top:8px;padding:6px;background:#fff5f5;border-radius:4px;font-size:12px;color:#ff6b6b;font-weight:600">
                            ⚡ FLASH SALE
                          </div>
                        </div>
                      `;
                    }).join('');
                  })
                  .catch(err => console.error('Error loading products:', err));
              }
            }
          })
          .catch(error => console.error('Error loading flash sales:', error));
      }
      
      function loadBrowseProducts() {
        fetch('/api/products')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.products) {
              const browseGrid = document.getElementById('browseGrid');
              browseGrid.innerHTML = data.products.map(product => {
                const productId = product.id;
                const hasSale = activeFlashSales[productId];
                const originalPrice = parseFloat(product.price);
                const salePrice = hasSale ? hasSale.sale_price : originalPrice;
                const discount = hasSale ? hasSale.discount_percentage : 0;
                
                return `
                  <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s;position:relative" 
                       onclick="window.location.href='/product/${product.id}'" 
                       onmouseover="this.style.transform='translateY(-4px)'" 
                       onmouseout="this.style.transform='translateY(0)'">
                    ${hasSale ? `<div style="position:absolute;top:8px;left:8px;background:#ff6b6b;color:#fff;padding:6px 12px;border-radius:6px;font-weight:700;font-size:12px;z-index:2;box-shadow:0 2px 8px rgba(255,107,107,0.4)">⚡ ${Math.round(discount)}% OFF</div>` : ''}
                    <div style="height:200px;background:#f5f5f5;background-image:url('${product.image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=800&auto=format&fit=crop'}');background-size:cover;background-position:center"></div>
                    <div style="padding:16px">
                      <h3 style="margin:0 0 8px;font-size:16px;font-weight:600;line-height:1.3">${product.name}</h3>
                      <div style="margin:0;font-size:14px">
                        ${hasSale ? `<span style="text-decoration:line-through;color:#999;font-size:13px;margin-right:8px">₱${originalPrice.toFixed(2)}</span>` : ''}
                        <span style="${hasSale ? 'color:#ff6b6b;font-weight:700;font-size:16px' : 'color:#666'}">₱${salePrice.toFixed(2)}</span>
                      </div>
                    </div>
                  </div>
                `;
              }).join('');
            }
          })
          .catch(error => {
            console.error('Error fetching product details:', error);
          });
      }

      // Category filtering functionality
      function filterProducts(category) {
        // Update active button
        document.querySelectorAll('.genre').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // Get all products
        const products = document.querySelectorAll('.product');
        
        // Filter products
        products.forEach(product => {
          const productCategory = product.getAttribute('data-genre');
          const parentLink = product.closest('a');
          
          if (category === 'all') {
            if (parentLink) parentLink.style.display = 'block';
            else product.style.display = 'block';
          } else {
            // Match exact category slug
            if (productCategory === category) {
              if (parentLink) parentLink.style.display = 'block';
              else product.style.display = 'block';
            } else {
              if (parentLink) parentLink.style.display = 'none';
              else product.style.display = 'none';
            }
          }
        });

        // Check if any products are visible
        const visibleProducts = Array.from(products).filter(p => {
          const parentLink = p.closest('a');
          return parentLink ? parentLink.style.display !== 'none' : p.style.display !== 'none';
        });
        const grid = document.getElementById('productGrid');
        
        // Show message if no products found
        let noProductsMsg = document.getElementById('noProductsMessage');
        if (visibleProducts.length === 0) {
          if (!noProductsMsg) {
            noProductsMsg = document.createElement('div');
            noProductsMsg.id = 'noProductsMessage';
            noProductsMsg.style.cssText = 'grid-column: 1/-1; text-align: center; padding: 60px 20px;';
            noProductsMsg.innerHTML = '<h3 style="margin: 0 0 12px; color: #666;">No Products in This Category</h3><p style="color: #999;">Check back soon for new arrivals!</p>';
            grid.appendChild(noProductsMsg);
          }
        } else if (noProductsMsg) {
          noProductsMsg.remove();
        }
      }

      // Check if user is logged in (server-side check)
      const isUserLoggedIn = {{ 'true' if session.get('logged_in') else 'false' }};
      
      // Update addToCart function to handle quantity and authentication
      const originalAddToCart = window.addToCart;
      window.addToCart = function(name, price, id, quantity = 1) {
        // Check if user is logged in
        if (!isUserLoggedIn) {
          alert('You need to log in to add items to cart');
          window.location.href = '/login';
          return;
        }
        
        for (let i = 0; i < quantity; i++) {
          if (originalAddToCart) {
            originalAddToCart(name, price, id);
          }
        }
      };

      // Add click event to products
      document.addEventListener('DOMContentLoaded', function() {
        // Load flash sales first
        loadFlashSales();
        
        // Handle product card clicks to show detail modal
        document.querySelectorAll('.product').forEach(product => {
          product.addEventListener('click', function(e) {
            // Don't trigger if clicking the add-to-cart button
            if (e.target.classList.contains('add-to-cart')) return;
            
            const productId = this.getAttribute('data-product-id');
            if (productId && !isUserLoggedIn) {
              // Redirect to login if not logged in
              window.location.href = '/login';
            } else if (productId) {
              showProductDetail(productId);
            }
          });
          
          // Make image and info clickable
          const image = product.querySelector('.product-image');
          const info = product.querySelector('.product-info');
          if (image) image.style.cursor = 'pointer';
          if (info) info.style.cursor = 'pointer';
        });
        
        // Handle add-to-cart button clicks - redirect to login for non-logged-in users
        document.querySelectorAll('.add-to-cart').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Cart functionality is disabled on landing page, redirect to login
            alert('You need to log in to add items to cart');
            window.location.href = '/login';
          });
        });
      });
    </script>
  </body>
</html>
