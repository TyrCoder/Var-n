<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Varón — Elegant Men's Fashion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Commissioner:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>
    <header class="site-header">
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">☰</button>
      <h1 class="brand"><a href="javascript:void(0)" onclick="showSection('home')" style="color:#fff;text-decoration:none">Varón</a></h1>
      <nav class="top-nav" id="topNav">
        <a href="javascript:void(0)" onclick="showSection('trackOrder')">Track Your Order</a>
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <a href="{{ url_for('login') }}" id="accountLink" class="account">Login</a>
        <a href="#" onclick="openModal('cartModal')" id="cartToggle" class="account">Cart <span id="cartCount">0</span></a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-inner container">
        <div class="hero-copy">
          <h2>Refined Elegance for the Modern Gentleman</h2>
          <p class="muted">Where sophistication meets contemporary style. Each piece is meticulously crafted to elevate your presence.</p>
          <p><a href="#productGrid" class="btn-cta">Discover Collection</a></p>
        </div>
        <div class="hero-media" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Content Sections -->
    <div id="trackOrder" class="content-section" style="display:none">
      <div class="container" style="max-width:600px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">Track Your Order</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <form id="trackingForm" style="display:flex;flex-direction:column;gap:16px">
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Order Number</label>
              <input type="text" placeholder="Enter your order number" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <div>
              <label style="display:block;margin-bottom:8px;font-weight:500">Email</label>
              <input type="email" placeholder="Enter your email address" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px">
            </div>
            <button type="submit" class="btn-cta" style="width:100%">Track Order</button>
          </form>
        </div>
      </div>
    </div>

    <div id="browse" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Browse Collection</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px">
          <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1617347454431-f49d7ff5c3b1?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:16px">
              <h3 style="margin:0 0 8px">New Arrivals</h3>
              <p style="margin:0;color:#666">Discover our latest collection</p>
            </div>
          </div>
          <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:16px">
              <h3 style="margin:0 0 8px">Best Sellers</h3>
              <p style="margin:0;color:#666">Our most popular items</p>
            </div>
          </div>
          <div style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:16px">
              <h3 style="margin:0 0 8px">Collections</h3>
              <p style="margin:0;color:#666">Curated sets for every style</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="journal" class="content-section" style="display:none">
      <div class="container">
        <h2 style="margin:24px 0">Journal</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:24px">
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1521334884684-d80222895322?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <h3 style="margin:0 0 10px">Style Guide: Fall 2025</h3>
              <p style="margin:0;color:#666;line-height:1.5">Explore our comprehensive guide to fall fashion trends and essential pieces for your wardrobe.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px">Read More</a>
            </div>
          </article>
          <article style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
            <div style="height:200px;background:#f5f5f5;background-image:url('https://images.unsplash.com/photo-1610963876305-c8e7cb43a09b?q=80&w=800&auto=format&fit=crop');background-size:cover"></div>
            <div style="padding:20px">
              <h3 style="margin:0 0 10px">Sustainable Fashion</h3>
              <p style="margin:0;color:#666;line-height:1.5">Learn about our commitment to sustainable practices and ethical fashion production.</p>
              <a href="#" class="btn-cta" style="display:inline-block;margin-top:16px;font-size:14px">Read More</a>
            </div>
          </article>
        </div>
      </div>
    </div>

    <div id="about" class="content-section" style="display:none">
      <div class="container" style="max-width:800px;margin:40px auto;padding:20px">
        <h2 style="margin-bottom:24px;text-align:center">About Varón</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1)">
          <p style="line-height:1.6;margin:0 0 20px">Varón is a modern menswear brand focused on creating timeless pieces that combine style, comfort, and sustainability. Our mission is to provide high-quality clothing that stands the test of time.</p>
          <p style="line-height:1.6;margin:0 0 20px">Founded in 2025, we've been dedicated to crafting minimal designs that emphasize quality materials and expert craftsmanship. Every piece in our collection is thoughtfully designed and responsibly made.</p>
          <p style="line-height:1.6;margin:0">Our commitment to sustainability and ethical fashion drives everything we do. We work closely with our partners to ensure responsible production methods and fair labor practices throughout our supply chain.</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container" id="mainContent">
      <section class="toolbar">
        <div class="filters">
          <button data-filter="men" class="active">Men</button>
        </div>
        <div class="genres">
          <label>Genres:</label>
          <button data-genre="all" class="genre active">All</button>
          <button data-genre="shirts" class="genre">Shirts</button>
          <button data-genre="pants" class="genre">Pants</button>
          <button data-genre="shorts" class="genre">Shorts</button>
          <button data-genre="jackets" class="genre">Jackets</button>
          <button data-genre="shoes" class="genre">Shoes</button>
          <button data-genre="accessories" class="genre">Accessories</button>
          <button data-genre="formal" class="genre">Formal</button>
          <button data-genre="casual" class="genre">Casual</button>
        </div>
      </section>

      <section class="product-grid" id="productGrid">
        {% if products %}
          {% for product in products %}
            <article class="product" data-category="men" data-genre="{{ product.category_slug or 'all' }}" data-product-id="{{ product.id }}">
              <div class="media" style="background-image:url('{{ product.image_url or 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop' }}')"></div>
              <div class="meta">
                <h3 class="title">{{ product.name }}</h3>
                <div class="price">₱{{ "{:,.2f}".format(product.price) }}</div>
              </div>
              <button class="add-cart" aria-label="Add {{ product.name }} to cart" data-name="{{ product.name }}" data-price="{{ product.price }}" data-id="{{ product.id }}">＋</button>
            </article>
          {% endfor %}
        {% else %}
          <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
            <h3 style="margin: 0 0 12px; color: #666;">No Products Available</h3>
            <p style="margin: 0; color: #999;">Check back soon for new arrivals!</p>
          </div>
        {% endif %}
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-grid">
        <div>
          <h4>Varón</h4>
          <p class="muted">Minimal, responsibly-made apparel. Clean silhouettes and timeless staples.</p>
        </div>
        <div>
          <h5>Shop</h5>
          <ul>
            <li><a href="#">All Products</a></li>
            <li><a href="#">New Arrivals</a></li>
            <li><a href="#">Best Sellers</a></li>
          </ul>
        </div>
        <div>
          <h5>Genres</h5>
          <ul>
            <li><a href="#">Tops</a></li>
            <li><a href="#">Bottoms</a></li>
            <li><a href="#">Outerwear</a></li>
            <li><a href="#">Accessories</a></li>
          </ul>
        </div>
        <div>
          <h5>Partners</h5>
          <ul>
            <li><a href="{{ url_for('signup_seller') }}" id="footerSeller">Register as a seller</a></li>
            <li><a href="{{ url_for('signup_rider') }}" id="footerRider">Register as a rider</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-brand">Varón — Minimal Apparel</div>
        <small>© <span class="muted">2025</span></small>
      </div>
    </footer>

    


    <script src="{{ url_for('static', filename='js/script.js') }}?v=3"></script>
    <div id="snackbar" class="snackbar" role="status" aria-live="polite">Added to cart</div>
    
    <div class="overlay" id="overlay"></div>
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <a href="javascript:void(0)" onclick="showSection('trackOrder')">Track Your Order</a>
        <a href="javascript:void(0)" onclick="showSection('browse')">Browse</a>
        <a href="javascript:void(0)" onclick="showSection('journal')">Journal</a>
        <a href="javascript:void(0)" onclick="showSection('about')">About</a>
        <a href="{{ url_for('login') }}" class="account">Login</a>
        <a href="#" onclick="openModal('cartModal')" class="account">Cart <span id="cartCountSidebar">0</span></a>
      </nav>
    </aside>

    <!-- Main Content -->
    <div id="loginSection" class="content-section" style="display:none">
      <div class="auth-content">
        <!-- Login Form -->
        <form id="loginForm" class="auth-form active" action="{{ url_for('login') }}" method="POST">
          <div class="auth-tabs-inner">
            <div class="tab-link active">Login</div>
            <div class="tab-link">Sign Up</div>
          </div>
          <h2 class="auth-title">Welcome Back</h2>
          <p class="auth-subtitle">Enter your credentials to access your account</p>

          <div class="form-group">
            <label class="form-label" for="loginEmail">
              <svg class="form-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"/>
              </svg>
              Email Address
            </label>
            <input id="loginEmail" class="form-input" name="email" type="email" placeholder="admin@varon.local" required />
          </div>

          <div class="form-group">
            <label class="form-label" for="loginPassword">
              <svg class="form-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
              </svg>
              Password
            </label>
            <div class="password-wrapper">
              <input id="loginPassword" class="form-input" name="password" type="password" placeholder="••••••" required />
              <button type="button" class="toggle-password" onclick="togglePassword('loginPassword', this)" aria-label="Toggle password visibility">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
            </div>
          </div>

          <button type="submit" class="btn-submit">Login to Your Account</button>

          <div class="form-footer">
            <a href="#" class="forgot-link">Forgot your password?</a>
          </div>
        </form>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal" aria-hidden="true">
      <div class="cart-card" style="margin:20px; position: relative;">
        <button onclick="closeModal('cartModal')" style="position: absolute; top: -10px; right: -10px; width: 30px; height: 30px; font-size: 20px; color: #fff; background: #000; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">×</button>
        <h2 style="margin: 0 0 16px;">Your Cart</h2>
        <div id="cartList" class="cart-list">
          <!-- Cart items will be inserted here -->
        </div>
        <div class="cart-actions">
          <div class="cart-total">Total: <strong id="cartTotal">₱0.00</strong></div>
          <div style="display:flex;gap:8px">
            <button onclick="clearCart()" class="btn-cta" style="background:#f6f6f6;color:#0a0a0a">Clear Cart</button>
            <button id="checkoutBtn" class="btn-cta">Checkout</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirm Clear Cart Modal -->
    <div id="clearModal" class="modal" aria-hidden="true">
      <div class="modal-panel">
        <button class="modal-close" onclick="closeModal('clearModal')">×</button>
        <h2 style="margin:0 0 8px">Clear Cart?</h2>
        <p style="margin:0 0 18px;color:var(--muted)">Are you sure you want to remove all items from your cart?</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('clearModal')" class="btn-cta" style="background:#f6f6f6;color:#0a0a0a">Cancel</button>
          <button id="confirmClearYes" class="btn-cta">Yes, Clear Cart</button>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal" aria-hidden="true">
      <div class="modal-panel checkout">
        <button class="modal-close" onclick="closeModal('checkoutModal')" style="color:#fff">×</button>
        <h2 style="color:#fff;margin:0 0 8px">Checkout</h2>
        <p class="muted" style="margin:0 0 18px">Review your order before proceeding to payment</p>
        <div id="checkoutSummary" style="margin-bottom:18px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeModal('checkoutModal')" class="secondary">Cancel</button>
          <button id="proceedCheckout" class="btn-cta">Proceed to Payment</button>
        </div>
      </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productModal" class="modal" aria-hidden="true">
      <div class="cart-card" style="margin:20px; max-width:1000px; position: relative; background: #fff; padding: 0;">
        <button onclick="closeModal('productModal')" style="position: absolute; top: 10px; right: 10px; width: 32px; height: 32px; font-size: 20px; color: #666; background: #fff; border: 1px solid #e0e0e0; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 10;">×</button>
        
        <div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 0;">
          <!-- Product Images -->
          <div style="background: #f8f8f8; padding: 40px;">
            <div id="productModalImage" style="width: 100%; height: 500px; background-size: contain; background-repeat: no-repeat; background-position: center; background-color: #f8f8f8; margin-bottom: 20px;"></div>
            <div id="productThumbnails" style="display: flex; gap: 10px; justify-content: center;">
              <!-- Thumbnails will be inserted here -->
            </div>
          </div>
          
          <!-- Product Info -->
          <div style="padding: 40px 30px;">
            <h2 id="productModalName" style="margin: 0 0 8px; font-size: 20px; font-weight: 600; line-height: 1.4;">Product Name</h2>
            
            <div style="margin-bottom: 20px;">
              <div id="productModalPrice" style="font-size: 20px; font-weight: 700; color: #0a0a0a;">₱0.00</div>
              <small style="color: #666; font-size: 13px;">Tax included</small>
            </div>
            
            <!-- Color Selection -->
            <div style="margin-bottom: 24px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <strong style="font-size: 14px;">Color: <span id="selectedColorName" style="font-weight: 400;">Select a color</span></strong>
              </div>
              <div id="productModalColors" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <!-- Color swatches will be inserted here -->
              </div>
            </div>
            
            <!-- Size Selection -->
            <div style="margin-bottom: 24px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <strong style="font-size: 14px;">Size: <span id="selectedSizeName" style="font-weight: 400;">Select a size</span></strong>
                <a href="#" style="font-size: 13px; color: #0a0a0a; text-decoration: underline;">Check my size</a>
              </div>
              <div id="productModalSizes" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;">
                <!-- Size buttons will be inserted here -->
              </div>
            </div>
            
            <!-- Quantity -->
            <div style="margin-bottom: 24px;">
              <strong style="display: block; margin-bottom: 12px; font-size: 14px;">Quantity</strong>
              <div style="display: flex; align-items: center; gap: 12px;">
                <button onclick="decreaseQuantity()" style="width: 40px; height: 40px; border: 1px solid #e0e0e0; background: #fff; cursor: pointer; font-size: 18px; border-radius: 4px;">−</button>
                <input type="number" id="productQuantity" value="1" min="1" readonly style="width: 60px; height: 40px; text-align: center; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 16px;">
                <button onclick="increaseQuantity()" style="width: 40px; height: 40px; border: 1px solid #e0e0e0; background: #fff; cursor: pointer; font-size: 18px; border-radius: 4px;">+</button>
              </div>
            </div>
            
            <!-- Stock Status -->
            <div id="stockStatus" style="margin-bottom: 20px;">
              <span style="color: #10b981; font-size: 14px; font-weight: 500;">✓ In stock</span>
            </div>
            
            <!-- Add to Cart Button -->
            <button id="productModalAddCart" class="btn-cta" style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600; margin-bottom: 12px;" disabled>Select Size and Color</button>
            
            <!-- Description -->
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
              <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 10px;">Product Details</h3>
              <p id="productModalDescription" style="color: #666; font-size: 14px; line-height: 1.6; margin: 0;">Product description will appear here.</p>
              
              <div style="margin-top: 16px;">
                <div style="font-size: 13px; color: #666; margin-bottom: 4px;"><strong>Brand:</strong> <span id="productModalBrand">-</span></div>
                <div style="font-size: 13px; color: #666; margin-bottom: 4px;"><strong>SKU:</strong> <span id="productModalSKU">-</span></div>
                <div style="font-size: 13px; color: #666;"><strong>Category:</strong> <span id="productModalCategory">-</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let selectedColor = null;
      let selectedSize = null;
      let currentProduct = null;

      // Quantity controls
      function increaseQuantity() {
        const input = document.getElementById('productQuantity');
        input.value = parseInt(input.value) + 1;
      }

      function decreaseQuantity() {
        const input = document.getElementById('productQuantity');
        if (parseInt(input.value) > 1) {
          input.value = parseInt(input.value) - 1;
        }
      }

      // Select color
      function selectColor(color) {
        selectedColor = color;
        document.getElementById('selectedColorName').textContent = color;
        
        // Update color swatch selection
        document.querySelectorAll('.color-swatch').forEach(swatch => {
          swatch.style.border = '2px solid #e0e0e0';
        });
        event.target.closest('.color-swatch').style.border = '2px solid #0a0a0a';
        
        checkSelectionComplete();
      }

      // Select size
      function selectSize(size) {
        selectedSize = size;
        document.getElementById('selectedSizeName').textContent = size;
        
        // Update size button selection
        document.querySelectorAll('.size-btn').forEach(btn => {
          btn.style.background = '#fff';
          btn.style.color = '#0a0a0a';
          btn.style.borderColor = '#e0e0e0';
        });
        event.target.style.background = '#0a0a0a';
        event.target.style.color = '#fff';
        event.target.style.borderColor = '#0a0a0a';
        
        checkSelectionComplete();
      }

      // Check if both size and color are selected
      function checkSelectionComplete() {
        const addCartBtn = document.getElementById('productModalAddCart');
        if (selectedSize && selectedColor) {
          addCartBtn.disabled = false;
          addCartBtn.textContent = 'Add to Cart';
          addCartBtn.style.opacity = '1';
          addCartBtn.style.cursor = 'pointer';
        } else {
          addCartBtn.disabled = true;
          addCartBtn.textContent = 'Select Size and Color';
          addCartBtn.style.opacity = '0.6';
          addCartBtn.style.cursor = 'not-allowed';
        }
      }

      // Get color hex codes
      function getColorHex(colorName) {
        const colors = {
          'Black': '#000000',
          'White': '#FFFFFF',
          'Gray': '#808080',
          'Navy': '#000080',
          'Blue': '#0000FF',
          'Red': '#FF0000',
          'Green': '#008000',
          'Brown': '#8B4513',
          'Beige': '#F5F5DC',
          'Khaki': '#C3B091',
          'Burgundy': '#800020',
          'Olive': '#808000',
          'Charcoal': '#36454F'
        };
        return colors[colorName] || '#CCCCCC';
      }

      // Show product detail modal
      function showProductDetail(productId) {
        fetch(`/api/product/${productId}`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const product = data.product;
              currentProduct = product;
              selectedColor = null;
              selectedSize = null;
              
              // Reset quantity
              document.getElementById('productQuantity').value = 1;
              
              // Set product details
              document.getElementById('productModalName').textContent = product.name;
              document.getElementById('productModalPrice').textContent = `PHP ${parseFloat(product.price).toFixed(2)}`;
              document.getElementById('productModalDescription').textContent = product.description || 'High-quality product crafted with attention to detail.';
              document.getElementById('productModalCategory').textContent = product.category_name || 'Uncategorized';
              document.getElementById('productModalBrand').textContent = product.brand || '-';
              document.getElementById('productModalSKU').textContent = product.sku || '-';
              
              // Reset selection display
              document.getElementById('selectedColorName').textContent = 'Select a color';
              document.getElementById('selectedSizeName').textContent = 'Select a size';
              
              // Set image
              const imageDiv = document.getElementById('productModalImage');
              imageDiv.style.backgroundImage = `url('${product.image_url || 'https://images.unsplash.com/photo-1495121605193-b116b5b09f06?q=80&w=1200&auto=format&fit=crop'}')`;
              
              // Set colors as swatches
              const colorsDiv = document.getElementById('productModalColors');
              if (product.colors && product.colors.length > 0) {
                colorsDiv.innerHTML = product.colors.map(color => {
                  const hexColor = getColorHex(color);
                  const borderColor = color === 'White' ? '#e0e0e0' : hexColor;
                  return `<button class="color-swatch" onclick="selectColor('${color}')" title="${color}" 
                    style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #e0e0e0; background: ${hexColor}; cursor: pointer; position: relative; padding: 0;">
                  </button>`;
                }).join('');
              } else {
                colorsDiv.innerHTML = '<span style="color: #999; font-size: 14px;">One Color</span>';
                selectedColor = 'Standard';
              }
              
              // Set sizes as buttons
              const sizesDiv = document.getElementById('productModalSizes');
              if (product.sizes && product.sizes.length > 0) {
                sizesDiv.innerHTML = product.sizes.map(size => 
                  `<button class="size-btn" onclick="selectSize('${size}')" 
                    style="padding: 10px; border: 1px solid #e0e0e0; background: #fff; cursor: pointer; font-size: 14px; font-weight: 500; border-radius: 4px; transition: all 0.2s;">
                    ${size}
                  </button>`
                ).join('');
              } else {
                sizesDiv.innerHTML = '<span style="color: #999; font-size: 14px;">One Size</span>';
                selectedSize = 'One Size';
              }
              
              // Set up add to cart button
              const addCartBtn = document.getElementById('productModalAddCart');
              checkSelectionComplete();
              
              addCartBtn.onclick = function() {
                if (selectedSize && selectedColor) {
                  const quantity = parseInt(document.getElementById('productQuantity').value);
                  const itemName = `${product.name} (${selectedSize}, ${selectedColor})`;
                  addToCart(itemName, product.price, product.id, quantity);
                  closeModal('productModal');
                }
              };
              
              // Open modal
              openModal('productModal');
            }
          })
          .catch(error => {
            console.error('Error fetching product details:', error);
          });
      }

      // Check if user is logged in (server-side check)
      const isUserLoggedIn = {{ 'true' if session.get('logged_in') else 'false' }};
      
      // Update addToCart function to handle quantity and authentication
      const originalAddToCart = window.addToCart;
      window.addToCart = function(name, price, id, quantity = 1) {
        // Check if user is logged in
        if (!isUserLoggedIn) {
          alert('You need to log in to add items to cart');
          window.location.href = '/login';
          return;
        }
        
        for (let i = 0; i < quantity; i++) {
          if (originalAddToCart) {
            originalAddToCart(name, price, id);
          }
        }
      };

      // Add click event to products
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.product .media, .product .meta').forEach(element => {
          element.style.cursor = 'pointer';
          element.addEventListener('click', function(e) {
            const productArticle = this.closest('.product');
            const productId = productArticle.getAttribute('data-product-id');
            if (productId) {
              window.location.href = '/product/' + productId;
            }
          });
        });
      });
    </script>
  </body>
</html>
