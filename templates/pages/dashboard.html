<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Dashboard ‚Äî Var√≥n</title>
    <style>
      :root{--bg:#fff;--fg:#0a0a0a;--muted:#777;--accent:#000;--card:#f8f8f8;--line:#efefef}
      *{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:#f3f4f6;color:var(--fg)}
      a{text-decoration:none;color:inherit}
      /* Layout */
      .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
      .sidebar{background:#0a0a0a;color:#fff;padding:18px 14px;display:flex;flex-direction:column;gap:8px;overflow-y:auto;max-height:100vh}
      .logo{display:flex;align-items:center;gap:10px;padding:8px 8px 14px 8px;border-bottom:1px solid rgba(255,255,255,0.06);margin-bottom:10px}
      .logo .dot{width:10px;height:10px;border-radius:999px;background:#4ade80}
      .side-group{margin-top:8px}
      .side-title{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#bdbdbd;margin:10px 8px 6px}
      .side-link{display:flex;align-items:center;gap:10px;padding:10px 10px;border-radius:8px;color:#eaeaea}
      .side-link.active,.side-link:hover{background:#141414;color:#fff}

      .content{display:flex;flex-direction:column}
      .topbar{display:flex;align-items:center;gap:14px;background:#fff;border-bottom:1px solid var(--line);padding:10px 16px;position:sticky;top:0;z-index:5}
      .search{flex:1}
      .search input{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#fff}
      .avatar{display:flex;align-items:center;gap:8px;margin-left:auto}
      .tag{background:#0a0a0a;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px}

      .main{padding:18px 18px 26px}
      .page-title{font-size:22px;margin:8px 0 14px}

      /* Cards */
      .grid{display:grid;gap:14px}
      .grid.stats{grid-template-columns:repeat(4, minmax(180px,1fr))}
      .card{background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 2px 10px rgba(10,10,10,.03)}
      .card .inner{padding:14px}
      .metric{font-size:12px;color:var(--muted);margin-bottom:6px}
      .value{font-size:22px;font-weight:700}
      .delta{font-size:12px;color:#10b981;margin-left:8px}

      /* Chart placeholders */
      .grid.two{grid-template-columns:1.4fr 1fr}
      .chart{height:260px;padding:12px 14px}
      .bars{display:flex;align-items:flex-end;gap:10px;height:160px;margin-top:8px}
      .bar{flex:1;background:#0a0a0a;border-radius:6px}
      .legend{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:8px}

      /* Table */
      table{width:100%;border-collapse:separate;border-spacing:0}
      thead th{font-size:12px;color:var(--muted);text-align:left;border-bottom:1px solid var(--line);padding:10px 12px}
      tbody td{padding:12px;border-bottom:1px solid var(--line)}

      /* Right column widget */
      .promo{background:#0a0a0a;color:#fff;border-radius:10px;padding:16px;text-align:left}

      @media (max-width:1000px){
        .app{grid-template-columns:1fr}
        .sidebar{display:none}
        .grid.stats{grid-template-columns:repeat(2,1fr)}
        .grid.two{grid-template-columns:1fr}
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo">
          <div class="dot"></div>
          <strong>Var√≥n Admin</strong>
        </div>
        <div class="side-group">
          <div class="side-title">Menu</div>
          <a class="side-link active" href="#" data-page="overview">Overview</a>
          <a class="side-link" href="#" data-page="pending-products">Pending Products <span class="tag" style="background:#ef4444;margin-left:auto;font-size:10px;padding:2px 6px;">{{ pending_products if pending_products else 0 }}</span></a>
          <a class="side-link" href="#" data-page="pending-promotions" style="background:#1a1a1a;border-left:3px solid #8b5cf6;padding-left:7px">Pending Promotions <span class="tag" style="background:#8b5cf6;margin-left:auto;font-size:10px;padding:2px 6px;" id="pending-promotions-count">0</span></a>
          <a class="side-link" href="#" data-page="product-edits">Product Edits <span class="tag" style="background:#f59e0b;margin-left:auto;font-size:10px;padding:2px 6px;" id="edits-count">0</span></a>
          <a class="side-link" href="#" data-page="recovery-requests">Recovery Requests <span class="tag" style="background:#10b981;margin-left:auto;font-size:10px;padding:2px 6px;" id="recovery-count">0</span></a>
          <a class="side-link" href="#" data-page="product">All Products</a>
          <a class="side-link" href="#" data-page="customer">Customer</a>
          <a class="side-link" href="#" data-page="transactions">Transactions</a>
          <a class="side-link" href="#" data-page="statistics">Statistics</a>
          <a class="side-link" href="#" data-page="riders">Riders</a>
          <a class="side-link" href="#" data-page="sellers">Sellers</a>
          <a class="side-link" href="#" data-page="journal">Journal Management</a>
        </div>
        <div class="side-group">
          <div class="side-title">Support</div>
          <a class="side-link" href="#" data-page="setting">Setting</a>
          <a class="side-link" href="#" data-page="help">Help</a>
        </div>
      </aside>

      <!-- Content -->
      <section class="content">
        <div class="topbar">
          <div class="page-title">Dashboard</div>
          <div class="search"><input placeholder="Search anything..."/></div>
          <div class="avatar">
            {% if session.logged_in %}
              <span class="tag">{{ session.email }}</span>
              <a href="#" onclick="confirmLogout(event)" class="tag" style="background:#efefef;color:#0a0a0a">Logout</a>
            {% else %}
              <a href="/login" class="tag">Login</a>
            {% endif %}
          </div>
        </div>

        <main class="main" id="dashboardContent">
          <!-- Stat cards -->
          <div class="grid stats">
            <div class="card"><div class="inner"><div class="metric">Total Users</div><div class="value">{{ total_users if total_users else 0 }}</div></div></div>
            <div class="card"><div class="inner"><div class="metric">Total Orders</div><div class="value">{{ total_orders if total_orders else 0 }}</div></div></div>
            <div class="card"><div class="inner"><div class="metric">Pending Products</div><div class="value">{{ pending_products if pending_products else 0 }} <span class="delta" style="color:#ef4444">{% if pending_products %}Needs Review{% endif %}</span></div></div></div>
            <div class="card"><div class="inner"><div class="metric">Pending Verifications</div><div class="value">{{ (pending_sellers if pending_sellers else 0) + (pending_riders if pending_riders else 0) }} <span class="delta" style="color:#ef4444">{% if pending_sellers or pending_riders %}Sellers/Riders{% endif %}</span></div></div></div>
          </div>

          <!-- Charts row -->
          <div class="grid two" style="margin-top:14px">
            <div class="card">
              <div class="inner">
                <div class="metric">Revenue Growth (PHP)</div>
                <div class="chart">
                  <div class="bars">
                    {% for day in ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'] %}
                    <div class="bar" data-height="{{ ((weekly_revenue[day] / max_weekly_revenue) * 100)|int if weekly_revenue[day] > 0 else 5 }}"></div>
                    {% endfor %}
                  </div>
                  <div class="legend"><span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span></div>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="inner">
                <div class="metric">Customer Growth (Philippines)</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:6px">
                  <div id="overview-customer-growth">
                    <p style="text-align:center;color:#999;padding:20px">Loading regional data...</p>
                  </div>
                  <div class="promo">
                    <div style="font-weight:700;margin-bottom:8px">See more detail statistic to analyze your decision</div>
                    <a href="#" onclick="loadPage('statistics'); return false;" class="tag" style="display:inline-block;background:#fff;color:#0a0a0a;margin-top:8px">See more</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Data row -->
          <div class="grid two" style="margin-top:14px">
            <div class="card">
              <div class="inner">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div class="metric">Recent Orders</div>
                  <a href="#" style="font-size:12px;color:var(--muted)">View detail</a>
                </div>
                <div style="overflow:auto">
                  <table>
                    <thead><tr><th>Order #</th><th>Buyer</th><th>Date</th><th>Amount</th><th>Status</th></tr></thead>
                    <tbody id="recent-orders-list">
                      <tr><td colspan="5" style="text-align:center;color:#999;padding:20px">Loading orders...</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="inner">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div class="metric">Best Selling Product</div>
                  <a href="#" style="font-size:12px;color:var(--muted)">View more</a>
                </div>
                <div id="best-product-container" style="display:flex;gap:14px;align-items:center;margin-top:10px">
                  <p style="color:#999;text-align:center;width:100%">Loading...</p>
                </div>
              </div>
            </div>
          </div>
        </main>
      </section>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" style="position:fixed;inset:0;background:rgba(10,10,10,0.45);display:none;align-items:center;justify-content:center;z-index:1000">
      <div style="background:#fff;border-radius:10px;padding:24px;max-width:400px;box-shadow:0 4px 20px rgba(0,0,0,0.2)">
        <button onclick="closeLogoutModal()" style="float:right;background:none;border:none;font-size:24px;cursor:pointer;color:#999">√ó</button>
        <h2 style="margin:0 0 8px;font-size:18px">Confirm Logout</h2>
        <p style="margin:0 0 18px;color:#666;font-size:14px">Are you sure you want to logout? You will need to log in again to access your account.</p>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button onclick="closeLogoutModal()" style="padding:10px 20px;border:1px solid #ddd;background:#f6f6f6;color:#0a0a0a;border-radius:6px;cursor:pointer;font-weight:500">Cancel</button>
          <button onclick="proceedLogout()" style="padding:10px 20px;border:none;background:#ef4444;color:#fff;border-radius:6px;cursor:pointer;font-weight:500">Yes, Logout</button>
        </div>
      </div>
    </div>

    <script>

      const pageTemplates = {
        'pending-products': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">Pending Product Approvals</h2>
              <div id="pending-products-list">Loading pending products...</div>
            </div>
          </div>
          <!-- Product Details Modal -->
          <div id="product-details-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center">
            <div style="background:#fff;border-radius:12px;padding:24px;max-width:800px;width:90%;max-height:85vh;overflow-y:auto">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--line)">
                <h2 style="margin:0;font-size:20px;font-weight:700">üì¶ Product Details</h2>
                <button onclick="closeProductDetailsModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px">&times;</button>
              </div>
              <div id="product-details-body">Loading...</div>
            </div>
          </div>
        `,
        'pending-promotions': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üéâ Pending Promotions</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">Review and approve promotions submitted by sellers</p>
              <div id="pending-promotions-list">Loading pending promotions...</div>
            </div>
          </div>
          <!-- Promotion Details Modal -->
          <div id="promotion-details-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center">
            <div style="background:#fff;border-radius:12px;padding:24px;max-width:800px;width:90%;max-height:85vh;overflow-y:auto">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--line)">
                <h2 style="margin:0;font-size:20px;font-weight:700">üéâ Promotion Details</h2>
                <button onclick="closePromotionDetailsModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px">&times;</button>
              </div>
              <div id="promotion-details-body">Loading...</div>
            </div>
          </div>
        `,
        'product-edits': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üìù Product Edit Requests</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">Review and approve changes requested by sellers</p>
              <div id="product-edits-list">Loading product edits...</div>
            </div>
          </div>
          <div id="edit-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center">
            <div style="background:#fff;border-radius:12px;padding:24px;max-width:700px;width:90%;max-height:80vh;overflow-y:auto">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--line)">
                <h2 style="margin:0;font-size:20px;font-weight:700">Review Product Edit</h2>
                <button onclick="closeEditModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px">&times;</button>
              </div>
              <div id="edit-modal-body">Loading...</div>
            </div>
          </div>
        `,
        'recovery-requests': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">‚ôªÔ∏è Product Recovery Requests</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">Review requests from sellers to recover archived products</p>
              <div id="recovery-requests-list">Loading recovery requests...</div>
            </div>
          </div>
        `,
        'sellers': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üë• Active Sellers</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">View all active sellers in the system</p>
              <div id="active-sellers-list">Loading sellers...</div>
            </div>
          </div>
        `,
        'riders': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üöó Active Riders</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">View all active riders in the system</p>
              <div id="active-riders-list">Loading riders...</div>
            </div>
          </div>
        `,
        'product': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üì¶ All Products</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">Browse and manage all products in the system</p>
              <div id="all-products-list">Loading products...</div>
            </div>
          </div>
        `,
        'customer': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üë• Customer Management</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">View and manage customer accounts</p>
              <div id="customers-list">Loading customers...</div>
            </div>
          </div>
        `,
        'transactions': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üí≥ Transactions</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">View all transactions and payment history</p>
              <div id="transactions-list">Loading transactions...</div>
            </div>
          </div>
        `,
        'statistics': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üìä Statistics</h2>
              <p style="color: var(--muted); margin: 0 0 20px;">View detailed analytics and statistics</p>
              <div id="statistics-content">Loading statistics...</div>
            </div>
          </div>
          <div class="card" style="margin-top: 20px;">
            <div class="inner">
              <h2 style="margin: 0 0 16px;">üìà Customer Growth (Philippines)</h2>
              <div id="customer-growth-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div id="regional-growth">Loading regional data...</div>
                <div style="background: #0a0a0a; color: #fff; border-radius: 10px; padding: 24px; display: flex; flex-direction: column; justify-content: center;">
                  <h3 style="margin: 0 0 16px; font-size: 18px;">See more detail statistic to analyze your decision</h3>
                  <button onclick="document.getElementById('detailed-stats-modal').style.display='flex'" class="tag" style="background:#fff;color:#0a0a0a;cursor:pointer;border:none;padding:10px 16px;width:fit-content">See more</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Detailed Statistics Modal -->
          <div id="detailed-stats-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center">
            <div style="background:#fff;border-radius:12px;padding:24px;max-width:800px;width:90%;max-height:80vh;overflow-y:auto">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--line)">
                <h2 style="margin:0;font-size:20px;font-weight:700">Detailed Statistics</h2>
                <button onclick="document.getElementById('detailed-stats-modal').style.display='none'" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px">&times;</button>
              </div>
              <div id="detailed-stats-body">Loading...</div>
            </div>
          </div>
        `,
        'journal': `
          <div class="card">
            <div class="inner">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <h2 style="margin: 0;">üìù Journal Management</h2>
                <button onclick="openAddJournalModal()" class="tag" style="background:#0a0a0a;cursor:pointer;border:none;padding:10px 16px">+ Add Journal Entry</button>
              </div>
              <div id="journal-list">Loading journal entries...</div>
            </div>
          </div>
          <!-- Add/Edit Journal Modal -->
          <div id="journal-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center">
            <div style="background:#fff;border-radius:12px;padding:24px;max-width:700px;width:90%;max-height:80vh;overflow-y:auto">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--line)">
                <h2 style="margin:0;font-size:20px;font-weight:700" id="journal-modal-title">Add Journal Entry</h2>
                <button onclick="closeJournalModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--muted);padding:0;width:32px;height:32px">&times;</button>
              </div>
              <form id="journal-form" style="display:flex;flex-direction:column;gap:16px">
                <div>
                  <label style="display:block;margin-bottom:8px;font-weight:500">Title</label>
                  <input type="text" id="journal-title" required style="width:100%;padding:10px;border:1px solid var(--line);border-radius:6px">
                </div>
                <div>
                  <label style="display:block;margin-bottom:8px;font-weight:500">Description</label>
                  <textarea id="journal-description" required rows="4" style="width:100%;padding:10px;border:1px solid var(--line);border-radius:6px;resize:vertical"></textarea>
                </div>
                <div>
                  <label style="display:block;margin-bottom:8px;font-weight:500">Journal Image</label>
                  <div style="border:2px dashed var(--line);border-radius:6px;padding:20px;text-align:center;cursor:pointer;transition:all 0.2s;"
                       onmouseover="this.style.borderColor='#8b5cf6';this.style.background='#faf5ff';"
                       onmouseout="this.style.borderColor='var(--line)';this.style.background='transparent';"
                       onclick="document.getElementById('journal-image-input').click()">
                    <input type="file" id="journal-image-input" accept="image/*" style="display:none;" onchange="previewJournalImage(event)">
                    <div id="journal-image-preview" style="display:none;">
                      <img id="journal-preview-img" src="" alt="Preview" style="max-width:100%;max-height:200px;border-radius:6px;">
                      <button type="button" onclick="removeJournalImage()" style="margin-top:10px;background:#ef4444;color:white;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">Remove Image</button>
                    </div>
                    <div id="journal-image-placeholder">
                      <div style="font-size:32px;margin-bottom:8px;">üñºÔ∏è</div>
                      <p style="margin:0 0 4px;font-weight:500;color:#333;">Click to upload image</p>
                      <p style="margin:0;font-size:12px;color:var(--muted);">or drag and drop (PNG, JPG, GIF)</p>
                    </div>
                  </div>
                </div>
                <div>
                  <label style="display:flex;align-items:center;gap:8px;font-weight:500;cursor:pointer">
                    <input type="checkbox" id="journal-is-active" checked style="width:18px;height:18px;cursor:pointer">
                    <span>Active (visible on homepage)</span>
                  </label>
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
                  <button type="button" onclick="closeJournalModal()" class="tag" style="background:#f3f4f6;color:#0a0a0a;cursor:pointer;border:none;padding:10px 16px">Cancel</button>
                  <button type="submit" class="tag" style="background:#0a0a0a;cursor:pointer;border:none;padding:10px 16px;color:#fff">Save</button>
                </div>
              </form>
            </div>
          </div>
        `,
        'setting': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 24px;">‚öôÔ∏è System Settings</h2>
              <div style="display: grid; gap: 24px;">
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">General Settings</h3>
                  <div style="display: grid; gap: 16px;">
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 500;">System Name</label>
                      <input type="text" id="system-name" placeholder="e.g., Var-n E-Commerce" style="width: 100%; padding: 10px; border: 1px solid var(--line); border-radius: 6px; box-sizing: border-box;">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 500;">Support Email</label>
                      <input type="email" id="support-email" placeholder="support@example.com" style="width: 100%; padding: 10px; border: 1px solid var(--line); border-radius: 6px; box-sizing: border-box;">
                    </div>
                    <div>
                      <label style="display: block; margin-bottom: 8px; font-weight: 500;">Phone Number</label>
                      <input type="tel" id="support-phone" placeholder="+63 9XX XXX XXXX" style="width: 100%; padding: 10px; border: 1px solid var(--line); border-radius: 6px; box-sizing: border-box;">
                    </div>
                  </div>
                </div>
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">Maintenance Mode</h3>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <input type="checkbox" id="maintenance-mode" style="width: 20px; height: 20px; cursor: pointer;">
                    <label for="maintenance-mode" style="font-weight: 500; cursor: pointer;">Enable Maintenance Mode</label>
                  </div>
                  <p style="margin: 12px 0 0; font-size: 13px; color: var(--muted);">When enabled, the store will be unavailable to customers.</p>
                </div>
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">Notification Settings</h3>
                  <div style="display: grid; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <input type="checkbox" id="email-notifications" checked style="width: 20px; height: 20px; cursor: pointer;">
                      <label for="email-notifications" style="font-weight: 500; cursor: pointer;">Email Notifications</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <input type="checkbox" id="order-alerts" checked style="width: 20px; height: 20px; cursor: pointer;">
                      <label for="order-alerts" style="font-weight: 500; cursor: pointer;">Order Alerts</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <input type="checkbox" id="seller-alerts" checked style="width: 20px; height: 20px; cursor: pointer;">
                      <label for="seller-alerts" style="font-weight: 500; cursor: pointer;">Seller Management Alerts</label>
                    </div>
                  </div>
                </div>
              </div>
              <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--line);">
                <button onclick="location.reload()" class="tag" style="background: #f3f4f6; color: #0a0a0a; cursor: pointer; border: none; padding: 10px 16px;">Cancel</button>
                <button onclick="saveSystemSettings()" class="tag" style="background: #0a0a0a; color: #fff; cursor: pointer; border: none; padding: 10px 16px;">Save Settings</button>
              </div>
            </div>
          </div>
        `,
        'help': `
          <div class="card">
            <div class="inner">
              <h2 style="margin: 0 0 24px;">üìö Help & Support</h2>
              <div style="display: grid; gap: 24px;">
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">‚ùì Frequently Asked Questions</h3>
                  <div style="display: grid; gap: 12px;" id="faq-list">
                    <div style="padding: 12px; background: #f9f9f9; border-radius: 6px; cursor: pointer;" onclick="toggleFAQ(this)">
                      <div style="font-weight: 500; display: flex; justify-content: space-between; align-items: center;">
                        <span>How do I approve new products?</span>
                        <span style="font-size: 20px; color: var(--muted);">+</span>
                      </div>
                      <div style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line); font-size: 14px; color: var(--muted); line-height: 1.6;">
                        Navigate to "Pending Products", review the product details, and click the approve button. The seller will be notified immediately.
                      </div>
                    </div>
                    <div style="padding: 12px; background: #f9f9f9; border-radius: 6px; cursor: pointer;" onclick="toggleFAQ(this)">
                      <div style="font-weight: 500; display: flex; justify-content: space-between; align-items: center;">
                        <span>How do I manage sellers?</span>
                        <span style="font-size: 20px; color: var(--muted);">+</span>
                      </div>
                      <div style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line); font-size: 14px; color: var(--muted); line-height: 1.6;">
                        Visit the "Active Sellers" section to view all registered sellers, their store information, and product counts. You can take action on seller accounts from here.
                      </div>
                    </div>
                    <div style="padding: 12px; background: #f9f9f9; border-radius: 6px; cursor: pointer;" onclick="toggleFAQ(this)">
                      <div style="font-weight: 500; display: flex; justify-content: space-between; align-items: center;">
                        <span>How do I view transaction history?</span>
                        <span style="font-size: 20px; color: var(--muted);">+</span>
                      </div>
                      <div style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line); font-size: 14px; color: var(--muted); line-height: 1.6;">
                        Go to the "Transactions" section to see all orders, payment status, and delivery information. You can filter by date or customer.
                      </div>
                    </div>
                    <div style="padding: 12px; background: #f9f9f9; border-radius: 6px; cursor: pointer;" onclick="toggleFAQ(this)">
                      <div style="font-weight: 500; display: flex; justify-content: space-between; align-items: center;">
                        <span>What do the statistics show?</span>
                        <span style="font-size: 20px; color: var(--muted);">+</span>
                      </div>
                      <div style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line); font-size: 14px; color: var(--muted); line-height: 1.6;">
                        The statistics page displays total revenue, order count, active users, and products. You can also see customer growth by region to analyze market trends.
                      </div>
                    </div>
                  </div>
                </div>
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">üìñ Documentation</h3>
                  <ul style="margin: 0; padding-left: 20px; list-style: disc;">
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--primary); text-decoration: none; font-weight: 500;">Admin Dashboard Guide</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--primary); text-decoration: none; font-weight: 500;">Product Management Tutorial</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--primary); text-decoration: none; font-weight: 500;">Order Processing Workflow</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--primary); text-decoration: none; font-weight: 500;">Seller Verification Process</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--primary); text-decoration: none; font-weight: 500;">Rider Assignment & Tracking</a></li>
                  </ul>
                </div>
                <div style="border: 1px solid var(--line); border-radius: 8px; padding: 20px;">
                  <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">üìû Contact Support</h3>
                  <div style="display: grid; gap: 12px; font-size: 14px;">
                    <div>
                      <strong>Email:</strong>
                      <p style="margin: 4px 0 0; color: var(--muted);" id="support-contact-email">support@varn.com</p>
                    </div>
                    <div>
                      <strong>Phone:</strong>
                      <p style="margin: 4px 0 0; color: var(--muted);" id="support-contact-phone">+63 977 XXX XXXX</p>
                    </div>
                    <div>
                      <strong>Hours:</strong>
                      <p style="margin: 4px 0 0; color: var(--muted);">Monday - Friday: 9:00 AM - 6:00 PM (PST)</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `
      };

      function loadPage(page) {
        console.log('Loading page:', page);


        document.querySelectorAll('.side-link').forEach(l => l.classList.remove('active'));

        document.querySelector(`[data-page="${page}"]`)?.classList.add('active');

        const content = document.getElementById('dashboardContent');


        if (page === 'overview') {
          window.location.reload();
          return;
        }

        if (pageTemplates[page]) {
          content.innerHTML = pageTemplates[page];


          if (page === 'pending-products') {
            loadPendingProducts();
          } else if (page === 'pending-promotions') {
            loadPendingPromotions();
          } else if (page === 'product-edits') {
            loadProductEdits();
          } else if (page === 'recovery-requests') {
            loadRecoveryRequests();
          } else if (page === 'sellers') {
            loadActiveSellers();
          } else if (page === 'riders') {
            loadActiveRiders();
          } else if (page === 'journal') {
            loadJournalEntries();
          } else if (page === 'product') {
            loadAllProducts();
          } else if (page === 'customer') {
            loadCustomers();
          } else if (page === 'transactions') {
            loadTransactions();
          } else if (page === 'statistics') {
            loadStatistics();
          } else if (page === 'setting') {
            loadSettings();
          } else if (page === 'help') {
            loadHelp();
          }
        } else {
          content.innerHTML = `
            <div class="card">
              <div class="inner">
                <h2 style="margin: 0 0 16px;">${page.charAt(0).toUpperCase() + page.slice(1)}</h2>
                <p style="text-align:center;color:#999;padding:40px;">This page is under construction.</p>
              </div>
            </div>
          `;
        }


        const pageNames = {
          'overview': 'Dashboard',
          'pending-products': 'Pending Products',
          'pending-promotions': 'Pending Promotions',
          'product': 'All Products',
          'customer': 'Customers',
          'transactions': 'Transactions',
          'statistics': 'Statistics',
          'riders': 'Active Riders',
          'sellers': 'Active Sellers',
          'journal': 'Journal Management',
          'setting': 'System Settings',
          'help': 'Help & Support',
          'log': 'Activity Log'
        };
        document.querySelector('.page-title').textContent = pageNames[page] || 'Dashboard';
      }

      function loadPendingProducts() {
        console.log('Loading pending products...');
        fetch('/admin/pending-products')
          .then(response => {
            console.log('Products response:', response);
            return response.json();
          })
          .then(data => {
            console.log('Products data:', data);
            if (data.products && data.products.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Seller</th>
                      <th>Price</th>
                      <th>Stock</th>
                      <th>Submitted</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.products.forEach(product => {
                const stockCount =
                  product.stock ??
                  product.total_stock ??
                  product.variant_stock ??
                  product.inventory_stock ??
                  0;
                const date = new Date(product.created_at).toLocaleDateString();
                html += `
                  <tr id="product-${product.id}">
                    <td>
                      <strong>${product.name}</strong><br>
                      <small style="color: var(--muted)">${product.description ? product.description.substring(0, 50) + '...' : 'No description'}</small>
                    </td>
                    <td>${product.store_name}</td>
                    <td>‚Ç±${parseFloat(product.price).toFixed(2)}</td>
                    <td>${stockCount} pcs</td>
                    <td>${date}</td>
                    <td>
                      <button class="tag" onclick="viewProductDetails(${product.id})" style="background: #3b82f6; cursor: pointer; border: none;">View Details</button>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              document.getElementById('pending-products-list').innerHTML = html;
            } else {
              document.getElementById('pending-products-list').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No pending products to review</p>';
            }
          })
          .catch(error => {
            document.getElementById('pending-products-list').innerHTML = '<p style="color:#ef4444;">Error loading pending products</p>';
          });
      }

      function approveProduct(productId) {
        if (!confirm('Approve this product?')) return;

        fetch(`/admin/approve-product/${productId}`, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Product approved successfully!');

            document.getElementById(`product-${productId}`)?.remove();

            const badge = document.querySelector('[data-page="pending-products"] .tag');
            if (badge) {
              const count = parseInt(badge.textContent) - 1;
              badge.textContent = count > 0 ? count : '0';
            }
          } else {
            alert('Error approving product: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error approving product');
        });
      }

      function rejectProduct(productId) {
        const reason = prompt('Enter rejection reason (will be sent to the seller):');
        if (reason === null) return;
        
        if (!confirm('Reject and delete this product? This cannot be undone. The seller will be notified.')) return;

        fetch(`/admin/reject-product/${productId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reason: reason || 'No reason provided' })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('‚úÖ Product rejected and removed. Seller has been notified.');

            // Remove from pending products list
            const productRow = document.getElementById(`product-${productId}`);
            if (productRow) {
              productRow.remove();
            }

            // Update badge count
            const badge = document.querySelector('[data-page="pending-products"] .tag');
            if (badge) {
              const count = parseInt(badge.textContent) - 1;
              badge.textContent = count > 0 ? count : '0';
            }
            
            // Check if list is empty and show message
            const pendingList = document.getElementById('pending-products-list');
            if (pendingList && pendingList.querySelector('table tbody')?.children.length === 0) {
              pendingList.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No pending products to review</p>';
            }
          } else {
            alert('Error rejecting product: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error rejecting product: ' + error.message);
        });
      }

      function loadPendingPromotions() {
        console.log('Loading pending promotions...');
        fetch('/admin/pending-promotions')
          .then(response => {
            console.log('Promotions response:', response);
            return response.json();
          })
          .then(data => {
            console.log('Promotions data:', data);
            if (data.promotions && data.promotions.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Code</th>
                      <th>Product</th>
                      <th>Seller</th>
                      <th>Discount</th>
                      <th>Dates</th>
                      <th>Submitted</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.promotions.forEach(promo => {
                const date = new Date(promo.created_at).toLocaleDateString();
                const startDate = new Date(promo.start_date).toLocaleDateString();
                const endDate = new Date(promo.end_date).toLocaleDateString();
                const discountLabel = promo.discount_type === 'percentage' ? `${promo.discount_value}%` : `‚Ç±${promo.discount_value}`;

                html += `
                  <tr id="promotion-${promo.id}">
                    <td><strong>${promo.code}</strong></td>
                    <td>
                      <strong>${promo.product_name}</strong><br>
                      <small style="color: var(--muted)">‚Ç±${parseFloat(promo.product_price).toFixed(2)}</small>
                    </td>
                    <td>${promo.store_name}</td>
                    <td>${discountLabel}</td>
                    <td>
                      <small>${startDate} to ${endDate}</small>
                    </td>
                    <td>${date}</td>
                    <td>
                      <div style="display: flex; gap: 8px;">
                        <button class="tag" onclick="viewPromotionDetails(${promo.id})" style="background: #3b82f6; cursor: pointer; border: none;">Details</button>
                        <button class="tag" onclick="approvePromotion(${promo.id})" style="background: #10b981; cursor: pointer; border: none;">Approve</button>
                        <button class="tag" onclick="rejectPromotion(${promo.id})" style="background: #ef4444; cursor: pointer; border: none;">Reject</button>
                      </div>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              document.getElementById('pending-promotions-list').innerHTML = html;


              const badge = document.querySelector('[data-page="pending-promotions"] .tag');
              if (badge) {
                badge.textContent = data.promotions.length;
              }
            } else {
              document.getElementById('pending-promotions-list').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No pending promotions to review</p>';
              const badge = document.querySelector('[data-page="pending-promotions"] .tag');
              if (badge) {
                badge.textContent = '0';
              }
            }
          })
          .catch(error => {
            document.getElementById('pending-promotions-list').innerHTML = '<p style="color:#ef4444;">Error loading pending promotions</p>';
            console.error('Error:', error);
          });
      }

      function viewPromotionDetails(promotionId) {
        const modal = document.getElementById('promotion-details-modal');
        const modalBody = document.getElementById('promotion-details-body');

        modal.style.display = 'flex';
        modalBody.innerHTML = '<p style="text-align:center;padding:40px;">Loading promotion details...</p>';


        fetch('/admin/pending-promotions')
          .then(response => response.json())
          .then(data => {
            const promo = data.promotions.find(p => p.id === promotionId);
            if (promo) {
              const startDate = new Date(promo.start_date).toLocaleDateString();
              const endDate = new Date(promo.end_date).toLocaleDateString();
              const discountLabel = promo.discount_type === 'percentage' ? `${promo.discount_value}%` : `‚Ç±${promo.discount_value}`;

              let html = `
                <div style="display: grid; gap: 16px;">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Promotion Code</label>
                      <div style="font-size: 18px; font-weight: 700;">${promo.code}</div>
                    </div>
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Discount</label>
                      <div style="font-size: 18px; font-weight: 700; color: #10b981;">${discountLabel}</div>
                    </div>
                  </div>

                  <div>
                    <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Product</label>
                    <div>${promo.product_name} (‚Ç±${parseFloat(promo.product_price).toFixed(2)})</div>
                  </div>

                  <div>
                    <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Brand</label>
                    <div>${promo.brand || 'N/A'}</div>
                  </div>

                  <div>
                    <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Description</label>
                    <div>${promo.description || 'No description provided'}</div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Start Date</label>
                      <div>${startDate}</div>
                    </div>
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">End Date</label>
                      <div>${endDate}</div>
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Min. Purchase</label>
                      <div>‚Ç±${parseFloat(promo.min_purchase || 0).toFixed(2)}</div>
                    </div>
                    <div>
                      <label style="display: block; font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 4px;">Usage Limit</label>
                      <div>${promo.usage_limit || 'Unlimited'}</div>
                    </div>
                  </div>

                  <div style="display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--line);">
                    <button onclick="approvePromotion(${promo.id})" class="tag" style="background: #10b981; color: white; cursor: pointer; border: none; padding: 10px 16px; flex: 1;">‚úì Approve</button>
                    <button onclick="rejectPromotion(${promo.id})" class="tag" style="background: #ef4444; color: white; cursor: pointer; border: none; padding: 10px 16px; flex: 1;">‚úï Reject</button>
                  </div>
                </div>
              `;
              modalBody.innerHTML = html;
            }
          })
          .catch(error => {
            modalBody.innerHTML = '<p style="color:#ef4444;">Error loading promotion details</p>';
          });
      }

      function closePromotionDetailsModal() {
        document.getElementById('promotion-details-modal').style.display = 'none';
      }

      function approvePromotion(promotionId) {
        if (!confirm('Approve this promotion? An email will be sent to the seller.')) return;

        fetch(`/admin/promotion/${promotionId}/approve`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Promotion approved successfully! Email sent to seller.');
            closePromotionDetailsModal();
            document.getElementById(`promotion-${promotionId}`)?.remove();


            const badge = document.querySelector('[data-page="pending-promotions"] .tag');
            if (badge) {
              const count = parseInt(badge.textContent) - 1;
              badge.textContent = count > 0 ? count : '0';
            }


            const listContainer = document.getElementById('pending-promotions-list');
            if (listContainer && listContainer.querySelector('tbody').children.length === 0) {
              loadPendingPromotions();
            }
          } else {
            alert('Error approving promotion: ' + (data.error || 'Unknown error'));
          }
        })
        .catch(error => {
          alert('Error approving promotion: ' + error.message);
          console.error('Error:', error);
        });
      }

      function rejectPromotion(promotionId) {
        const reason = prompt('Enter rejection reason (will be sent to the seller):');
        if (reason === null) return;

        fetch(`/admin/promotion/${promotionId}/reject`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ reason: reason || 'No reason provided' })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Promotion rejected! Email sent to seller with rejection reason.');
            closePromotionDetailsModal();
            document.getElementById(`promotion-${promotionId}`)?.remove();


            const badge = document.querySelector('[data-page="pending-promotions"] .tag');
            if (badge) {
              const count = parseInt(badge.textContent) - 1;
              badge.textContent = count > 0 ? count : '0';
            }


            const listContainer = document.getElementById('pending-promotions-list');
            if (listContainer && listContainer.querySelector('tbody').children.length === 0) {
              loadPendingPromotions();
            }
          } else {
            alert('Error rejecting promotion: ' + (data.error || 'Unknown error'));
          }
        })
        .catch(error => {
          alert('Error rejecting promotion: ' + error.message);
          console.error('Error:', error);
        });
      }

      function loadPendingSellers() {
        console.log('Loading pending sellers...');
        fetch('/admin/pending-sellers')
          .then(response => {
            console.log('Sellers response:', response);
            return response.json();
          })
          .then(data => {
            console.log('Sellers data:', data);
            if (data.sellers && data.sellers.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Seller Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Store Name</th>
                      <th>Submitted</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.sellers.forEach(seller => {
                const date = new Date(seller.created_at).toLocaleDateString();
                html += `
                  <tr id="seller-${seller.id}">
                    <td><strong>${seller.first_name} ${seller.last_name}</strong></td>
                    <td>${seller.email}</td>
                    <td>${seller.phone || 'N/A'}</td>
                    <td>${seller.store_name}</td>
                    <td>${date}</td>
                    <td>
                      <div style="display: flex; gap: 8px;">
                        <button class="tag" onclick="approveSeller(${seller.id})" style="background: #10b981; cursor: pointer; border: none;">Approve</button>
                        <button class="tag" onclick="rejectSeller(${seller.id})" style="background: #ef4444; cursor: pointer; border: none;">Reject</button>
                      </div>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              document.getElementById('pending-sellers-list').innerHTML = html;
            } else {
              document.getElementById('pending-sellers-list').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No pending sellers to verify</p>';
            }
          })
          .catch(error => {
            console.error('Error loading sellers:', error);
            document.getElementById('pending-sellers-list').innerHTML = '<p style="color:#ef4444;">Error loading pending sellers: ' + error.message + '</p>';
          });
      }

      function approveSeller(sellerId) {
        if (!confirm('Approve this seller?')) return;

        fetch(`/admin/approve-seller/${sellerId}`, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Seller approved successfully!');
            document.getElementById(`seller-${sellerId}`)?.remove();
          } else {
            alert('Error approving seller: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error approving seller');
        });
      }

      function rejectSeller(sellerId) {
        if (!confirm('Reject this seller application? This will remove their seller account.')) return;

        fetch(`/admin/reject-seller/${sellerId}`, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Seller application rejected');
            document.getElementById(`seller-${sellerId}`)?.remove();
          } else {
            alert('Error rejecting seller: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error rejecting seller');
        });
      }

      function loadPendingRiders() {
        console.log('Loading pending riders...');
        fetch('/admin/pending-riders')
          .then(response => {
            console.log('Riders response:', response);
            return response.json();
          })
          .then(data => {
            console.log('Riders data:', data);
            if (data.riders && data.riders.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Rider Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Vehicle Type</th>
                      <th>License Number</th>
                      <th>Applied On</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.riders.forEach(rider => {
                const date = new Date(rider.created_at).toLocaleDateString();
                html += `
                  <tr id="rider-${rider.id}">
                    <td><strong>${rider.first_name} ${rider.last_name}</strong></td>
                    <td>${rider.email}</td>
                    <td>${rider.phone || 'N/A'}</td>
                    <td>${rider.vehicle_type || 'N/A'}</td>
                    <td>${rider.license_number || 'N/A'}</td>
                    <td>${date}</td>
                    <td>
                      <div style="display: flex; gap: 8px;">
                        <button class="tag" onclick="approveRider(${rider.id})" style="background: #10b981; cursor: pointer; border: none;">Approve</button>
                        <button class="tag" onclick="rejectRider(${rider.id})" style="background: #ef4444; cursor: pointer; border: none;">Reject</button>
                      </div>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              document.getElementById('pending-riders-list').innerHTML = html;
            } else {
              document.getElementById('pending-riders-list').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No pending riders to verify</p>';
            }
          })
          .catch(error => {
            console.error('Error loading riders:', error);
            document.getElementById('pending-riders-list').innerHTML = '<p style="color:#ef4444;">Error loading pending riders: ' + error.message + '</p>';
          });
      }

      function approveRider(riderId) {
        if (!confirm('Approve this rider?')) return;

        fetch(`/admin/approve-rider/${riderId}`, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Rider approved successfully!');
            document.getElementById(`rider-${riderId}`)?.remove();
          } else {
            alert('Error approving rider: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error approving rider');
        });
      }

      function rejectRider(riderId) {
        if (!confirm('Reject this rider application?')) return;

        fetch(`/admin/reject-rider/${riderId}`, {
          method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Rider application rejected');
            document.getElementById(`rider-${riderId}`)?.remove();
          } else {
            alert('Error rejecting rider: ' + data.error);
          }
        })
        .catch(error => {
          alert('Error rejecting rider');
        });
      }


      function loadProductEdits() {
        fetch('/admin/pending-edits')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('product-edits-list');
            const editsCount = document.getElementById('edits-count');

            if (data.pending_edits && data.pending_edits.length > 0) {
              if (editsCount) editsCount.textContent = data.pending_edits.length;

              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Store</th>
                      <th>Changes</th>
                      <th>Requested</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.pending_edits.forEach(item => {
                const date = new Date(item.first_request).toLocaleString();
                html += `
                  <tr id="edit-row-${item.product_id}">
                    <td><strong>${item.product_name}</strong></td>
                    <td>${item.store_name}</td>
                    <td><span class="tag" style="background:#fef3c7;color:#92400e">${item.edit_count} change${item.edit_count > 1 ? 's' : ''}</span></td>
                    <td style="color:var(--muted);font-size:13px">${date}</td>
                    <td>
                      <button class="tag" onclick="viewEditDetails(${item.product_id})" style="background:#0a0a0a;cursor:pointer;border:none">Review</button>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              if (editsCount) editsCount.textContent = '0';
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">‚úì No pending edit requests</p>';
            }
          })
          .catch(error => {
            document.getElementById('product-edits-list').innerHTML = '<p style="color:#ef4444">Error loading edits</p>';
          });
      }

      function viewEditDetails(productId) {
        const modal = document.getElementById('edit-modal');
        modal.style.display = 'flex';
        document.getElementById('edit-modal-body').innerHTML = 'Loading...';

        fetch('/admin/product-edit-details/' + productId)
          .then(response => response.json())
          .then(data => {
            if (data.product && data.edits) {
              let html = `
                <div style="background:#f9fafb;padding:16px;border-radius:8px;margin-bottom:20px">
                  <h3 style="margin:0 0 8px">${data.product.name}</h3>
                  <p style="margin:0;color:var(--muted);font-size:14px">Store: ${data.product.store_name}</p>
                </div>

                <h3 style="margin:20px 0 12px">Requested Changes:</h3>
              `;

              data.edits.forEach(edit => {
                html += `
                  <div style="background:#f9fafb;padding:12px;border-radius:6px;margin:8px 0;border-left:3px solid #3b82f6" id="edit-item-${edit.id}">
                    <div style="font-weight:600;color:#0a0a0a;margin-bottom:6px">üìù ${edit.field_name}</div>
                    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:center;font-size:14px">
                      <div>
                        <div style="font-size:11px;text-transform:uppercase;color:var(--muted);margin-bottom:4px">Current</div>
                        <div style="color:#ef4444;text-decoration:line-through">${edit.old_value || '(empty)'}</div>
                      </div>
                      <div style="color:var(--muted)">‚Üí</div>
                      <div>
                        <div style="font-size:11px;text-transform:uppercase;color:var(--muted);margin-bottom:4px">Proposed</div>
                        <div style="color:#10b981;font-weight:500">${edit.new_value}</div>
                      </div>
                    </div>
                    <div style="display:flex;gap:8px;margin-top:12px">
                      <button class="tag" onclick="approveSingleEdit(${edit.id})" style="background:#10b981;cursor:pointer;border:none">‚úì Approve</button>
                      <button class="tag" onclick="rejectSingleEdit(${edit.id})" style="background:#ef4444;cursor:pointer;border:none">‚úó Reject</button>
                    </div>
                  </div>
                `;
              });

              html += `
                <div style="display:flex;gap:12px;margin-top:24px;padding-top:20px;border-top:2px solid var(--line)">
                  <button class="tag" onclick="approveAllProductEdits(${productId})" style="background:#10b981;cursor:pointer;border:none;padding:10px 16px">‚úì Approve All Changes</button>
                  <button class="tag" onclick="closeEditModal()" style="background:#f3f4f6;color:#0a0a0a;cursor:pointer;border:none;padding:10px 16px">Close</button>
                </div>
              `;

              document.getElementById('edit-modal-body').innerHTML = html;
            }
          })
          .catch(error => {
            document.getElementById('edit-modal-body').innerHTML = '<p style="color:#ef4444">Error loading details</p>';
          });
      }

      function approveSingleEdit(editId) {
        if (!confirm('Approve this change?')) return;

        fetch('/admin/approve-edit/' + editId, { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('‚úì Edit approved successfully!');
              document.getElementById('edit-item-' + editId)?.remove();


              if (!document.querySelectorAll('[id^="edit-item-"]').length) {
                closeEditModal();
                loadProductEdits();
              }
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => alert('Error approving edit'));
      }

      function rejectSingleEdit(editId) {
        const notes = prompt('Rejection reason (optional):');
        if (notes === null) return;

        const formData = new FormData();
        formData.append('notes', notes);

        fetch('/admin/reject-edit/' + editId, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Edit rejected');
              document.getElementById('edit-item-' + editId)?.remove();


              if (!document.querySelectorAll('[id^="edit-item-"]').length) {
                closeEditModal();
                loadProductEdits();
              }
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => alert('Error rejecting edit'));
      }

      function approveAllProductEdits(productId) {
        if (!confirm('Approve ALL changes for this product?')) return;

        const editItems = document.querySelectorAll('[id^="edit-item-"]');
        const promises = [];

        editItems.forEach(item => {
          const editId = item.id.replace('edit-item-', '');
          promises.push(fetch('/admin/approve-edit/' + editId, { method: 'POST' }));
        });

        Promise.all(promises)
          .then(() => {
            alert('‚úì All changes approved successfully!');
            closeEditModal();
            loadProductEdits();
          })
          .catch(error => alert('Error approving all edits'));
      }

      function closeEditModal() {
        document.getElementById('edit-modal').style.display = 'none';
      }


      function loadRecoveryRequests() {
        fetch('/admin/pending-recoveries')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('recovery-requests-list');
            const recoveryCount = document.getElementById('recovery-count');

            if (data.pending_recoveries && data.pending_recoveries.length > 0) {
              if (recoveryCount) recoveryCount.textContent = data.pending_recoveries.length;

              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Product</th>
                      <th>Store</th>
                      <th>Price</th>
                      <th>Reason</th>
                      <th>Requested</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.pending_recoveries.forEach(item => {
                const date = new Date(item.requested_at).toLocaleString();
                html += `
                  <tr id="recovery-row-${item.request_id}">
                    <td><strong>${item.product_name}</strong><br><small style="color:var(--muted)">SKU: ${item.sku || 'N/A'}</small></td>
                    <td>${item.store_name}</td>
                    <td>‚Ç±${parseFloat(item.price).toFixed(2)}</td>
                    <td style="max-width:200px;font-size:13px">${item.reason || 'No reason provided'}</td>
                    <td style="color:var(--muted);font-size:13px">${date}</td>
                    <td>
                      <button class="tag" onclick="approveRecovery(${item.request_id})" style="background:#10b981;cursor:pointer;border:none;margin-right:4px">‚úì Approve</button>
                      <button class="tag" onclick="rejectRecovery(${item.request_id})" style="background:#ef4444;cursor:pointer;border:none">‚úó Reject</button>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              if (recoveryCount) recoveryCount.textContent = '0';
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">‚úì No pending recovery requests</p>';
            }
          })
          .catch(error => {
            document.getElementById('recovery-requests-list').innerHTML = '<p style="color:#ef4444">Error loading recovery requests</p>';
          });
      }

      function approveRecovery(requestId) {
        if (!confirm('Approve this recovery request? The product will be restored to active status.')) return;

        fetch('/admin/approve-recovery/' + requestId, { method: 'POST' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('‚úì Recovery approved! Product restored.');
              document.getElementById('recovery-row-' + requestId)?.remove();


              const recoveryCount = document.getElementById('recovery-count');
              if (recoveryCount) {
                const count = parseInt(recoveryCount.textContent) - 1;
                recoveryCount.textContent = count > 0 ? count : '0';
              }


              if (!document.querySelectorAll('[id^="recovery-row-"]').length) {
                loadRecoveryRequests();
              }
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => alert('Error approving recovery'));
      }

      function rejectRecovery(requestId) {
        const notes = prompt('Rejection reason (optional):');
        if (notes === null) return;

        const formData = new FormData();
        formData.append('notes', notes);

        fetch('/admin/reject-recovery/' + requestId, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Recovery request rejected');
              document.getElementById('recovery-row-' + requestId)?.remove();


              const recoveryCount = document.getElementById('recovery-count');
              if (recoveryCount) {
                const count = parseInt(recoveryCount.textContent) - 1;
                recoveryCount.textContent = count > 0 ? count : '0';
              }


              if (!document.querySelectorAll('[id^="recovery-row-"]').length) {
                loadRecoveryRequests();
              }
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => alert('Error rejecting recovery'));
      }


      fetch('/admin/pending-edits')
        .then(response => response.json())
        .then(data => {
          const editsCount = document.getElementById('edits-count');
          if (editsCount && data.pending_edits) {
            editsCount.textContent = data.pending_edits.length;
          }
        })
        .catch(error => console.error('Error loading edit count:', error));


      fetch('/admin/pending-recoveries')
        .then(response => response.json())
        .then(data => {
          const recoveryCount = document.getElementById('recovery-count');
          if (recoveryCount && data.pending_recoveries) {
            recoveryCount.textContent = data.pending_recoveries.length;
          }
        })
        .catch(error => console.error('Error loading recovery count:', error));


      fetch('/admin/pending-promotions')
        .then(response => response.json())
        .then(data => {
          const promotionsCount = document.getElementById('pending-promotions-count');
          if (promotionsCount && data.promotions) {
            promotionsCount.textContent = data.promotions.length;
          }
        })
        .catch(error => console.error('Error loading promotions count:', error));


      document.querySelectorAll('.side-link').forEach(link => {
        link.addEventListener('click', (e) => {
          const page = e.currentTarget.getAttribute('data-page');
          if (page && e.currentTarget.getAttribute('href') === '#') {
            e.preventDefault();
            loadPage(page);
          }
        });
      });


      function loadRecentOrders() {
        fetch('/admin/recent-orders')
          .then(response => response.json())
          .then(data => {
            if (data.orders && data.orders.length > 0) {
              let html = '';
              data.orders.forEach(order => {
                const date = new Date(order.created_at).toLocaleDateString();
                const statusColor = order.status === 'completed' ? '#10b981' : order.status === 'pending' ? '#f59e0b' : '#ef4444';
                html += `
                  <tr>
                    <td><strong>#${order.order_number}</strong></td>
                    <td>${order.buyer_name || 'N/A'}</td>
                    <td>${date}</td>
                    <td>‚Ç±${parseFloat(order.total_amount).toFixed(2)}</td>
                    <td><span class="tag" style="background:${statusColor};text-transform:capitalize">${order.status}</span></td>
                  </tr>
                `;
              });
              document.getElementById('recent-orders-list').innerHTML = html;
            } else {
              document.getElementById('recent-orders-list').innerHTML = '<tr><td colspan="5" style="text-align:center;color:#999;padding:20px">No orders yet</td></tr>';
            }
          })
          .catch(error => {
            document.getElementById('recent-orders-list').innerHTML = '<tr><td colspan="5" style="text-align:center;color:#ef4444;padding:20px">Error loading orders</td></tr>';
          });
      }


      function loadBestProduct() {
        fetch('/admin/best-product')
          .then(response => response.json())
          .then(data => {
            if (data.product) {
              const container = document.getElementById('best-product-container');
              const imageUrl = data.product.image_url || 'https://images.unsplash.com/photo-1610963876305-c8e7cb43a09b?q=80&w=600&auto=format&fit=crop';
              container.innerHTML = `
                <div style="width:120px;height:140px;border-radius:8px;background:#eaeaea;background-image:url('${imageUrl}');background-size:cover;background-position:center"></div>
                <div>
                  <div style="font-weight:700">${data.product.name}</div>
                  <div class="muted" style="margin-top:4px">${data.product.order_count || 0}+ items sold</div>
                  <div style="margin-top:6px;font-size:14px;color:#666">Store: ${data.product.store_name || 'N/A'}</div>
                  <a href="#" class="tag" style="display:inline-block;margin-top:10px">View Details</a>
                </div>
              `;
            } else {
              document.getElementById('best-product-container').innerHTML = '<p style="color:#999;text-align:center;width:100%">No products yet</p>';
            }
          })
          .catch(error => {
            document.getElementById('best-product-container').innerHTML = '<p style="color:#ef4444;text-align:center;width:100%">Error loading product</p>';
          });
      }


      window.addEventListener('DOMContentLoaded', () => {
        loadRecentOrders();
        loadBestProduct();

        document.querySelectorAll('.bar[data-height]').forEach(bar => {
          bar.style.height = bar.getAttribute('data-height') + '%';
        });
      });
      function confirmLogout(event) {
        event.preventDefault();
        document.getElementById('logoutModal').style.display = 'flex';
      }

      function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
      }

      function proceedLogout() {
        window.location.href = '/logout';
      }


      function viewProductDetails(productId) {
        const modal = document.getElementById('product-details-modal');
        const modalBody = document.getElementById('product-details-body');

        modal.style.display = 'flex';
        modalBody.innerHTML = '<p style="text-align:center;padding:40px;">Loading product details...</p>';

        fetch(`/admin/product-details/${productId}`)
          .then(response => response.json())
          .then(data => {
            console.log('Product details data:', data);
            console.log('Variants:', data.variants);
            console.log('Product stock:', data.product?.stock);
            if (data.success && data.product) {
              const p = data.product;

              const categoryNames = {
                'shirts': 'Shirts & T-Shirts',
                'pants': 'Pants & Jeans',
                'shorts': 'Shorts',
                'jackets': 'Jackets & Coats',
                'shoes': 'Shoes & Footwear',
                'accessories': 'Accessories',
                'underwear': 'Underwear & Socks',
                'activewear': 'Activewear & Sports',
                'formal': 'Formal Wear',
                'casual': 'Casual Wear',
                'grooming': 'Grooming Products'
              };
              const categoryDisplay = categoryNames[p.category] || p.category || 'N/A';

              const formatMarkdown = (text) => {
                if (!text) return '';
                return text
                  .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                  .replace(/\r?\n/g, '<br>')
                  .trim();
              };

              const parseDescriptionSections = (rawText) => {
                if (!rawText) {
                  return {
                    summary: 'No description available.',
                    volume: '',
                    ingredients: ''
                  };
                }

                const volumeMarker = '**Volume/Size:**';
                const ingredientsMarker = '**Ingredients:**';

                let summary = rawText.trim();
                let volume = '';
                let ingredients = '';

                if (rawText.includes(volumeMarker)) {
                  const [beforeVolume, afterVolumeMarker] = rawText.split(volumeMarker);
                  summary = beforeVolume.trim();
                  if (afterVolumeMarker) {
                    if (afterVolumeMarker.includes(ingredientsMarker)) {
                      const [volumePart, afterIngredientsMarker] = afterVolumeMarker.split(ingredientsMarker);
                      volume = (volumePart || '').replace(/\*\*/g, '').trim();
                      ingredients = (afterIngredientsMarker || '').replace(/\*\*/g, '').trim();
                    } else {
                      volume = afterVolumeMarker.replace(/\*\*/g, '').trim();
                    }
                  }
                } else if (rawText.includes(ingredientsMarker)) {
                  const [beforeIngredients, afterIngredientsMarker] = rawText.split(ingredientsMarker);
                  summary = beforeIngredients.trim();
                  ingredients = (afterIngredientsMarker || '').replace(/\*\*/g, '').trim();
                }

                return {
                  summary: formatMarkdown(summary || 'No description available.'),
                  volume: volume ? formatMarkdown(volume) : '',
                  ingredients: ingredients ? formatMarkdown(ingredients) : ''
                };
              };

              const descriptionSections = parseDescriptionSections(p.description || '');
              const variantTotalStock = Array.isArray(data.variants)
                ? data.variants.reduce((sum, v) => sum + (parseInt(v.stock_quantity) || 0), 0)
                : 0;
              const fallbackStock = variantTotalStock > 0
                ? variantTotalStock
                : (Number(p.stock ?? p.inventory_stock ?? 0) || 0);

              let html = `
                <div style="display:grid;gap:20px;">
                  <!-- Product Images -->
                  ${p.image_url ? `
                    <div style="text-align:center;background:#f9fafb;padding:20px;border-radius:8px;">
                      <img src="${p.image_url}" alt="${p.name}" style="max-width:100%;max-height:300px;object-fit:contain;border-radius:8px;">
                    </div>
                  ` : ''}

                  <!-- Basic Info -->
                  <div style="background:#f9fafb;padding:16px;border-radius:8px;">
                    <h3 style="margin:0 0 12px;color:#0a0a0a;">üìã Basic Information</h3>
                    <div style="display:grid;gap:8px;">
                      <div><strong>Product Name:</strong> ${p.name}</div>
                      <div><strong>Category:</strong> ${categoryDisplay}</div>
                      <div><strong>Brand:</strong> ${p.brand || 'N/A'}</div>
                      <div><strong>SKU:</strong> ${p.sku || 'N/A'}</div>
                      <div><strong>Price:</strong> ‚Ç±${parseFloat(p.price).toFixed(2)}</div>
                      <div><strong>Description:</strong><br>${descriptionSections.summary}</div>
                      ${descriptionSections.volume ? `<div><strong>Volume/Size:</strong> ${descriptionSections.volume}</div>` : ''}
                      ${descriptionSections.ingredients ? `<div><strong>Ingredients:</strong><br>${descriptionSections.ingredients}</div>` : ''}
                    </div>
                  </div>

                  <!-- Seller Info -->
                  <div style="background:#f0f9ff;padding:16px;border-radius:8px;">
                    <h3 style="margin:0 0 12px;color:#0a0a0a;">üè™ Seller Information</h3>
                    <div style="display:grid;gap:8px;">
                      <div><strong>Store Name:</strong> ${p.store_name}</div>
                      <div><strong>Seller Email:</strong> ${p.seller_email || 'N/A'}</div>
                      <div><strong>Submitted:</strong> ${new Date(p.created_at).toLocaleString()}</div>
                    </div>
                  </div>

                  <!-- Stock Info -->
                  ${data.variants && data.variants.length > 0 ? `
                    <div style="background:#fef3c7;padding:16px;border-radius:8px;">
                      <h3 style="margin:0 0 12px;color:#0a0a0a;">üì¶ Stock & Variants</h3>
                      <div style="background:#fff;border-radius:6px;max-height:300px;overflow-y:auto;">
                        <table style="width:100%;border-collapse:collapse;">
                          <thead>
                            <tr style="background:#fbbf24;color:#fff;position:sticky;top:0;">
                              <th style="padding:8px;text-align:left;border:1px solid #fbbf24;">Size</th>
                              <th style="padding:8px;text-align:left;border:1px solid #fbbf24;">Color</th>
                              <th style="padding:8px;text-align:right;border:1px solid #fbbf24;">Stock</th>
                            </tr>
                          </thead>
                          <tbody>
                            ${data.variants.map(v => `
                              <tr style="border-bottom:1px solid #fde68a;">
                                <td style="padding:8px;border:1px solid #fde68a;font-weight:500;">${v.size || 'N/A'}</td>
                                <td style="padding:8px;border:1px solid #fde68a;font-weight:500;">${v.color || 'N/A'}</td>
                                <td style="padding:8px;border:1px solid #fde68a;text-align:right;font-weight:600;">${v.stock_quantity || 0} pcs</td>
                              </tr>
                            `).join('')}
                          </tbody>
                        </table>
                      </div>
                      <div style="margin-top:12px;padding:12px;background:#fef3c7;border-radius:6px;display:flex;justify-content:space-between;align-items:center;">
                        <span style="font-weight:600;">Total Stock:</span>
                        <span style="font-size:18px;font-weight:700;color:#b45309;">${variantTotalStock} pcs</span>
                      </div>
                    </div>
                  ` : `
                    <div style="background:#fef3c7;padding:16px;border-radius:8px;">
                      <h3 style="margin:0 0 12px;color:#0a0a0a;">üì¶ Stock Information</h3>
                      <div><strong>Total Stock:</strong> ${fallbackStock} pcs</div>
                      ${!data.variants || data.variants.length === 0 ? '<p style="color:#666;font-size:14px;margin-top:8px;">No variant information available</p>' : ''}
                    </div>
                  `}

                  <!-- Action Buttons -->
                  <div style="display:flex;gap:12px;justify-content:flex-end;padding-top:16px;border-top:2px solid var(--line);">
                    <button onclick="closeProductDetailsModal()" class="tag" style="background:#f3f4f6;color:#0a0a0a;cursor:pointer;border:none;padding:10px 16px;">Close</button>
                    <button onclick="approveProductFromModal(${productId})" class="tag" style="background:#10b981;cursor:pointer;border:none;padding:10px 16px;color:#fff;">‚úì Approve</button>
                    <button onclick="rejectProductFromModal(${productId})" class="tag" style="background:#ef4444;cursor:pointer;border:none;padding:10px 16px;color:#fff;">‚úó Reject</button>
                  </div>
                </div>
              `;
              modalBody.innerHTML = html;
            } else {
              modalBody.innerHTML = '<p style="color:#ef4444;text-align:center;padding:40px;">Error loading product details</p>';
            }
          })
          .catch(error => {
            modalBody.innerHTML = '<p style="color:#ef4444;text-align:center;padding:40px;">Error: ' + error.message + '</p>';
          });
      }

      function closeProductDetailsModal() {
        document.getElementById('product-details-modal').style.display = 'none';
      }

      function approveProductFromModal(productId) {
        closeProductDetailsModal();
        approveProduct(productId);
      }

      function rejectProductFromModal(productId) {
        closeProductDetailsModal();
        rejectProduct(productId);
      }


      function loadJournalEntries() {
        fetch('/admin/journal-entries')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('journal-list');
            if (data.success && data.entries && data.entries.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Image</th>
                      <th>Created</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              data.entries.forEach(entry => {
                const date = new Date(entry.created_at).toLocaleDateString();
                html += `
                  <tr id="journal-row-${entry.id}">
                    <td><strong>${entry.title}</strong></td>
                    <td><img src="${entry.image_url || '/static/images/placeholder.svg'}" style="width:60px;height:60px;object-fit:cover;border-radius:6px" alt="${entry.title}"></td>
                    <td style="color:var(--muted);font-size:13px">${date}</td>
                    <td><span class="tag" style="background:${entry.is_active ? '#10b981' : '#ef4444'}">${entry.is_active ? 'Active' : 'Inactive'}</span></td>
                    <td>
                      <div style="display:flex;gap:8px">
                        <button class="tag" onclick="editJournalEntry(${entry.id})" style="background:#3b82f6;cursor:pointer;border:none">Edit</button>
                        <button class="tag" onclick="deleteJournalEntry(${entry.id})" style="background:#ef4444;cursor:pointer;border:none">Delete</button>
                      </div>
                    </td>
                  </tr>
                `;
              });

              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No journal entries yet. Click "Add Journal Entry" to create one.</p>';
            }
          })
          .catch(error => {
            document.getElementById('journal-list').innerHTML = '<p style="color:#ef4444">Error loading journal entries</p>';
          });
      }

      function openAddJournalModal() {
        document.getElementById('journal-modal-title').textContent = 'Add Journal Entry';
        document.getElementById('journal-form').reset();
        document.getElementById('journal-form').setAttribute('data-entry-id', '');
        document.getElementById('journal-modal').style.display = 'flex';
      }

      function editJournalEntry(entryId) {
        fetch(`/admin/journal-entry/${entryId}`)
          .then(response => response.json())
          .then(data => {
            if (data.success && data.entry) {
              const entry = data.entry;
              document.getElementById('journal-modal-title').textContent = 'Edit Journal Entry';
              document.getElementById('journal-title').value = entry.title;
              document.getElementById('journal-description').value = entry.description || '';
              document.getElementById('journal-image').value = entry.image_url || '';
              document.getElementById('journal-link').value = entry.link_url || '';
              document.getElementById('journal-form').setAttribute('data-entry-id', entryId);
              document.getElementById('journal-modal').style.display = 'flex';
            }
          })
          .catch(error => alert('Error loading journal entry'));
      }

      function deleteJournalEntry(entryId) {
        if (!confirm('Delete this journal entry? This cannot be undone.')) return;

        fetch(`/admin/journal-entry/${entryId}`, { method: 'DELETE' })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Journal entry deleted');
              loadJournalEntries();
            } else {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => alert('Error deleting entry'));
      }

      function closeJournalModal() {
        document.getElementById('journal-modal').style.display = 'none';
        document.getElementById('journal-form').reset();
      }


      function loadAllProducts() {
        fetch('/admin/all-products')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('all-products-list');
            if (data.products && data.products.length > 0) {
              let html = `<table><thead><tr><th>Product</th><th>Seller</th><th>Price</th><th>Stock</th><th>Status</th></tr></thead><tbody>`;
              data.products.forEach(product => {
                html += `<tr><td><strong>${product.name}</strong></td><td>${product.store_name}</td><td>‚Ç±${parseFloat(product.price).toFixed(2)}</td><td>${product.stock}</td><td><span class="tag" style="background:#10b981">${product.status || 'Active'}</span></td></tr>`;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No products found</p>';
            }
          })
          .catch(error => {
            document.getElementById('all-products-list').innerHTML = '<p style="color:#ef4444">Error loading products</p>';
          });
      }


      function loadCustomers() {
        fetch('/admin/all-customers')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('customers-list');
            if (data.customers && data.customers.length > 0) {
              let html = `<table><thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Joined</th><th>Orders</th></tr></thead><tbody>`;
              data.customers.forEach(customer => {
                const date = new Date(customer.created_at).toLocaleDateString();
                html += `<tr><td><strong>${customer.first_name} ${customer.last_name}</strong></td><td>${customer.email}</td><td>${customer.phone || 'N/A'}</td><td>${date}</td><td>${customer.order_count || 0}</td></tr>`;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No customers found</p>';
            }
          })
          .catch(error => {
            document.getElementById('customers-list').innerHTML = '<p style="color:#ef4444">Error loading customers</p>';
          });
      }


      function loadTransactions() {
        fetch('/admin/all-transactions')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('transactions-list');
            if (data.transactions && data.transactions.length > 0) {
              let html = `<table><thead><tr><th>Order ID</th><th>Customer</th><th>Amount</th><th>Status</th><th>Date</th></tr></thead><tbody>`;
              data.transactions.forEach(transaction => {
                const date = new Date(transaction.created_at).toLocaleDateString();
                html += `<tr><td>${transaction.order_number}</td><td>${transaction.customer_name}</td><td>‚Ç±${parseFloat(transaction.amount).toFixed(2)}</td><td><span class="tag" style="background:#10b981">${transaction.status}</span></td><td>${date}</td></tr>`;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No transactions found</p>';
            }
          })
          .catch(error => {
            document.getElementById('transactions-list').innerHTML = '<p style="color:#ef4444">Error loading transactions</p>';
          });
      }


      function loadStatistics() {
        fetch('/admin/statistics')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('statistics-content');
            if (data.success) {
              let html = `
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px">
                  <div class="card" style="text-align:center">
                    <div class="inner">
                      <div class="metric">Total Revenue</div>
                      <div class="value" style="color:#3b82f6">‚Ç±${data.total_revenue ? parseFloat(data.total_revenue).toFixed(2) : '0.00'}</div>
                    </div>
                  </div>
                  <div class="card" style="text-align:center">
                    <div class="inner">
                      <div class="metric">Total Orders</div>
                      <div class="value">${data.total_orders || 0}</div>
                    </div>
                  </div>
                  <div class="card" style="text-align:center">
                    <div class="inner">
                      <div class="metric">Active Users</div>
                      <div class="value">${data.active_users || 0}</div>
                    </div>
                  </div>
                  <div class="card" style="text-align:center">
                    <div class="inner">
                      <div class="metric">Active Products</div>
                      <div class="value">${data.active_products || 0}</div>
                    </div>
                  </div>
                </div>
              `;
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="color:#ef4444">Error loading statistics</p>';
            }
          })
          .catch(error => {
            document.getElementById('statistics-content').innerHTML = '<p style="color:#ef4444">Error loading statistics</p>';
          });


        fetch('/admin/customer-growth-by-region')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('regional-growth');
            if (data.success && data.regions && data.regions.length > 0) {
              let html = '<div style="display:flex;flex-direction:column;gap:16px">';
              const total = data.regions.reduce((sum, r) => sum + r.count, 0);

              data.regions.forEach(region => {
                const percentage = total > 0 ? Math.round((region.count / total) * 100) : 0;
                html += `
                  <div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
                      <span style="font-weight:500">${region.region}</span>
                      <span style="color:#3b82f6;font-weight:600">${percentage}%</span>
                    </div>
                    <div style="height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden">
                      <div style="height:100%;background:#0a0a0a;width:${percentage}%;transition:width 0.3s"></div>
                    </div>
                  </div>
                `;
              });

              html += '</div>';
              container.innerHTML = html;


              let detailedHtml = '<table style="width:100%;border-collapse:separate;border-spacing:0"><thead><tr><th style="text-align:left;padding:10px;border-bottom:1px solid var(--line);font-weight:600">Region</th><th style="text-align:center;padding:10px;border-bottom:1px solid var(--line);font-weight:600">Customers</th><th style="text-align:center;padding:10px;border-bottom:1px solid var(--line);font-weight:600">Percentage</th></tr></thead><tbody>';

              data.regions.forEach(region => {
                const percentage = total > 0 ? Math.round((region.count / total) * 100) : 0;
                detailedHtml += `<tr><td style="padding:12px;border-bottom:1px solid var(--line)">${region.region}</td><td style="padding:12px;border-bottom:1px solid var(--line);text-align:center;font-weight:600">${region.count}</td><td style="padding:12px;border-bottom:1px solid var(--line);text-align:center">${percentage}%</td></tr>`;
              });

              detailedHtml += '</tbody></table>';
              document.getElementById('detailed-stats-body').innerHTML = detailedHtml;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999">No regional data available</p>';
            }
          })
          .catch(error => {
            console.error('Error loading regional data:', error);
          });
      }


      function loadActiveSellers() {
        fetch('/admin/active-sellers')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('active-sellers-list');
            if (data.sellers && data.sellers.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Store Name</th>
                      <th>Owner</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Products</th>
                      <th>Joined</th>
                    </tr>
                  </thead>
                  <tbody>
              `;
              data.sellers.forEach(seller => {
                const date = new Date(seller.created_at).toLocaleDateString();
                html += `
                  <tr>
                    <td><strong>${seller.store_name}</strong></td>
                    <td>${seller.first_name} ${seller.last_name}</td>
                    <td>${seller.email}</td>
                    <td>${seller.phone || 'N/A'}</td>
                    <td>${seller.product_count || 0}</td>
                    <td>${date}</td>
                  </tr>
                `;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No active sellers found</p>';
            }
          })
          .catch(error => {
            document.getElementById('active-sellers-list').innerHTML = '<p style="color:#ef4444">Error loading sellers</p>';
          });
      }


      function loadActiveRiders() {
        fetch('/admin/active-riders')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('active-riders-list');
            if (data.riders && data.riders.length > 0) {
              let html = `
                <table>
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Vehicle Type</th>
                      <th>License Number</th>
                      <th>Service Area</th>
                      <th>Joined</th>
                    </tr>
                  </thead>
                  <tbody>
              `;
              data.riders.forEach(rider => {
                const date = new Date(rider.created_at).toLocaleDateString();
                html += `
                  <tr>
                    <td><strong>${rider.first_name} ${rider.last_name}</strong></td>
                    <td>${rider.email}</td>
                    <td>${rider.phone || 'N/A'}</td>
                    <td>${rider.vehicle_type || 'N/A'}</td>
                    <td>${rider.license_number || 'N/A'}</td>
                    <td>${rider.service_area || 'N/A'}</td>
                    <td>${date}</td>
                  </tr>
                `;
              });
              html += '</tbody></table>';
              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:40px">No active riders found</p>';
            }
          })
          .catch(error => {
            document.getElementById('active-riders-list').innerHTML = '<p style="color:#ef4444">Error loading riders</p>';
          });
      }


      function loadOverviewCustomerGrowth() {
        fetch('/admin/customer-growth-by-region')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('overview-customer-growth');
            if (data.success && data.regions && data.regions.length > 0) {
              let html = '';
              const total = data.regions.reduce((sum, r) => sum + r.count, 0);

              data.regions.slice(0, 5).forEach(region => {
                const percentage = total > 0 ? Math.round((region.count / total) * 100) : 0;
                html += `
                  <div style="display:flex;align-items:center;justify-content:space-between;font-size:13px;margin:${html === '' ? '6px' : '10px'} 0">
                    <span>${region.region}</span>
                    <span>${percentage}%</span>
                  </div>
                  <div style="height:8px;background:#efefef;border-radius:999px;margin-bottom:${html !== '' ? '0' : '10px'}">
                    <div style="height:8px;width:${percentage}%;background:#0a0a0a;border-radius:999px"></div>
                  </div>
                `;
              });

              container.innerHTML = html;
            } else {
              container.innerHTML = '<p style="text-align:center;color:#999;padding:20px">No regional data available</p>';
            }
          })
          .catch(error => {
            document.getElementById('overview-customer-growth').innerHTML = '<p style="color:#ef4444">Error loading regional data</p>';
          });
      }


      document.addEventListener('DOMContentLoaded', function() {

        loadOverviewCustomerGrowth();


      function previewJournalImage(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('journal-image-placeholder').style.display = 'none';
            document.getElementById('journal-image-preview').style.display = 'block';
            document.getElementById('journal-preview-img').src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      }

      function removeJournalImage() {
        document.getElementById('journal-image-input').value = '';
        document.getElementById('journal-image-preview').style.display = 'none';
        document.getElementById('journal-image-placeholder').style.display = 'block';
      }

      function closeJournalModal() {
        document.getElementById('journal-modal').style.display = 'none';
        document.getElementById('journal-form').reset();
        document.getElementById('journal-image-input').value = '';
        document.getElementById('journal-image-preview').style.display = 'none';
        document.getElementById('journal-image-placeholder').style.display = 'block';
        document.getElementById('journal-form').setAttribute('data-entry-id', '');
      }

      const journalForm = document.getElementById('journal-form');
        if (journalForm) {
          journalForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const entryId = this.getAttribute('data-entry-id');
            const formData = new FormData();
            formData.append('title', document.getElementById('journal-title').value);
            formData.append('description', document.getElementById('journal-description').value);
            formData.append('is_active', document.getElementById('journal-is-active').checked ? '1' : '0');


            const imageInput = document.getElementById('journal-image-input');
            if (imageInput && imageInput.files && imageInput.files[0]) {
              formData.append('image', imageInput.files[0]);
            }

            const url = entryId ? `/admin/journal-entry/${entryId}` : '/admin/journal-entry';
            const method = entryId ? 'PUT' : 'POST';

            fetch(url, { method: method, body: formData })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  alert(entryId ? 'Journal entry updated' : 'Journal entry created');
                  closeJournalModal();
                  loadJournalEntries();
                } else {
                  alert('Error: ' + data.error);
                }
              })
              .catch(error => alert('Error saving journal entry'));
          });
        }
      });


      function loadSettings() {
        fetch('/admin/settings')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.settings) {
              document.getElementById('system-name').value = data.settings.system_name || 'Var-n E-Commerce';
              document.getElementById('support-email').value = data.settings.support_email || 'support@varn.com';
              document.getElementById('support-phone').value = data.settings.support_phone || '+63 977 XXX XXXX';
              document.getElementById('maintenance-mode').checked = data.settings.maintenance_mode === 1;
              document.getElementById('email-notifications').checked = data.settings.email_notifications !== 0;
              document.getElementById('order-alerts').checked = data.settings.order_alerts !== 0;
              document.getElementById('seller-alerts').checked = data.settings.seller_alerts !== 0;
            }
          })
          .catch(error => console.log('Using default settings'));
      }


      function saveSystemSettings() {
        const formData = new FormData();
        formData.append('system_name', document.getElementById('system-name').value);
        formData.append('support_email', document.getElementById('support-email').value);
        formData.append('support_phone', document.getElementById('support-phone').value);
        formData.append('maintenance_mode', document.getElementById('maintenance-mode').checked ? 1 : 0);
        formData.append('email_notifications', document.getElementById('email-notifications').checked ? 1 : 0);
        formData.append('order_alerts', document.getElementById('order-alerts').checked ? 1 : 0);
        formData.append('seller_alerts', document.getElementById('seller-alerts').checked ? 1 : 0);

        fetch('/admin/settings', { method: 'POST', body: formData })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Settings saved successfully');
              loadSettings();
            } else {
              alert('Error: ' + (data.error || 'Could not save settings'));
            }
          })
          .catch(error => alert('Error saving settings: ' + error.message));
      }


      function loadHelp() {

        fetch('/admin/settings')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.settings) {
              document.getElementById('support-contact-email').textContent = data.settings.support_email || 'support@varn.com';
              document.getElementById('support-contact-phone').textContent = data.settings.support_phone || '+63 977 XXX XXXX';
            }
          })
          .catch(error => console.log('Using default contact info'));
      }


      function toggleFAQ(element) {
        const answerDiv = element.querySelector('div:last-child');
        const toggleIcon = element.querySelector('span:last-child');

        if (answerDiv.style.display === 'none') {
          answerDiv.style.display = 'block';
          toggleIcon.textContent = '‚àí';
        } else {
          answerDiv.style.display = 'none';
          toggleIcon.textContent = '+';
        }
      }
    </script>
  </body>
</html>

