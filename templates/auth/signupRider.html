<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Rider Sign Up ‚Äî Var√≥n</title>
		<style>
			:root {
				--bg: #ffffff;
				--fg: #0a0a0a;
				--muted: #6b7280;
				--card: #ffffff;
				--line: #e5e7eb;
				--accent: #111827;
				--error: #ef4444;
				--success: #10b981;
			}
			
			html, body {
				height: 100%;
				margin: 0;
				font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
				color: var(--fg);
				background: #f9fafb;
				line-height: 1.5;
			}
			
			.layout {
				display: grid;
				grid-template-columns: 1fr 480px;
				min-height: 100vh;
				align-items: center;
				background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
			}
			
			.left {
				padding: 64px 80px;
			}
			
			.brand {
				display: flex;
				align-items: center;
				gap: 14px;
				font-weight: 700;
				font-size: 22px;
				color: var(--accent);
			}
			
			.hero-title {
				font-size: 42px;
				color: var(--accent);
				margin: 24px 0 16px;
				line-height: 1.2;
			}
			
			.hero-sub {
				color: var(--muted);
				max-width: 520px;
				font-size: 16px;
				margin: 0;
			}
			
			.illustration {
				margin-top: 40px;
				max-width: 480px;
				border-radius: 16px;
				box-shadow: 0 20px 40px rgba(0,0,0,0.1);
			}

			.card-wrap {
				display: flex;
				justify-content: center;
				padding: 48px;
				background: #ffffff;
				height: 100%;
			}
			
			.card {
				width: 100%;
				max-width: 400px;
				background: var(--card);
				border-radius: 16px;
				box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.05);
				padding: 32px;
			}
			
			.card h2 {
				margin: 0 0 8px;
				font-size: 24px;
				color: var(--accent);
			}
			
			.sub {
				color: var(--muted);
				margin-bottom: 28px;
				font-size: 15px;
			}

			.form-group {
				margin-bottom: 20px;
			}
			
			.form-group label {
				display: block;
				font-size: 14px;
				font-weight: 500;
				color: var(--accent);
				margin-bottom: 8px;
			}
			
			.form-input, .form-select {
				width: 100%;
				padding: 12px 16px;
				border: 1px solid var(--line);
				border-radius: 8px;
				background: #fff;
				font-size: 15px;
				transition: all 0.2s;
				box-sizing: border-box;
			}
			
			.form-input:hover, .form-select:hover {
				border-color: #d1d5db;
			}
			
			.form-input:focus, .form-select:focus {
				outline: none;
				border-color: var(--accent);
				box-shadow: 0 0 0 2px rgba(17,24,39,0.1);
			}

			.form-select {
				appearance: none;
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: right 12px center;
				background-size: 16px;
				padding-right: 40px;
			}

			.vehicle-options {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 12px;
				margin-bottom: 20px;
			}

			.vehicle-option {
				position: relative;
				cursor: pointer;
			}

			.vehicle-option input {
				position: absolute;
				opacity: 0;
				cursor: pointer;
				height: 0;
				width: 0;
			}

			.vehicle-option label {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 8px;
				padding: 16px;
				border: 1px solid var(--line);
				border-radius: 8px;
				transition: all 0.2s;
			}

			.vehicle-option input:checked + label {
				border-color: var(--accent);
				background: rgba(17,24,39,0.05);
			}

			.vehicle-icon {
				font-size: 24px;
			}

			.tnc-row {
				display: flex;
				align-items: center;
				gap: 12px;
				margin: 24px 0;
			}
			
			.tnc-row input[type="checkbox"] {
				width: 18px;
				height: 18px;
				accent-color: var(--accent);
				border-radius: 4px;
				cursor: pointer;
			}
			
			.tnc-row label {
				font-size: 14px;
				color: var(--muted);
				cursor: pointer;
			}
			
			.tnc-row a {
				color: var(--accent);
				text-decoration: none;
				font-weight: 500;
			}
			
			.tnc-row a:hover {
				text-decoration: underline;
			}

			.btn {
				display: inline-block;
				width: 100%;
				padding: 14px;
				border-radius: 8px;
				border: 0;
				background: var(--accent);
				color: #fff;
				font-weight: 600;
				font-size: 15px;
				cursor: pointer;
				transition: all 0.2s;
			}
			
			.btn:hover {
				background: #000000;
				transform: translateY(-1px);
			}
			
			.btn:active {
				transform: translateY(0);
			}

			.small-note {
				font-size: 14px;
				color: var(--muted);
				margin-top: 20px;
				text-align: center;
			}
			
			.small-note a {
				color: var(--accent);
				text-decoration: none;
				font-weight: 500;
			}

			.alert {
				padding: 12px;
				margin-bottom: 20px;
				border-radius: 8px;
			}

			.alert-error {
				background: #fee2e2;
				color: #991b1b;
			}

			.alert-success {
				background: #dcfce7;
				color: #15803d;
			}

			.small-note a:hover {
				text-decoration: underline;
			}

			@media (max-width: 1024px) {
				.layout {
					grid-template-columns: 1fr;
				}
				
				.left {
					padding: 40px;
					text-align: center;
				}
				
				.hero-sub {
					margin: 0 auto;
				}
				
				.illustration {
					margin: 32px auto;
				}
				
				.card-wrap {
					padding: 32px 24px;
				}
			}
		</style>
	</head>
	<body>
		<div class="layout">
			<div class="left">
				<div class="brand"><img src="" alt="" style="width:34px;height:34px;border-radius:6px;background:#efefef"> Var√≥n Rider</div>
				<h1 class="hero-title">Become a Var√≥n Rider</h1>
				<p class="hero-sub">Join our delivery fleet and earn on your own schedule. Get paid to deliver packages and food to customers in your area.</p>
				<img class="illustration" alt="delivery illustration" src="https://images.unsplash.com/photo-1617347454431-f49d7ff5c3b1?q=80&w=800&auto=format&fit=crop" style="width:100%;height:320px;object-fit:cover">
			</div>

			<div class="card-wrap">
				<div class="card" role="region" aria-label="Rider signup form">
					<h2>Sign up as a rider</h2>
					<div class="sub">Create your rider account and start earning.</div>

					<form id="riderSignup" action="/signup/rider" method="POST" novalidate>
						<div id="flashed-messages">
							<!-- Flash messages will be inserted here -->
							<input type="hidden" id="server-flash" value="{{ get_flashed_messages(with_categories=true) | tojson | safe }}" />
						</div>
						<div id="errorDisplay" class="alert alert-error" style="display: none"></div>
						<div class="form-group">
							<label for="firstName">First Name</label>
							<input id="firstName" name="first_name" class="form-input" type="text" placeholder="Your first name" required />
						</div>

						<div class="form-group">
							<label for="lastName">Last Name</label>
							<input id="lastName" name="last_name" class="form-input" type="text" placeholder="Your last name" required />
						</div>

						<div class="form-group">
							<label for="riderEmail">Email address</label>
							<input id="riderEmail" name="email" class="form-input" type="email" placeholder="you@example.com" required />
						</div>

					<div class="form-group">
						<label for="riderPhone">Contact number</label>
						<input id="riderPhone" name="phone" class="form-input" type="tel" value="+63 " placeholder="+63 9xx xxx xxxx" pattern="[0-9\+\-\s]{7,20}" required />
					</div>

					<div class="form-group">
						<label>Vehicle Type(s) <small style="color:#666;font-weight:normal;">(Select all that apply)</small></label>
						<div class="vehicle-options" style="grid-template-columns:repeat(3,1fr)">
							<div class="vehicle-option">
								<input type="checkbox" id="motorcycle" name="vehicle_type" value="motorcycle" onchange="updateVehicleDetails()">
								<label for="motorcycle">
									<span class="vehicle-icon">üèçÔ∏è</span>
									<span>Motorcycle</span>
								</label>
							</div>
							<div class="vehicle-option">
								<input type="checkbox" id="truck" name="vehicle_type" value="truck" onchange="updateVehicleDetails()">
								<label for="truck">
									<span class="vehicle-icon">üöõ</span>
									<span>Truck</span>
								</label>
							</div>
							<div class="vehicle-option">
								<input type="checkbox" id="van" name="vehicle_type" value="van" onchange="updateVehicleDetails()">
								<label for="van">
									<span class="vehicle-icon">üöê</span>
									<span>Van</span>
								</label>
							</div>
						</div>
					</div>

				<div class="form-group">
					<!-- Vehicle details (plate numbers and driver's license) will be dynamically added here when a vehicle type is selected -->
					<div id="vehicleDetailsContainer" style="display: none; margin-bottom: 20px;">
					</div>
					
					<label for="riderRegion">Select Your Service Area</label>
					<select id="riderRegion" name="region" class="form-select" required onchange="toggleRegionProvinces(this.value)">
						<option value="">Select a region</option>
						<option value="North Luzon">North Luzon</option>
						<option value="Central Luzon">Central Luzon</option>
						<option value="South Luzon">South Luzon</option>
						<option value="Visayas">Visayas</option>
						<option value="Mindanao">Mindanao</option>
					</select>
					
					<!-- Provinces Container -->
					<div id="provincesContainer" style="display:none;margin-top:20px">
						<!-- Provinces will be dynamically shown here -->
					</div>
					
					<!-- Hidden input to store selected service areas -->
					<input type="hidden" id="serviceAreaInput" name="service_area" required>
				</div>						<div class="form-group">
						<label for="riderPassword">Create password</label>
						<input id="riderPassword" name="password" class="form-input" type="password" placeholder="At least 6 characters with letters and numbers" minlength="6" required />
						<small style="color:#666;font-size:12px;margin-top:4px;display:block;">Must be at least 6 characters with both letters and numbers</small>
					</div>

					<div class="form-group">
						<label for="riderConfirmPassword">Confirm password</label>
						<input id="riderConfirmPassword" name="confirm_password" class="form-input" type="password" placeholder="Re-enter your password" minlength="6" required />
					</div>

					<div class="tnc-row">
						<input id="riderTnc" name="tnc" type="checkbox" required />
							<label for="riderTnc">I agree to the <a href="/terms" target="_blank">Terms &amp; Conditions</a> and confirm I have a valid driver's license</label>
						</div>

						<button type="submit" class="btn">Create rider account</button>

						<div class="small-note">Already have an account? <a href="/login">Log in</a></div>
					</form>
				</div>
			</div>
		</div>

		<script>

			// Form validation helper functions
			function validateEmail(email) {
				const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
				return re.test(email.toLowerCase());
			}

			function validatePhoneNumber(phone) {
				const re = /^(?:\+63|0)[0-9\s\-]{9,}$/;
				return re.test(phone.replace(/\s+/g, ''));
			}

			function showError(message) {
				const errorDisplay = document.getElementById('errorDisplay');
				errorDisplay.textContent = message;
				errorDisplay.style.display = 'block';
				setTimeout(() => {
					errorDisplay.style.display = 'none';
				}, 5000);
			}

			// Form validation
			document.getElementById('riderSignup').addEventListener('submit', function(e) {
				e.preventDefault();
				e.stopPropagation();
				const form = e.target;
				
				// Ensure service area is updated BEFORE creating FormData
				updateServiceArea();
				
				// Small delay to ensure DOM is updated
				setTimeout(function() {
					const formData = new FormData(form);

					// Validate required fields
					const firstName = formData.get('first_name');
					const lastName = formData.get('last_name');
					const email = formData.get('email');
					const phone = formData.get('phone');
					const password = formData.get('password');
					const confirmPassword = formData.get('confirm_password');
					const vehicleType = formData.get('vehicle_type');
					const serviceAreaValue = formData.get('service_area');
					const tnc = formData.get('tnc');

			// Create error message div if it doesn't exist
			let errorDiv = document.getElementById('errorDisplay');
			errorDiv.style.display = 'none';
			
			// Check if passwords match
			if (password !== confirmPassword) {
				errorDiv.textContent = 'Passwords do not match';
				errorDiv.style.display = 'block';
				return;
			}
			
			// Validate password strength (at least 6 characters with letters and numbers)
			const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/;
			if (!passwordRegex.test(password)) {
				errorDiv.textContent = 'Password must be at least 6 characters and contain both letters and numbers';
				errorDiv.style.display = 'block';
				return;
			}
			
			// Check if at least one vehicle type is selected
			const vehicleTypes = formData.getAll('vehicle_type');
			if (vehicleTypes.length === 0) {
				errorDiv.textContent = 'Please select at least one vehicle type';
				errorDiv.style.display = 'block';
				return;
			}

					// Validate service area - MUST be first check
					const selectedRegion1 = formData.get('region');
					const provinceCheckboxes1 = document.querySelectorAll('input[name="province"]:checked');
					const selectedProvinces1 = Array.from(provinceCheckboxes1).map(cb => cb.value);
					
					console.log('=== Service Area Validation ===');
					console.log('Region:', selectedRegion1);
					console.log('Provinces from DOM:', selectedProvinces1);
					
					if (!selectedRegion1 || selectedRegion1.trim() === '') {
						errorDiv.textContent = 'Please select a region';
						errorDiv.style.display = 'block';
						return;
					}
					
					// Build service area from region (required) and provinces (optional)
					const serviceAreas1 = [selectedRegion1];
					if (selectedProvinces1.length > 0) {
						serviceAreas1.push(...selectedProvinces1);
					}
					const serviceAreaFinal = serviceAreas1.join(',');
					
					// Set the service area input value immediately
					const serviceAreaInput1 = document.getElementById('serviceAreaInput');
					serviceAreaInput1.value = serviceAreaFinal;
					
					// Update FormData with service area
					formData.set('service_area', serviceAreaFinal);
					
					console.log('Service Area set to:', serviceAreaFinal);

					// Validate all required fields
					if (!firstName || !lastName || !email || !phone || !password || !confirmPassword) {
						errorDiv.textContent = 'All fields are required';
						errorDiv.style.display = 'block';
						return;
					}

					// Validate email format
					if (!email.includes('@') || !email.includes('.')) {
						errorDiv.textContent = 'Please enter a valid email address';
						errorDiv.style.display = 'block';
						return;
					}

					// Validate phone number
					const cleanPhone = phone.replace(/[\+\-\s]/g, '');
					if (!cleanPhone.match(/^\d+$/)) {
						errorDiv.textContent = 'Please enter a valid phone number';
						errorDiv.style.display = 'block';
						return;
					}

					// Vehicle type validation already done above

					// Check Terms & Conditions
					if (!tnc) {
						errorDiv.textContent = 'Please agree to the Terms & Conditions to continue';
						errorDiv.style.display = 'block';
						return;
					}

					// Final update of service area - ensure it's set to region at minimum
					const selectedRegion2 = formData.get('region');
					const provinceCheckboxes2 = document.querySelectorAll('input[name="province"]:checked');
					const selectedProvinces2 = Array.from(provinceCheckboxes2).map(cb => cb.value);
					
					console.log('=== Final Validation ===');
					console.log('Region:', selectedRegion2);
					console.log('Provinces (from DOM):', selectedProvinces2);
					
					// Build service area from region (required) and provinces (optional)
					let finalServiceArea = '';
					if (selectedRegion2) {
						const serviceAreas2 = [selectedRegion2];
						if (selectedProvinces2.length > 0) {
							serviceAreas2.push(...selectedProvinces2);
						}
						finalServiceArea = serviceAreas2.join(',');
					}
					
					// Validate that we have a region
					if (!selectedRegion2 || selectedRegion2.trim() === '') {
						errorDiv.textContent = 'Please select a region';
						errorDiv.style.display = 'block';
						return;
					}
					
					// Ensure service area is set (at minimum to region)
					if (!finalServiceArea || finalServiceArea.trim() === '') {
						finalServiceArea = selectedRegion2;
					}
					
					// Set the hidden input value
					const serviceAreaInput2 = document.getElementById('serviceAreaInput');
					serviceAreaInput2.value = finalServiceArea;
					
					// CRITICAL: Explicitly set service_area in FormData before sending
					formData.set('service_area', finalServiceArea);
					
					// Verify it's set
					const verifyServiceArea = formData.get('service_area');
					console.log('Service Area in FormData after set:', verifyServiceArea);
					console.log('All FormData entries:', Array.from(formData.entries()));
					if (!verifyServiceArea || verifyServiceArea.trim() === '') {
						errorDiv.textContent = 'Service area validation failed. Please try again.';
						errorDiv.style.display = 'block';
						return;
					}
					
					// Debug: Log to console
					console.log('=== Form Submission Debug ===');
					console.log('Selected Region:', selectedRegion2);
					console.log('Selected Provinces:', selectedProvinces2);
					console.log('Service Area Input Value:', serviceAreaInput2.value);
					console.log('Final Service Area:', finalServiceArea);
					console.log('FormData service_area:', formData.get('service_area'));
					console.log('All FormData entries:', Array.from(formData.entries()));

					// Disable submit button
					const submitBtn = form.querySelector('button[type="submit"]');
					const originalText = submitBtn.textContent;
					submitBtn.disabled = true;
					submitBtn.textContent = 'Sending OTP...';

					// Submit the form via AJAX
					fetch('/signup/rider', {
						method: 'POST',
						body: formData
					})
					.then(response => {
						console.log('Response status:', response.status);
						return response.json();
					})
					.then(data => {
						console.log('Response data:', data);
						if (data.success) {
							// Redirect to OTP verification page
							window.location.href = data.redirect;
						} else {
							errorDiv.textContent = data.message || 'An error occurred';
							errorDiv.style.display = 'block';
							submitBtn.disabled = false;
							submitBtn.textContent = originalText;
						}
					})
					.catch(error => {
						errorDiv.textContent = 'An error occurred. Please try again later.';
						errorDiv.style.display = 'block';
						console.error('Error:', error);
						submitBtn.disabled = false;
						submitBtn.textContent = originalText;
					});
				}, 100); // Small delay to ensure DOM updates
			});

			// Live validation feedback
			const emailInput = document.querySelector('[name="email"]');
			const phoneInput = document.querySelector('[name="phone"]');

			emailInput.addEventListener('input', function(e) {
				const isValid = validateEmail(e.target.value);
				e.target.style.borderColor = e.target.value && !isValid ? 'var(--error)' : '';
			});

			phoneInput.addEventListener('input', function(e) {
				const isValid = validatePhoneNumber(e.target.value);
				e.target.style.borderColor = e.target.value && !isValid ? 'var(--error)' : '';
			});

			// Auto-format phone number with +63 prefix
			phoneInput.addEventListener('input', function(e) {
				let value = e.target.value;
				// Always ensure +63 prefix
				if (!value.startsWith('+63')) {
					value = '+63 ' + value.replace(/^\+63\s*/, '');
					e.target.value = value;
				}
				// Prevent deleting the +63 prefix
				if (value.length < 4) {
					e.target.value = '+63 ';
				}
			});
			
			phoneInput.addEventListener('keydown', function(e) {
				// Prevent backspace from deleting the +63 prefix
				if (e.key === 'Backspace' && e.target.selectionStart <= 4) {
					e.preventDefault();
				}
			});
			
			// Dynamic vehicle details based on selection
			function updateVehicleDetails() {
				console.log('updateVehicleDetails called');
				const vehicleCheckboxes = document.querySelectorAll('input[name="vehicle_type"]:checked');
				const container = document.getElementById('vehicleDetailsContainer');
				
				if (!container) {
					console.error('vehicleDetailsContainer not found!');
					return;
				}
				
				const selectedVehicles = Array.from(vehicleCheckboxes).map(cb => {
					const labelElement = cb.closest('.vehicle-option').querySelector('label');
					const labelText = labelElement ? labelElement.querySelector('span:last-child').textContent : cb.value;
					return {
						value: cb.value,
						label: labelText
					};
				});
				
				console.log('Selected vehicles:', selectedVehicles);
				
				// Clear existing fields
				container.innerHTML = '';
				
				// If no vehicles selected, hide the container
				if (selectedVehicles.length === 0) {
					container.style.display = 'none';
					return;
				}
				
				// Show the container
				container.style.display = 'block';
				
				// Add driver's license field FIRST (at the top)
				const licenseSection = document.createElement('div');
				licenseSection.className = 'form-group';
				licenseSection.style.marginBottom = '20px';
				licenseSection.innerHTML = `
					<label for="licenseNumber">Driver's License Number</label>
					<input id="licenseNumber" name="license_number" class="form-input" type="text" placeholder="Enter your driver's license number" required />
				`;
				container.appendChild(licenseSection);
				
				// Create fields for each selected vehicle (plate numbers)
				selectedVehicles.forEach((vehicle, index) => {
					const vehicleSection = document.createElement('div');
					vehicleSection.className = 'form-group';
					vehicleSection.style.marginBottom = '20px';
					
					vehicleSection.innerHTML = `
						<label for="vehiclePlate_${vehicle.value}">${vehicle.label} Plate Number</label>
						<input id="vehiclePlate_${vehicle.value}" name="vehicle_plate_${vehicle.value}" class="form-input" type="text" placeholder="Enter ${vehicle.label.toLowerCase()} plate number" required />
					`;
					
					container.appendChild(vehicleSection);
				});
				
				console.log('Vehicle details updated:', selectedVehicles.length, 'vehicles selected');
				console.log('Container innerHTML length:', container.innerHTML.length);
			}
			
			// Make updateVehicleDetails globally accessible
			window.updateVehicleDetails = updateVehicleDetails;
			
			// Set up event listeners when DOM is ready
			function initializeVehicleListeners() {
				const checkboxes = document.querySelectorAll('input[name="vehicle_type"]');
				console.log('Initializing listeners for', checkboxes.length, 'vehicle checkboxes');
				
				checkboxes.forEach(checkbox => {
					// Add event listener (inline handler already exists in HTML)
					checkbox.addEventListener('change', function() {
						console.log('Vehicle type changed:', this.value, this.checked);
						updateVehicleDetails();
					});
				});
				
				// Initial call to check if any vehicles are pre-selected
				updateVehicleDetails();
			}
			
			// Initialize when DOM is ready
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initializeVehicleListeners);
			} else {
				// DOM already loaded, initialize immediately
				initializeVehicleListeners();
			}

			// Region and Province Data
			const regionProvinces = {
				'North Luzon': [
					'Ilocos Norte', 'Ilocos Sur', 'La Union', 'Pangasinan', 
					'Baguio City', 'Benguet', 'Abra', 'Kalinga', 'Apayao', 'Mountain Province',
					'Cagayan', 'Isabela', 'Nueva Vizcaya', 'Quirino', 'Batanes'
				],
				'Central Luzon': [
					'Pampanga', 'Tarlac', 'Nueva Ecija', 'Zambales', 'Bataan', 
					'Bulacan', 'Aurora', 'Angeles City', 'Olongapo City', 'San Fernando City'
				],
				'South Luzon': [
					'Laguna', 'Batangas', 'Cavite', 'Rizal', 'Quezon', 
					'Antipolo City', 'Lucena City', 'Batangas City', 'Lipa City', 'Tagaytay City',
					'Calamba City', 'Los Ba√±os', 'Bi√±an City', 'Cabuyao', 'San Pablo City',
					'Albay', 'Camarines Norte', 'Camarines Sur', 'Catanduanes', 'Masbate', 'Sorsogon',
					'Marinduque', 'Occidental Mindoro', 'Oriental Mindoro', 'Palawan', 'Romblon',
					'Manila', 'Quezon City', 'Makati', 'Pasig', 'Taguig', 'Mandaluyong', 
					'Marikina', 'Pasay', 'Para√±aque', 'Las Pi√±as', 'Muntinlupa', 'Caloocan',
					'Malabon', 'Navotas', 'Valenzuela', 'San Juan'
				],
				'Visayas': [
					'Cebu', 'Cebu City', 'Mandaue City', 'Lapu-Lapu City', 'Talisay City',
					'Iloilo', 'Iloilo City', 'Bacolod City', 'Negros Occidental', 'Negros Oriental',
					'Bohol', 'Tagbilaran City', 'Dumaguete City', 'Roxas City', 'Kalibo',
					'Tacloban City', 'Ormoc City', 'Leyte', 'Samar', 'Eastern Samar', 'Northern Samar',
					'Biliran', 'Southern Leyte'
				],
				'Mindanao': [
					'Davao City', 'Davao del Norte', 'Davao del Sur', 'Davao Oriental', 'Davao de Oro',
					'Cagayan de Oro City', 'Misamis Oriental', 'Misamis Occidental', 'Iligan City',
					'Zamboanga City', 'Zamboanga del Norte', 'Zamboanga del Sur', 'Zamboanga Sibugay',
					'General Santos City', 'South Cotabato', 'North Cotabato', 'Sultan Kudarat',
					'Butuan City', 'Agusan del Norte', 'Agusan del Sur', 'Surigao del Norte', 'Surigao del Sur',
					'Cotabato City', 'Maguindanao', 'Lanao del Norte', 'Lanao del Sur', 'Marawi City',
					'Bukidnon', 'Valencia City', 'Malaybalay City'
				]
			};

			// Make functions globally accessible for inline handlers
			window.toggleRegionProvinces = function(region) {
				const container = document.getElementById('provincesContainer');
				const provinces = regionProvinces[region] || [];
				
				// Clear existing provinces
				container.innerHTML = '';
				
				if (region && provinces.length > 0) {
					// Show provinces for this region
					container.innerHTML = `
						<div style="margin-bottom:12px">
							<label style="font-size:14px;font-weight:600;color:var(--accent)">Select Provinces/Cities in ${region} (Optional)</label>
							<small style="display:block;color:#666;font-size:12px;margin-top:4px">Optionally select specific provinces/cities, or leave blank to serve the entire region</small>
						</div>
						<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;max-height:300px;overflow-y:auto;padding:8px;background:#f9fafb;border-radius:8px;border:1px solid var(--line)">
							${provinces.map(province => `
								<label style="display:flex;align-items:center;gap:8px;padding:8px;cursor:pointer;font-size:14px;border-radius:6px;transition:background 0.2s" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
									<input type="checkbox" name="province" value="${province}" data-region="${region}" onchange="updateServiceArea()" style="width:18px;height:18px;cursor:pointer">
									<span>${province}</span>
								</label>
							`).join('')}
						</div>
					`;
					container.style.display = 'block';
				} else {
					container.style.display = 'none';
				}
				
				updateServiceArea();
			}

			// Update hidden service area input with selected regions and provinces
			window.updateServiceArea = function() {
				const regionSelect = document.getElementById('riderRegion');
				const selectedRegion = regionSelect ? regionSelect.value : '';
				const selectedProvinces = Array.from(document.querySelectorAll('input[name="province"]:checked')).map(cb => cb.value);
				
				const serviceAreaInput = document.getElementById('serviceAreaInput');
				
				// Combine region and provinces - region is required, provinces are optional
				const serviceAreas = [];
				if (selectedRegion) {
					serviceAreas.push(selectedRegion);
					if (selectedProvinces.length > 0) {
						serviceAreas.push(...selectedProvinces);
					}
					serviceAreaInput.value = serviceAreas.join(',');
				} else {
					// No region selected
					serviceAreaInput.value = '';
				}
				
				// Debug logging
				console.log('updateServiceArea called:');
				console.log('  Region:', selectedRegion);
				console.log('  Provinces:', selectedProvinces);
				console.log('  Final value:', serviceAreaInput.value);
				
				// Update validation - only require region
				if (selectedRegion) {
					serviceAreaInput.setCustomValidity('');
				} else {
					serviceAreaInput.setCustomValidity('Please select a region');
				}
			}

			// Clear error display when user starts typing in any field
			document.querySelectorAll('.form-input, .form-select').forEach(input => {
				input.addEventListener('input', () => {
					document.getElementById('errorDisplay').style.display = 'none';
				});
			});

			// Handle flash messages
			function showFlashMessage(message, category) {
				const flashContainer = document.getElementById('flashed-messages');
				const messageDiv = document.createElement('div');
				messageDiv.className = `alert alert-${category}`;
				messageDiv.textContent = message;
				flashContainer.appendChild(messageDiv);
				
				// Auto-hide after 5 seconds
				setTimeout(() => {
					messageDiv.style.opacity = '0';
					messageDiv.style.transition = 'opacity 0.5s';
					setTimeout(() => messageDiv.remove(), 500);
				}, 5000);
			}

			// Process server flash messages on page load
			window.addEventListener('load', function() {
				const serverFlash = document.getElementById('server-flash');
				if (serverFlash) {
					try {
						const messages = JSON.parse(serverFlash.value);
						messages.forEach(([category, message]) => {
							showFlashMessage(message, category);
						});
						serverFlash.remove(); // Remove after processing
					} catch (e) {
						console.error('Error processing flash messages:', e);
					}
				}
			});
		</script>
	</body>
</html>

